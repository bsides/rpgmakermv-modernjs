{"version":3,"sources":["../../src/core/main.js"],"names":["gui","JsExtensions","Error","Number","prototype","clamp","min","max","Math","mod","n","String","format","args","arguments","replace","s","padZero","length","Object","defineProperties","Array","equals","enumerable","value","array","i","clone","slice","contains","element","indexOf","string","randomInt","floor","random","Utils","RPGMAKER_NAME","RPGMAKER_VERSION","isOptionValid","name","location","search","split","isNwjs","require","process","isMobileDevice","r","navigator","userAgent","match","isMobileSafari","agent","isAndroidChrome","canReadGameFiles","scripts","document","getElementsByTagName","lastScript","xhr","XMLHttpRequest","open","src","overrideMimeType","send","e","rgbToCssColor","g","b","round","_id","generateRuntimeId","_supportPassiveEvent","isSupportPassiveEvent","passive","options","defineProperty","get","window","addEventListener","CacheEntry","cache","key","item","cached","touchTicks","touchSeconds","ttlTicks","ttlSeconds","freedByTTL","free","byTTL","_inner","allocate","touch","setTimeToLive","ticks","seconds","isStillAlive","updateTicks","updateSeconds","CacheMap","manager","_lastRemovedEntries","lastCheckTTL","delayCheckTTL","Date","now","checkTTL","temp","entry","push","getItem","clear","keys","setItem","update","delta","ImageCache","initialize","apply","limit","_items","add","bitmap","_truncateCache","reserve","reservationId","releaseReservation","items","map","forEach","sizeLeft","sort","a","_mustBeHeld","width","height","bind","isRequestOnly","isReady","some","getErrorBitmap","isError","RequestQueue","_queue","enqueue","top","isRequestReady","shift","startRequest","raisePriority","splice","unshift","Point","create","PIXI","constructor","x","y","call","Rectangle","emptyRectangle","Graphics","_cssFontLoading","fonts","ready","_fontLoaded","_videoVolume","type","_width","_height","_rendererType","_boxWidth","_boxHeight","_scale","_realScale","_errorShowed","_errorPrinter","_canvas","_video","_videoUnlocked","_videoLoading","_upperCanvas","_renderer","_fpsMeter","_modeBox","_skipCount","_maxSkip","_rendered","_loadingImage","_loadingCount","_fpsMeterToggled","_stretchEnabled","_defaultStretchMode","_canUseDifferenceBlend","_canUseSaturationBlend","_hiddenCanvas","_testCanvasBlendModes","_modifyExistingElements","_updateRealScale","_createAllElements","_disableTextSelection","_disableContextMenu","_setupEventHandlers","_setupCssFontLoading","then","catch","error","SceneManager","onError","canUseCssFontLoading","frameCount","BLEND_NORMAL","BLEND_ADD","BLEND_MULTIPLY","BLEND_SCREEN","tickStart","tickEnd","tick","render","stage","startTime","gl","flush","endTime","elapsed","isWebGL","RENDERER_TYPE","WEBGL","hasWebGL","canvas","createElement","getContext","canUseDifferenceBlend","canUseSaturationBlend","setLoadingImage","Image","startLoading","updateLoading","_paintUpperCanvas","style","opacity","endLoading","_clearUpperCanvas","printLoadingError","url","innerHTML","_makeErrorHtml","button","fontSize","color","backgroundColor","onmousedown","ontouchstart","event","ResourceHandler","retry","stopPropagation","appendChild","Infinity","eraseLoadingError","printError","message","_applyCanvasFilter","showFps","show","hideFps","hide","loadFont","head","rule","sheet","insertRule","_createFontLoader","isFontLoaded","check","context","text","width1","width2","font","measureText","playVideo","_videoLoader","createLoader","_playVideo","_onVideoError","onloadeddata","_onVideoLoad","onerror","onended","_onVideoEnd","load","isVideoPlaying","_isVideoVisible","canPlayVideoType","canPlayType","setVideoVolume","volume","pageToCanvasX","left","offsetLeft","pageToCanvasY","offsetTop","isInsideCanvas","callGC","textureGC","run","set","_updateAllElements","configurable","_createErrorPrinter","_createCanvas","_createVideo","_createUpperCanvas","_createRenderer","_createFPSMeter","_createModeBox","_createGameFontLoader","_updateErrorPrinter","_updateCanvas","_updateVideo","_updateUpperCanvas","_updateRenderer","h","innerWidth","v","innerHeight","imageData1","imageData2","globalCompositeOperation","fillStyle","fillRect","getImageData","data","elements","zIndex","id","body","textAlign","textShadow","_centerElement","setAttribute","makeVideoPlayableInline","clearRect","dx","dy","alpha","save","globalAlpha","drawImage","restore","dontSayHello","view","CanvasRenderer","WebGLRenderer","autoDetectRenderer","maxIdle","resize","graph","decimals","theme","toggleOn","FPSMeter","box","position","background","fontFamily","div","createTextNode","margin","right","bottom","userSelect","webkitUserSelect","msUserSelect","mozUserSelect","oncontextmenu","filter","webkitFilter","play","_updateVisibility","videoVisible","_onWindowResize","_onKeyDown","_onTouchEnd","ctrlKey","altKey","keyCode","preventDefault","_switchFPSMeter","_switchStretchMode","_switchFullScreen","paused","isPaused","showDuration","_isFullScreen","_requestFullScreen","_cancelFullScreen","fullScreenElement","mozFullScreen","webkitFullscreenElement","msFullscreenElement","requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","Element","ALLOW_KEYBOARD_INPUT","msRequestFullscreen","cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","Input","_wrapNwjsAlert","keyRepeatWait","keyRepeatInterval","keyMapper","gamepadMapper","_currentState","_previousState","_gamepadStates","_latestButton","_pressedTime","_dir4","_dir8","_preferredAxis","_date","_pollGamepads","_updateDirection","isPressed","keyName","_isEscapeCompatible","isTriggered","isRepeated","isLongPressed","_alert","alert","win","Window","focus","_onKeyUp","_onLostFocus","_shouldPreventDefault","buttonName","exists","getGamepads","gamepads","gamepad","connected","_updateGamepadState","lastState","index","newState","buttons","axes","threshold","pressed","j","_signX","_signY","_makeNumpadDirection","TouchInput","_mousePressed","_screenPressed","_events","triggered","cancelled","moved","released","wheelX","wheelY","_triggered","_cancelled","_moved","_released","_wheelX","_wheelY","_x","_y","isCancelled","isMoved","isReleased","isSupportPassive","_onMouseDown","_onMouseMove","_onMouseUp","_onWheel","_onTouchStart","_onTouchMove","_onTouchCancel","_onPointerDown","_onLeftButtonDown","_onMiddleButtonDown","_onRightButtonDown","pageX","pageY","_onTrigger","_onCancel","_onMove","_onRelease","deltaX","deltaY","changedTouches","touches","cordova","standalone","pointerType","isPrimary","Sprite","voidFilter","filters","VoidFilter","texture","Texture","BaseTexture","_bitmap","_frame","_realFrame","_blendColor","_colorTone","_context","_tintTexture","_isPicture","spriteId","_counter","opaque","_refreshFrame","addLoadListener","_onBitmapLoad","frame","_refresh","children","child","move","setFrame","getBlendColor","setBlendColor","getColorTone","setColorTone","tone","bitmapLoaded","frameX","frameY","frameW","frameH","bitmapW","bitmapH","realX","realY","realW","realH","pivot","_needsTint","_createTinter","_executeTint","baseTexture","_updateID","_isInBitmapRect","w","scaleMode","gray","r1","g1","b1","r2","g2","b2","r3","g3","b3","a3","_renderCanvas_PIXI","_renderCanvas","_renderWebGL_PIXI","_renderWebGL","renderer","_speedUpCustomBlendModes","picture","plugins","blend","blendMode","renderingToScreen","_activeRenderTarget","root","drawModes","_lastObjectRendered","f","_filters","setTimeout","filterArea","checkDirty","calculateVertices","pluginName","setObjectRenderer","Tilemap","Container","_margin","_tileWidth","_tileHeight","_mapWidth","_mapHeight","_mapData","_layerWidth","_layerHeight","_lastTiles","bitmaps","origin","flags","animationCount","horizontalWrap","verticalWrap","_createLayers","refresh","setData","animationFrame","refreshTileset","updateTransform","ox","oy","startX","startY","_updateLayerPositions","_needsRepaint","_lastAnimationFrame","_lastStartX","_lastStartY","_frameUpdated","_paintAllTiles","_sortChildren","tileCols","ceil","tileRows","layerWidth","layerHeight","_lowerBitmap","Bitmap","_upperBitmap","_lowerLayer","z","_upperLayer","addChild","m","x2","y2","w1","h1","w2","h2","_paintTiles","tableEdgeVirtualId","mx","my","lx","ly","tileId0","_readMapData","tileId1","tileId2","tileId3","shadowBits","upperTileId1","lowerTiles","upperTiles","_isHigherTile","_isTableTile","isShadowingTile","_isOverpassPosition","lastLowerTiles","_readLastTiles","isTileA1","lowerTileId","_drawShadow","_drawTableEdge","_drawTile","_writeLastTiles","lastUpperTiles","array1","array2","tiles","tileId","isVisibleTile","isAutotile","_drawAutotile","_drawNormalTile","setNumber","isTileA5","sx","sy","source","bltImage","autotileTable","FLOOR_AUTOTILE_TABLE","kind","getAutotileKind","shape","getAutotileShape","tx","ty","bx","by","isTable","waterSurfaceIndex","WATERFALL_AUTOTILE_TABLE","isTileA2","isTileA3","WALL_AUTOTILE_TABLE","isTileA4","table","qsx","qsy","sx1","sy1","dx1","dy1","qsx2","qsy2","sx2","sy2","_compareChildOrder","TILE_ID_B","TILE_ID_C","TILE_ID_D","TILE_ID_E","TILE_ID_A5","TILE_ID_A1","TILE_ID_A2","TILE_ID_A3","TILE_ID_A4","TILE_ID_MAX","makeAutotileId","isSameKindTile","tileID1","tileID2","isWaterTile","isWaterfallTile","isGroundTile","isRoofTile","isWallTopTile","isWallSideTile","isWallTile","isFloorTypeAutotile","isWallTypeAutotile","isWaterfallTypeAutotile","ShaderTilemap","roundPixels","glCore","VertexArrayObject","FORCE_NATIVE","settings","GC_MODE","GC_MODES","AUTO","tilemap","TileRenderer","SCALE_MODE","SCALE_MODES","NEAREST","DO_CLEAR","_hackRenderer","af","tileAnim","renderCanvas","renderWebGL","_lastBitmapLength","_baseTexture","lowerLayer","setBitmaps","upperLayer","lowerZLayer","ZLayer","upperZLayer","parameters","PluginManager","useSquareShader","hasOwnProperty","CompositeRectTileLayer","shadowColor","Float32Array","layer","addRect","animX","animY","TilingSprite","extras","PictureTilingSprite","tilePosition","updateTransformTS","tilingTexture","ScreenSprite","_graphics","_red","_green","_blue","_colorText","setBlack","YEPWarned","warnYep","console","log","scale","setColor","setWhite","graphics","intColor","beginFill","drawRect","_isWindow","_windowskin","_cursorRect","_openness","_animationCount","_padding","_windowSpriteContainer","_windowBackSprite","_windowCursorSprite","_windowFrameSprite","_windowContentsSprite","_windowArrowSprites","_windowPauseSignSprite","_createAllParts","active","downArrowVisible","upArrowVisible","pause","_onWindowskinLoad","_refreshAllParts","isOpen","isClosed","setCursorRect","cx","cy","cw","ch","rect","_refreshCursor","setTone","_refreshBack","addChildToBack","containerIndex","addChildAt","_updateCursor","_updateArrows","_updatePauseSign","_updateContents","_downArrowSprite","_upArrowSprite","_refreshContents","_refreshArrows","_refreshPauseSign","p","blt","adjustTone","skin","q","pad","padding","anchor","blinkCount","cursorOpacity","contentsOpacity","visible","sprite","WindowLayer","_tempCanvas","_translationMatrix","_windowMask","endFill","_windowRect","graphicsData","_renderSprite","on","onRemoveAsAChild","removeChildren","renderable","realCanvasContext","beginPath","closePath","clip","openness","_canvasClearWindowRect","setTransform","renderSession","rx","ry","rw","rh","copy","filterManager","pushFilter","currentRenderer","start","rt","projectionMatrix","sourceFrame","_maskWindow","maskManager","pushScissorMask","popScissorMask","popFilter","_currentBounds","boundsDirty","Weather","_sprites","_createBitmaps","_createDimmer","power","_updateDimmer","_updateAllSprites","_rainBitmap","fillAll","_stormBitmap","_snowBitmap","drawCircle","_dimmerSprite","maxSprites","_addSprite","_removeSprite","_updateSprite","ax","ay","viewport","removeChild","pop","_updateRainSprite","_updateStormSprite","_updateSnowSprite","_rebornSprite","rotation","PI","sin","cos","ToneFilter","ColorMatrixFilter","adjustHue","hue","adjustSaturation","saturate","matrix","_loadMatrix","ToneSprite","_gray","t","worldTransform","resolution","c","d","Stage","interactive","WebAudio","_standAlone","_initialized","_loader","_load","_hasError","_url","_masterVolume","_masterGainNode","_unlocked","noAudio","_createContext","_detectCodecs","_createMasterGainNode","canPlayOgg","_canPlayOgg","canPlayM4a","_canPlayM4a","setMasterVolume","gain","setValueAtTime","currentTime","AudioContext","webkitAudioContext","audio","createGain","connect","destination","state","resume","_onVisibilityChange","node","createBufferSource","visibilityState","_onHide","_onShow","_shouldMuteOnHide","_fadeOut","_fadeIn","duration","linearRampToValueAtTime","stop","_buffer","_sourceNode","_gainNode","_pannerNode","_totalTime","_sampleRate","_loopStart","_loopLength","_startTime","_volume","_pitch","_pan","_endTimer","_loadListeners","_stopListeners","_autoPlay","isPlaying","loop","_updatePanner","offset","_startPlaying","_removeEndTimer","_removeNodes","listner","fadeIn","fadeOut","seek","pos","addStopListener","Decrypter","hasEncryptedAudio","extToEncryptExt","responseType","onload","status","_onXhrLoad","response","decryptArrayBuffer","_readLoopComments","Uint8Array","decodeAudioData","buffer","_onLoad","_createNodes","_connectNodes","_createEndTimer","loopStart","loopEnd","playbackRate","createPanner","panningModel","delay","clearTimeout","abs","setPosition","_readOgg","_readMp4","_readFourCharacters","vorbisHeaderFound","numSegments","segments","headerType","_readLittleEndian","_readMetaData","size","_readBigEndian","fromCharCode","parseInt","RegExp","$1","text2","Html5Audio","_audioElement","_gainTweenInterval","_tweenGain","_tweenTargetGain","_tweenGainStep","_staticSePath","setup","URL","revokeObjectURL","Audio","_onLoadedData","_onError","_onEnded","_isLoading","_buffered","setStaticSe","clearInterval","_tweenInterval","_startGainTween","listener","setInterval","_applyTweenValue","JsonEx","maxDepth","_generateId","stringify","object","circular","json","JSON","_encode","_cleanMetadata","_restoreCircularReference","circulars","content","parse","registry","contents","_decode","_linkCircularReference","makeDeepCopy","depth","toString","constructorName","_getConstructorName","_resetPrototype","undefined","func","exec","setPrototypeOf","__proto__","newValue","hasEncryptedImages","_requestImgFile","_headerlength","_xhrOk","_encryptionKey","_ignoreList","SIGNATURE","VER","REMAIN","checkImgIgnore","cnt","decryptImg","requestFile","arrayBuffer","_image","createBlobUrl","_loadListener","_errorListener","decryptHTML5Audio","bgm","AudioManager","createDecryptBuffer","cutArrayHeader","header","ref","refBytes","substr","DataView","readEncryptionkey","byteArray","setUint8","blob","Blob","createObjectURL","ext","encryptedExt","lastIndexOf","$dataSystem","encryptionKey","Boolean","_reloaders","_defaultRetryInterval","retryMethod","resignMethod","retryInterval","reloaders","retryCount","reloader"],"mappings":"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","file":"main.js","sourcesContent":["//=============================================================================\r\n// rpg_core.js v1.5.1\r\n//=============================================================================\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n * This is not a class, but contains some methods that will be added to the\r\n * standard Javascript objects.\r\n *\r\n * @class JsExtensions\r\n */\r\nfunction JsExtensions() {\r\n  throw new Error('This is not a class');\r\n}\r\n\r\n/**\r\n* Returns a number whose value is limited to the given range.\r\n*\r\n* @method Number.prototype.clamp\r\n* @param {Number} min The lower boundary\r\n* @param {Number} max The upper boundary\r\n* @return {Number} A number in the range (min, max)\r\n*/\r\nNumber.prototype.clamp = function(min, max) {\r\n  return Math.min(Math.max(this, min), max);\r\n};\r\n\r\n/**\r\n* Returns a modulo value which is always positive.\r\n*\r\n* @method Number.prototype.mod\r\n* @param {Number} n The divisor\r\n* @return {Number} A modulo value\r\n*/\r\nNumber.prototype.mod = function(n) {\r\n  return ((this % n) + n) % n;\r\n};\r\n\r\n/**\r\n* Replaces %1, %2 and so on in the string to the arguments.\r\n*\r\n* @method String.prototype.format\r\n* @param {Any} ...args The objects to format\r\n* @return {String} A formatted string\r\n*/\r\nString.prototype.format = function() {\r\n  var args = arguments;\r\n  return this.replace(/%([0-9]+)/g, function(s, n) {\r\n      return args[Number(n) - 1];\r\n  });\r\n};\r\n\r\n/**\r\n* Makes a number string with leading zeros.\r\n*\r\n* @method String.prototype.padZero\r\n* @param {Number} length The length of the output string\r\n* @return {String} A string with leading zeros\r\n*/\r\nString.prototype.padZero = function(length){\r\n  var s = this;\r\n  while (s.length < length) {\r\n      s = '0' + s;\r\n  }\r\n  return s;\r\n};\r\n\r\n/**\r\n* Makes a number string with leading zeros.\r\n*\r\n* @method Number.prototype.padZero\r\n* @param {Number} length The length of the output string\r\n* @return {String} A string with leading zeros\r\n*/\r\nNumber.prototype.padZero = function(length){\r\n  return String(this).padZero(length);\r\n};\r\n\r\nObject.defineProperties(Array.prototype, {\r\n  /**\r\n   * Checks whether the two arrays are same.\r\n   *\r\n   * @method Array.prototype.equals\r\n   * @param {Array} array The array to compare to\r\n   * @return {Boolean} True if the two arrays are same\r\n   */\r\n  equals: {\r\n      enumerable: false,\r\n      value: function(array) {\r\n          if (!array || this.length !== array.length) {\r\n              return false;\r\n          }\r\n          for (var i = 0; i < this.length; i++) {\r\n              if (this[i] instanceof Array && array[i] instanceof Array) {\r\n                  if (!this[i].equals(array[i])) {\r\n                      return false;\r\n                  }\r\n              } else if (this[i] !== array[i]) {\r\n                  return false;\r\n              }\r\n          }\r\n          return true;\r\n      }\r\n  },\r\n  /**\r\n   * Makes a shallow copy of the array.\r\n   *\r\n   * @method Array.prototype.clone\r\n   * @return {Array} A shallow copy of the array\r\n   */\r\n  clone: {\r\n      enumerable: false,\r\n      value: function() {\r\n          return this.slice(0);\r\n      }\r\n  },\r\n  /**\r\n   * Checks whether the array contains a given element.\r\n   *\r\n   * @method Array.prototype.contains\r\n   * @param {Any} element The element to search for\r\n   * @return {Boolean} True if the array contains a given element\r\n   */\r\n  contains : {\r\n      enumerable: false,\r\n      value: function(element) {\r\n          return this.indexOf(element) >= 0;\r\n      }\r\n  }\r\n});\r\n\r\n/**\r\n* Checks whether the string contains a given string.\r\n*\r\n* @method String.prototype.contains\r\n* @param {String} string The string to search for\r\n* @return {Boolean} True if the string contains a given string\r\n*/\r\nString.prototype.contains = function(string) {\r\n  return this.indexOf(string) >= 0;\r\n};\r\n\r\n/**\r\n* Generates a random integer in the range (0, max-1).\r\n*\r\n* @static\r\n* @method Math.randomInt\r\n* @param {Number} max The upper boundary (excluded)\r\n* @return {Number} A random integer\r\n*/\r\nMath.randomInt = function(max) {\r\n  return Math.floor(max * Math.random());\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The static class that defines utility methods.\r\n*\r\n* @class Utils\r\n*/\r\nfunction Utils() {\r\n  throw new Error('This is a static class');\r\n}\r\n\r\n/**\r\n* The name of the RPG Maker. 'MV' in the current version.\r\n*\r\n* @static\r\n* @property RPGMAKER_NAME\r\n* @type String\r\n* @final\r\n*/\r\nUtils.RPGMAKER_NAME = 'MV';\r\n\r\n/**\r\n* The version of the RPG Maker.\r\n*\r\n* @static\r\n* @property RPGMAKER_VERSION\r\n* @type String\r\n* @final\r\n*/\r\nUtils.RPGMAKER_VERSION = \"1.5.1\";\r\n\r\n/**\r\n* Checks whether the option is in the query string.\r\n*\r\n* @static\r\n* @method isOptionValid\r\n* @param {String} name The option name\r\n* @return {Boolean} True if the option is in the query string\r\n*/\r\nUtils.isOptionValid = function(name) {\r\n  return location.search.slice(1).split('&').contains(name);\r\n};\r\n\r\n/**\r\n* Checks whether the platform is NW.js.\r\n*\r\n* @static\r\n* @method isNwjs\r\n* @return {Boolean} True if the platform is NW.js\r\n*/\r\nUtils.isNwjs = function() {\r\n  return typeof require === 'function' && typeof process === 'object';\r\n};\r\n\r\n/**\r\n* Checks whether the platform is a mobile device.\r\n*\r\n* @static\r\n* @method isMobileDevice\r\n* @return {Boolean} True if the platform is a mobile device\r\n*/\r\nUtils.isMobileDevice = function() {\r\n  var r = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;\r\n  return !!navigator.userAgent.match(r);\r\n};\r\n\r\n/**\r\n* Checks whether the browser is Mobile Safari.\r\n*\r\n* @static\r\n* @method isMobileSafari\r\n* @return {Boolean} True if the browser is Mobile Safari\r\n*/\r\nUtils.isMobileSafari = function() {\r\n  var agent = navigator.userAgent;\r\n  return !!(agent.match(/iPhone|iPad|iPod/) && agent.match(/AppleWebKit/) &&\r\n            !agent.match('CriOS'));\r\n};\r\n\r\n/**\r\n* Checks whether the browser is Android Chrome.\r\n*\r\n* @static\r\n* @method isAndroidChrome\r\n* @return {Boolean} True if the browser is Android Chrome\r\n*/\r\nUtils.isAndroidChrome = function() {\r\n  var agent = navigator.userAgent;\r\n  return !!(agent.match(/Android/) && agent.match(/Chrome/));\r\n};\r\n\r\n/**\r\n* Checks whether the browser can read files in the game folder.\r\n*\r\n* @static\r\n* @method canReadGameFiles\r\n* @return {Boolean} True if the browser can read files in the game folder\r\n*/\r\nUtils.canReadGameFiles = function() {\r\n  var scripts = document.getElementsByTagName('script');\r\n  var lastScript = scripts[scripts.length - 1];\r\n  var xhr = new XMLHttpRequest();\r\n  try {\r\n      xhr.open('GET', lastScript.src);\r\n      xhr.overrideMimeType('text/javascript');\r\n      xhr.send();\r\n      return true;\r\n  } catch (e) {\r\n      return false;\r\n  }\r\n};\r\n\r\n/**\r\n* Makes a CSS color string from RGB values.\r\n*\r\n* @static\r\n* @method rgbToCssColor\r\n* @param {Number} r The red value in the range (0, 255)\r\n* @param {Number} g The green value in the range (0, 255)\r\n* @param {Number} b The blue value in the range (0, 255)\r\n* @return {String} CSS color string\r\n*/\r\nUtils.rgbToCssColor = function(r, g, b) {\r\n  r = Math.round(r);\r\n  g = Math.round(g);\r\n  b = Math.round(b);\r\n  return 'rgb(' + r + ',' + g + ',' + b + ')';\r\n};\r\n\r\nUtils._id = 1;\r\nUtils.generateRuntimeId = function(){\r\n  return Utils._id++;\r\n};\r\n\r\nUtils._supportPassiveEvent = null;\r\n/**\r\n* Test this browser support passive event feature\r\n*\r\n* @static\r\n* @method isSupportPassiveEvent\r\n* @return {Boolean} this browser support passive event or not\r\n*/\r\nUtils.isSupportPassiveEvent = function() {\r\n  if (typeof Utils._supportPassiveEvent === \"boolean\") {\r\n      return Utils._supportPassiveEvent;\r\n  }\r\n  // test support passive event\r\n  // https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md#feature-detection\r\n  var passive = false;\r\n  var options = Object.defineProperty({}, \"passive\", {\r\n      get: function() { passive = true; }\r\n  });\r\n  window.addEventListener(\"test\", null, options);\r\n  Utils._supportPassiveEvent = passive;\r\n  return passive;\r\n}\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The resource class. Allows to be collected as a garbage if not use for some time or ticks\r\n*\r\n* @class CacheEntry\r\n* @constructor\r\n* @param {ResourceManager} resource manager\r\n* @param {string} key, url of the resource\r\n* @param {string} item - Bitmap, HTML5Audio, WebAudio - whatever you want to store in the cache\r\n*/\r\nfunction CacheEntry(cache, key, item) {\r\n  this.cache = cache;\r\n  this.key = key;\r\n  this.item = item;\r\n  this.cached = false;\r\n  this.touchTicks = 0;\r\n  this.touchSeconds = 0;\r\n  this.ttlTicks = 0;\r\n  this.ttlSeconds = 0;\r\n  this.freedByTTL = false;\r\n}\r\n\r\n/**\r\n* frees the resource\r\n*/\r\nCacheEntry.prototype.free = function (byTTL) {\r\n  this.freedByTTL = byTTL || false;\r\n  if (this.cached) {\r\n      this.cached = false;\r\n      delete this.cache._inner[this.key];\r\n  }\r\n};\r\n\r\n/**\r\n* Allocates the resource\r\n* @returns {CacheEntry}\r\n*/\r\nCacheEntry.prototype.allocate = function () {\r\n  if (!this.cached) {\r\n      this.cache._inner[this.key] = this;\r\n      this.cached = true;\r\n  }\r\n  this.touch();\r\n  return this;\r\n};\r\n\r\n/**\r\n* Sets the time to live\r\n* @param {number} ticks TTL in ticks, 0 if not set\r\n* @param {number} time TTL in seconds, 0 if not set\r\n* @returns {CacheEntry}\r\n*/\r\nCacheEntry.prototype.setTimeToLive = function (ticks, seconds) {\r\n  this.ttlTicks = ticks || 0;\r\n  this.ttlSeconds = seconds || 0;\r\n  return this;\r\n};\r\n\r\nCacheEntry.prototype.isStillAlive = function () {\r\n  var cache = this.cache;\r\n  return ((this.ttlTicks == 0) || (this.touchTicks + this.ttlTicks < cache.updateTicks )) &&\r\n      ((this.ttlSeconds == 0) || (this.touchSeconds + this.ttlSeconds < cache.updateSeconds ));\r\n};\r\n\r\n/**\r\n* makes sure that resource wont freed by Time To Live\r\n* if resource was already freed by TTL, put it in cache again\r\n*/\r\nCacheEntry.prototype.touch = function () {\r\n  var cache = this.cache;\r\n  if (this.cached) {\r\n      this.touchTicks = cache.updateTicks;\r\n      this.touchSeconds = cache.updateSeconds;\r\n  } else if (this.freedByTTL) {\r\n      this.freedByTTL = false;\r\n      if (!cache._inner[this.key]) {\r\n          cache._inner[this.key] = this;\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* Cache for images, audio, or any other kind of resource\r\n* @param manager\r\n* @constructor\r\n*/\r\nfunction CacheMap(manager) {\r\n  this.manager = manager;\r\n  this._inner = {};\r\n  this._lastRemovedEntries = {};\r\n  this.updateTicks = 0;\r\n  this.lastCheckTTL = 0;\r\n  this.delayCheckTTL = 100.0;\r\n  this.updateSeconds = Date.now();\r\n}\r\n\r\n/**\r\n* checks ttl of all elements and removes dead ones\r\n*/\r\nCacheMap.prototype.checkTTL = function () {\r\n  var cache = this._inner;\r\n  var temp = this._lastRemovedEntries;\r\n  if (!temp) {\r\n      temp = [];\r\n      this._lastRemovedEntries = temp;\r\n  }\r\n  for (var key in cache) {\r\n      var entry = cache[key];\r\n      if (!entry.isStillAlive()) {\r\n          temp.push(entry);\r\n      }\r\n  }\r\n  for (var i = 0; i < temp.length; i++) {\r\n      temp[i].free(true);\r\n  }\r\n  temp.length = 0;\r\n};\r\n\r\n/**\r\n* cache item\r\n* @param key url of cache element\r\n* @returns {*|null}\r\n*/\r\nCacheMap.prototype.getItem = function (key) {\r\n  var entry = this._inner[key];\r\n  if (entry) {\r\n      return entry.item;\r\n  }\r\n  return null;\r\n};\r\n\r\nCacheMap.prototype.clear = function () {\r\n  var keys = Object.keys(this._inner);\r\n  for (var i = 0; i < keys.length; i++) {\r\n      this._inner[keys[i]].free();\r\n  }\r\n};\r\n\r\nCacheMap.prototype.setItem = function (key, item) {\r\n  return new CacheEntry(this, key, item).allocate();\r\n};\r\n\r\nCacheMap.prototype.update = function(ticks, delta) {\r\n  this.updateTicks += ticks;\r\n  this.updateSeconds += delta;\r\n  if (this.updateSeconds >= this.delayCheckTTL + this.lastCheckTTL) {\r\n      this.lastCheckTTL = this.updateSeconds;\r\n      this.checkTTL();\r\n  }\r\n};\r\n\r\nfunction ImageCache(){\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nImageCache.limit = 10 * 1000 * 1000;\r\n\r\nImageCache.prototype.initialize = function(){\r\n  this._items = {};\r\n};\r\n\r\nImageCache.prototype.add = function(key, value){\r\n  this._items[key] = {\r\n      bitmap: value,\r\n      touch: Date.now(),\r\n      key: key\r\n  };\r\n\r\n  this._truncateCache();\r\n};\r\n\r\nImageCache.prototype.get = function(key){\r\n  if(this._items[key]){\r\n      var item = this._items[key];\r\n      item.touch = Date.now();\r\n      return item.bitmap;\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nImageCache.prototype.reserve = function(key, value, reservationId){\r\n  if(!this._items[key]){\r\n      this._items[key] = {\r\n          bitmap: value,\r\n          touch: Date.now(),\r\n          key: key\r\n      };\r\n  }\r\n\r\n  this._items[key].reservationId = reservationId;\r\n};\r\n\r\nImageCache.prototype.releaseReservation = function(reservationId){\r\n  var items = this._items;\r\n\r\n  Object.keys(items)\r\n      .map(function(key){return items[key];})\r\n      .forEach(function(item){\r\n          if(item.reservationId === reservationId){\r\n              delete item.reservationId;\r\n          }\r\n      });\r\n};\r\n\r\nImageCache.prototype._truncateCache = function(){\r\n  var items = this._items;\r\n  var sizeLeft = ImageCache.limit;\r\n\r\n  Object.keys(items).map(function(key){\r\n      return items[key];\r\n  }).sort(function(a, b){\r\n      return b.touch - a.touch;\r\n  }).forEach(function(item){\r\n      if(sizeLeft > 0 || this._mustBeHeld(item)){\r\n          var bitmap = item.bitmap;\r\n          sizeLeft -= bitmap.width * bitmap.height;\r\n      }else{\r\n          delete items[item.key];\r\n      }\r\n  }.bind(this));\r\n};\r\n\r\nImageCache.prototype._mustBeHeld = function(item){\r\n  // request only is weak so It's purgeable\r\n  if(item.bitmap.isRequestOnly()) return false;\r\n  // reserved item must be held\r\n  if(item.reservationId) return true;\r\n  // not ready bitmap must be held (because of checking isReady())\r\n  if(!item.bitmap.isReady()) return true;\r\n  // then the item may purgeable\r\n  return false;\r\n};\r\n\r\nImageCache.prototype.isReady = function(){\r\n  var items = this._items;\r\n  return !Object.keys(items).some(function(key){\r\n      return !items[key].bitmap.isRequestOnly() && !items[key].bitmap.isReady();\r\n  });\r\n};\r\n\r\nImageCache.prototype.getErrorBitmap = function(){\r\n  var items = this._items;\r\n  var bitmap = null;\r\n  if(Object.keys(items).some(function(key){\r\n          if(items[key].bitmap.isError()){\r\n              bitmap = items[key].bitmap;\r\n              return true;\r\n          }\r\n          return false;\r\n      })) {\r\n      return bitmap;\r\n  }\r\n\r\n  return null;\r\n};\r\nfunction RequestQueue(){\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nRequestQueue.prototype.initialize = function(){\r\n  this._queue = [];\r\n};\r\n\r\nRequestQueue.prototype.enqueue = function(key, value){\r\n  this._queue.push({\r\n      key: key,\r\n      value: value,\r\n  });\r\n};\r\n\r\nRequestQueue.prototype.update = function(){\r\n  if(this._queue.length === 0) return;\r\n\r\n  var top = this._queue[0];\r\n  if(top.value.isRequestReady()){\r\n      this._queue.shift();\r\n      if(this._queue.length !== 0){\r\n          this._queue[0].value.startRequest();\r\n      }\r\n  }else{\r\n      top.value.startRequest();\r\n  }\r\n};\r\n\r\nRequestQueue.prototype.raisePriority = function(key){\r\n  for(var n = 0; n < this._queue.length; n++){\r\n      var item = this._queue[n];\r\n      if(item.key === key){\r\n          this._queue.splice(n, 1);\r\n          this._queue.unshift(item);\r\n          break;\r\n      }\r\n  }\r\n};\r\n\r\nRequestQueue.prototype.clear = function(){\r\n  this._queue.splice(0);\r\n};\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The point class.\r\n*\r\n* @class Point\r\n* @constructor\r\n* @param {Number} x The x coordinate\r\n* @param {Number} y The y coordinate\r\n*/\r\nfunction Point() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nPoint.prototype = Object.create(PIXI.Point.prototype);\r\nPoint.prototype.constructor = Point;\r\n\r\nPoint.prototype.initialize = function(x, y) {\r\n  PIXI.Point.call(this, x, y);\r\n};\r\n\r\n/**\r\n* The x coordinate.\r\n*\r\n* @property x\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* The y coordinate.\r\n*\r\n* @property y\r\n* @type Number\r\n*/\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The rectangle class.\r\n*\r\n* @class Rectangle\r\n* @constructor\r\n* @param {Number} x The x coordinate for the upper-left corner\r\n* @param {Number} y The y coordinate for the upper-left corner\r\n* @param {Number} width The width of the rectangle\r\n* @param {Number} height The height of the rectangle\r\n*/\r\nfunction Rectangle() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nRectangle.prototype = Object.create(PIXI.Rectangle.prototype);\r\nRectangle.prototype.constructor = Rectangle;\r\n\r\nRectangle.prototype.initialize = function(x, y, width, height) {\r\n  PIXI.Rectangle.call(this, x, y, width, height);\r\n};\r\n\r\n/**\r\n* @static\r\n* @property emptyRectangle\r\n* @type Rectangle\r\n* @private\r\n*/\r\nRectangle.emptyRectangle = new Rectangle(0, 0, 0, 0);\r\n\r\n/**\r\n* The x coordinate for the upper-left corner.\r\n*\r\n* @property x\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* The y coordinate for the upper-left corner.\r\n*\r\n* @property y\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* The width of the rectangle.\r\n*\r\n* @property width\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* The height of the rectangle.\r\n*\r\n* @property height\r\n* @type Number\r\n*/\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The static class that carries out graphics processing.\r\n*\r\n* @class Graphics\r\n*/\r\nfunction Graphics() {\r\n  throw new Error('This is a static class');\r\n}\r\n\r\nGraphics._cssFontLoading =  document.fonts && document.fonts.ready;\r\nGraphics._fontLoaded = null;\r\nGraphics._videoVolume = 1;\r\n\r\n/**\r\n* Initializes the graphics system.\r\n*\r\n* @static\r\n* @method initialize\r\n* @param {Number} width The width of the game screen\r\n* @param {Number} height The height of the game screen\r\n* @param {String} type The type of the renderer.\r\n*                 'canvas', 'webgl', or 'auto'.\r\n*/\r\nGraphics.initialize = function(width, height, type) {\r\n  this._width = width || 800;\r\n  this._height = height || 600;\r\n  this._rendererType = type || 'auto';\r\n  this._boxWidth = this._width;\r\n  this._boxHeight = this._height;\r\n\r\n  this._scale = 1;\r\n  this._realScale = 1;\r\n\r\n  this._errorShowed = false;\r\n  this._errorPrinter = null;\r\n  this._canvas = null;\r\n  this._video = null;\r\n  this._videoUnlocked = !Utils.isMobileDevice();\r\n  this._videoLoading = false;\r\n  this._upperCanvas = null;\r\n  this._renderer = null;\r\n  this._fpsMeter = null;\r\n  this._modeBox = null;\r\n  this._skipCount = 0;\r\n  this._maxSkip = 3;\r\n  this._rendered = false;\r\n  this._loadingImage = null;\r\n  this._loadingCount = 0;\r\n  this._fpsMeterToggled = false;\r\n  this._stretchEnabled = this._defaultStretchMode();\r\n\r\n  this._canUseDifferenceBlend = false;\r\n  this._canUseSaturationBlend = false;\r\n  this._hiddenCanvas = null;\r\n\r\n  this._testCanvasBlendModes();\r\n  this._modifyExistingElements();\r\n  this._updateRealScale();\r\n  this._createAllElements();\r\n  this._disableTextSelection();\r\n  this._disableContextMenu();\r\n  this._setupEventHandlers();\r\n  this._setupCssFontLoading();\r\n};\r\n\r\n\r\nGraphics._setupCssFontLoading = function(){\r\n  if(Graphics._cssFontLoading){\r\n      document.fonts.ready.then(function(fonts){\r\n          Graphics._fontLoaded = fonts;\r\n      }).catch(function(error){\r\n          SceneManager.onError(error);\r\n      });\r\n  }\r\n};\r\n\r\nGraphics.canUseCssFontLoading = function(){\r\n  return !!this._cssFontLoading;\r\n};\r\n\r\n/**\r\n* The total frame count of the game screen.\r\n*\r\n* @static\r\n* @property frameCount\r\n* @type Number\r\n*/\r\nGraphics.frameCount     = 0;\r\n\r\n/**\r\n* The alias of PIXI.blendModes.NORMAL.\r\n*\r\n* @static\r\n* @property BLEND_NORMAL\r\n* @type Number\r\n* @final\r\n*/\r\nGraphics.BLEND_NORMAL   = 0;\r\n\r\n/**\r\n* The alias of PIXI.blendModes.ADD.\r\n*\r\n* @static\r\n* @property BLEND_ADD\r\n* @type Number\r\n* @final\r\n*/\r\nGraphics.BLEND_ADD      = 1;\r\n\r\n/**\r\n* The alias of PIXI.blendModes.MULTIPLY.\r\n*\r\n* @static\r\n* @property BLEND_MULTIPLY\r\n* @type Number\r\n* @final\r\n*/\r\nGraphics.BLEND_MULTIPLY = 2;\r\n\r\n/**\r\n* The alias of PIXI.blendModes.SCREEN.\r\n*\r\n* @static\r\n* @property BLEND_SCREEN\r\n* @type Number\r\n* @final\r\n*/\r\nGraphics.BLEND_SCREEN   = 3;\r\n\r\n/**\r\n* Marks the beginning of each frame for FPSMeter.\r\n*\r\n* @static\r\n* @method tickStart\r\n*/\r\nGraphics.tickStart = function() {\r\n  if (this._fpsMeter) {\r\n      this._fpsMeter.tickStart();\r\n  }\r\n};\r\n\r\n/**\r\n* Marks the end of each frame for FPSMeter.\r\n*\r\n* @static\r\n* @method tickEnd\r\n*/\r\nGraphics.tickEnd = function() {\r\n  if (this._fpsMeter && this._rendered) {\r\n      this._fpsMeter.tick();\r\n  }\r\n};\r\n\r\n/**\r\n* Renders the stage to the game screen.\r\n*\r\n* @static\r\n* @method render\r\n* @param {Stage} stage The stage object to be rendered\r\n*/\r\nGraphics.render = function(stage) {\r\n  if (this._skipCount === 0) {\r\n      var startTime = Date.now();\r\n      if (stage) {\r\n          this._renderer.render(stage);\r\n          if (this._renderer.gl && this._renderer.gl.flush) {\r\n              this._renderer.gl.flush();\r\n          }\r\n      }\r\n      var endTime = Date.now();\r\n      var elapsed = endTime - startTime;\r\n      this._skipCount = Math.min(Math.floor(elapsed / 15), this._maxSkip);\r\n      this._rendered = true;\r\n  } else {\r\n      this._skipCount--;\r\n      this._rendered = false;\r\n  }\r\n  this.frameCount++;\r\n};\r\n\r\n/**\r\n* Checks whether the renderer type is WebGL.\r\n*\r\n* @static\r\n* @method isWebGL\r\n* @return {Boolean} True if the renderer type is WebGL\r\n*/\r\nGraphics.isWebGL = function() {\r\n  return this._renderer && this._renderer.type === PIXI.RENDERER_TYPE.WEBGL;\r\n};\r\n\r\n/**\r\n* Checks whether the current browser supports WebGL.\r\n*\r\n* @static\r\n* @method hasWebGL\r\n* @return {Boolean} True if the current browser supports WebGL.\r\n*/\r\nGraphics.hasWebGL = function() {\r\n  try {\r\n      var canvas = document.createElement('canvas');\r\n      return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));\r\n  } catch (e) {\r\n      return false;\r\n  }\r\n};\r\n\r\n/**\r\n* Checks whether the canvas blend mode 'difference' is supported.\r\n*\r\n* @static\r\n* @method canUseDifferenceBlend\r\n* @return {Boolean} True if the canvas blend mode 'difference' is supported\r\n*/\r\nGraphics.canUseDifferenceBlend = function() {\r\n  return this._canUseDifferenceBlend;\r\n};\r\n\r\n/**\r\n* Checks whether the canvas blend mode 'saturation' is supported.\r\n*\r\n* @static\r\n* @method canUseSaturationBlend\r\n* @return {Boolean} True if the canvas blend mode 'saturation' is supported\r\n*/\r\nGraphics.canUseSaturationBlend = function() {\r\n  return this._canUseSaturationBlend;\r\n};\r\n\r\n/**\r\n* Sets the source of the \"Now Loading\" image.\r\n*\r\n* @static\r\n* @method setLoadingImage\r\n*/\r\nGraphics.setLoadingImage = function(src) {\r\n  this._loadingImage = new Image();\r\n  this._loadingImage.src = src;\r\n};\r\n\r\n/**\r\n* Initializes the counter for displaying the \"Now Loading\" image.\r\n*\r\n* @static\r\n* @method startLoading\r\n*/\r\nGraphics.startLoading = function() {\r\n  this._loadingCount = 0;\r\n};\r\n\r\n/**\r\n* Increments the loading counter and displays the \"Now Loading\" image if necessary.\r\n*\r\n* @static\r\n* @method updateLoading\r\n*/\r\nGraphics.updateLoading = function() {\r\n  this._loadingCount++;\r\n  this._paintUpperCanvas();\r\n  this._upperCanvas.style.opacity = 1;\r\n};\r\n\r\n/**\r\n* Erases the \"Now Loading\" image.\r\n*\r\n* @static\r\n* @method endLoading\r\n*/\r\nGraphics.endLoading = function() {\r\n  this._clearUpperCanvas();\r\n  this._upperCanvas.style.opacity = 0;\r\n};\r\n\r\n/**\r\n* Displays the loading error text to the screen.\r\n*\r\n* @static\r\n* @method printLoadingError\r\n* @param {String} url The url of the resource failed to load\r\n*/\r\nGraphics.printLoadingError = function(url) {\r\n  if (this._errorPrinter && !this._errorShowed) {\r\n      this._errorPrinter.innerHTML = this._makeErrorHtml('Loading Error', 'Failed to load: ' + url);\r\n      var button = document.createElement('button');\r\n      button.innerHTML = 'Retry';\r\n      button.style.fontSize = '24px';\r\n      button.style.color = '#ffffff';\r\n      button.style.backgroundColor = '#000000';\r\n      button.onmousedown = button.ontouchstart = function(event) {\r\n          ResourceHandler.retry();\r\n          event.stopPropagation();\r\n      };\r\n      this._errorPrinter.appendChild(button);\r\n      this._loadingCount = -Infinity;\r\n  }\r\n};\r\n\r\n/**\r\n* Erases the loading error text.\r\n*\r\n* @static\r\n* @method eraseLoadingError\r\n*/\r\nGraphics.eraseLoadingError = function() {\r\n  if (this._errorPrinter && !this._errorShowed) {\r\n      this._errorPrinter.innerHTML = '';\r\n      this.startLoading();\r\n  }\r\n};\r\n\r\n/**\r\n* Displays the error text to the screen.\r\n*\r\n* @static\r\n* @method printError\r\n* @param {String} name The name of the error\r\n* @param {String} message The message of the error\r\n*/\r\nGraphics.printError = function(name, message) {\r\n  this._errorShowed = true;\r\n  if (this._errorPrinter) {\r\n      this._errorPrinter.innerHTML = this._makeErrorHtml(name, message);\r\n  }\r\n  this._applyCanvasFilter();\r\n  this._clearUpperCanvas();\r\n};\r\n\r\n/**\r\n* Shows the FPSMeter element.\r\n*\r\n* @static\r\n* @method showFps\r\n*/\r\nGraphics.showFps = function() {\r\n  if (this._fpsMeter) {\r\n      this._fpsMeter.show();\r\n      this._modeBox.style.opacity = 1;\r\n  }\r\n};\r\n\r\n/**\r\n* Hides the FPSMeter element.\r\n*\r\n* @static\r\n* @method hideFps\r\n*/\r\nGraphics.hideFps = function() {\r\n  if (this._fpsMeter) {\r\n      this._fpsMeter.hide();\r\n      this._modeBox.style.opacity = 0;\r\n  }\r\n};\r\n\r\n/**\r\n* Loads a font file.\r\n*\r\n* @static\r\n* @method loadFont\r\n* @param {String} name The face name of the font\r\n* @param {String} url The url of the font file\r\n*/\r\nGraphics.loadFont = function(name, url) {\r\n  var style = document.createElement('style');\r\n  var head = document.getElementsByTagName('head');\r\n  var rule = '@font-face { font-family: \"' + name + '\"; src: url(\"' + url + '\"); }';\r\n  style.type = 'text/css';\r\n  head.item(0).appendChild(style);\r\n  style.sheet.insertRule(rule, 0);\r\n  this._createFontLoader(name);\r\n};\r\n\r\n/**\r\n* Checks whether the font file is loaded.\r\n*\r\n* @static\r\n* @method isFontLoaded\r\n* @param {String} name The face name of the font\r\n* @return {Boolean} True if the font file is loaded\r\n*/\r\nGraphics.isFontLoaded = function(name) {\r\n  if (Graphics._cssFontLoading) {\r\n      if(Graphics._fontLoaded){\r\n          return Graphics._fontLoaded.check('10px \"'+name+'\"');\r\n      }\r\n\r\n      return false;\r\n  } else {\r\n      if (!this._hiddenCanvas) {\r\n          this._hiddenCanvas = document.createElement('canvas');\r\n      }\r\n      var context = this._hiddenCanvas.getContext('2d');\r\n      var text = 'abcdefghijklmnopqrstuvwxyz';\r\n      var width1, width2;\r\n      context.font = '40px ' + name + ', sans-serif';\r\n      width1 = context.measureText(text).width;\r\n      context.font = '40px sans-serif';\r\n      width2 = context.measureText(text).width;\r\n      return width1 !== width2;\r\n  }\r\n};\r\n\r\n/**\r\n* Starts playback of a video.\r\n*\r\n* @static\r\n* @method playVideo\r\n* @param {String} src\r\n*/\r\nGraphics.playVideo = function(src) {\r\n  this._videoLoader = ResourceHandler.createLoader(null, this._playVideo.bind(this, src), this._onVideoError.bind(this));\r\n  this._playVideo(src);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _playVideo\r\n* @param {String} src\r\n* @private\r\n*/\r\nGraphics._playVideo = function(src) {\r\n  this._video.src = src;\r\n  this._video.onloadeddata = this._onVideoLoad.bind(this);\r\n  this._video.onerror = this._videoLoader;\r\n  this._video.onended = this._onVideoEnd.bind(this);\r\n  this._video.load();\r\n  this._videoLoading = true;\r\n};\r\n\r\n/**\r\n* Checks whether the video is playing.\r\n*\r\n* @static\r\n* @method isVideoPlaying\r\n* @return {Boolean} True if the video is playing\r\n*/\r\nGraphics.isVideoPlaying = function() {\r\n  return this._videoLoading || this._isVideoVisible();\r\n};\r\n\r\n/**\r\n* Checks whether the browser can play the specified video type.\r\n*\r\n* @static\r\n* @method canPlayVideoType\r\n* @param {String} type The video type to test support for\r\n* @return {Boolean} True if the browser can play the specified video type\r\n*/\r\nGraphics.canPlayVideoType = function(type) {\r\n  return this._video && this._video.canPlayType(type);\r\n};\r\n\r\n/**\r\n* Sets volume of a video.\r\n*\r\n* @static\r\n* @method setVideoVolume\r\n* @param {Number} value\r\n*/\r\nGraphics.setVideoVolume = function(value) {\r\n  this._videoVolume = value;\r\n  if (this._video) {\r\n      this._video.volume = this._videoVolume;\r\n  }\r\n};\r\n\r\n/**\r\n* Converts an x coordinate on the page to the corresponding\r\n* x coordinate on the canvas area.\r\n*\r\n* @static\r\n* @method pageToCanvasX\r\n* @param {Number} x The x coordinate on the page to be converted\r\n* @return {Number} The x coordinate on the canvas area\r\n*/\r\nGraphics.pageToCanvasX = function(x) {\r\n  if (this._canvas) {\r\n      var left = this._canvas.offsetLeft;\r\n      return Math.round((x - left) / this._realScale);\r\n  } else {\r\n      return 0;\r\n  }\r\n};\r\n\r\n/**\r\n* Converts a y coordinate on the page to the corresponding\r\n* y coordinate on the canvas area.\r\n*\r\n* @static\r\n* @method pageToCanvasY\r\n* @param {Number} y The y coordinate on the page to be converted\r\n* @return {Number} The y coordinate on the canvas area\r\n*/\r\nGraphics.pageToCanvasY = function(y) {\r\n  if (this._canvas) {\r\n      var top = this._canvas.offsetTop;\r\n      return Math.round((y - top) / this._realScale);\r\n  } else {\r\n      return 0;\r\n  }\r\n};\r\n\r\n/**\r\n* Checks whether the specified point is inside the game canvas area.\r\n*\r\n* @static\r\n* @method isInsideCanvas\r\n* @param {Number} x The x coordinate on the canvas area\r\n* @param {Number} y The y coordinate on the canvas area\r\n* @return {Boolean} True if the specified point is inside the game canvas area\r\n*/\r\nGraphics.isInsideCanvas = function(x, y) {\r\n  return (x >= 0 && x < this._width && y >= 0 && y < this._height);\r\n};\r\n\r\n/**\r\n* Calls pixi.js garbage collector\r\n*/\r\nGraphics.callGC = function() {\r\n  if (Graphics.isWebGL()) {\r\n      Graphics._renderer.textureGC.run();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n* The width of the game screen.\r\n*\r\n* @static\r\n* @property width\r\n* @type Number\r\n*/\r\nObject.defineProperty(Graphics, 'width', {\r\n  get: function() {\r\n      return this._width;\r\n  },\r\n  set: function(value) {\r\n      if (this._width !== value) {\r\n          this._width = value;\r\n          this._updateAllElements();\r\n      }\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The height of the game screen.\r\n*\r\n* @static\r\n* @property height\r\n* @type Number\r\n*/\r\nObject.defineProperty(Graphics, 'height', {\r\n  get: function() {\r\n      return this._height;\r\n  },\r\n  set: function(value) {\r\n      if (this._height !== value) {\r\n          this._height = value;\r\n          this._updateAllElements();\r\n      }\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The width of the window display area.\r\n*\r\n* @static\r\n* @property boxWidth\r\n* @type Number\r\n*/\r\nObject.defineProperty(Graphics, 'boxWidth', {\r\n  get: function() {\r\n      return this._boxWidth;\r\n  },\r\n  set: function(value) {\r\n      this._boxWidth = value;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The height of the window display area.\r\n*\r\n* @static\r\n* @property boxHeight\r\n* @type Number\r\n*/\r\nObject.defineProperty(Graphics, 'boxHeight', {\r\n  get: function() {\r\n      return this._boxHeight;\r\n  },\r\n  set: function(value) {\r\n      this._boxHeight = value;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The zoom scale of the game screen.\r\n*\r\n* @static\r\n* @property scale\r\n* @type Number\r\n*/\r\nObject.defineProperty(Graphics, 'scale', {\r\n  get: function() {\r\n      return this._scale;\r\n  },\r\n  set: function(value) {\r\n      if (this._scale !== value) {\r\n          this._scale = value;\r\n          this._updateAllElements();\r\n      }\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* @static\r\n* @method _createAllElements\r\n* @private\r\n*/\r\nGraphics._createAllElements = function() {\r\n  this._createErrorPrinter();\r\n  this._createCanvas();\r\n  this._createVideo();\r\n  this._createUpperCanvas();\r\n  this._createRenderer();\r\n  this._createFPSMeter();\r\n  this._createModeBox();\r\n  this._createGameFontLoader();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _updateAllElements\r\n* @private\r\n*/\r\nGraphics._updateAllElements = function() {\r\n  this._updateRealScale();\r\n  this._updateErrorPrinter();\r\n  this._updateCanvas();\r\n  this._updateVideo();\r\n  this._updateUpperCanvas();\r\n  this._updateRenderer();\r\n  this._paintUpperCanvas();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _updateRealScale\r\n* @private\r\n*/\r\nGraphics._updateRealScale = function() {\r\n  if (this._stretchEnabled) {\r\n      var h = window.innerWidth / this._width;\r\n      var v = window.innerHeight / this._height;\r\n      this._realScale = Math.min(h, v);\r\n  } else {\r\n      this._realScale = this._scale;\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _makeErrorHtml\r\n* @param {String} name\r\n* @param {String} message\r\n* @return {String}\r\n* @private\r\n*/\r\nGraphics._makeErrorHtml = function(name, message) {\r\n  return ('<font color=\"yellow\"><b>' + name + '</b></font><br>' +\r\n          '<font color=\"white\">' + message + '</font><br>');\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _defaultStretchMode\r\n* @private\r\n*/\r\nGraphics._defaultStretchMode = function() {\r\n  return Utils.isNwjs() || Utils.isMobileDevice();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _testCanvasBlendModes\r\n* @private\r\n*/\r\nGraphics._testCanvasBlendModes = function() {\r\n  var canvas, context, imageData1, imageData2;\r\n  canvas = document.createElement('canvas');\r\n  canvas.width = 1;\r\n  canvas.height = 1;\r\n  context = canvas.getContext('2d');\r\n  context.globalCompositeOperation = 'source-over';\r\n  context.fillStyle = 'white';\r\n  context.fillRect(0, 0, 1, 1);\r\n  context.globalCompositeOperation = 'difference';\r\n  context.fillStyle = 'white';\r\n  context.fillRect(0, 0, 1, 1);\r\n  imageData1 = context.getImageData(0, 0, 1, 1);\r\n  context.globalCompositeOperation = 'source-over';\r\n  context.fillStyle = 'black';\r\n  context.fillRect(0, 0, 1, 1);\r\n  context.globalCompositeOperation = 'saturation';\r\n  context.fillStyle = 'white';\r\n  context.fillRect(0, 0, 1, 1);\r\n  imageData2 = context.getImageData(0, 0, 1, 1);\r\n  this._canUseDifferenceBlend = imageData1.data[0] === 0;\r\n  this._canUseSaturationBlend = imageData2.data[0] === 0;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _modifyExistingElements\r\n* @private\r\n*/\r\nGraphics._modifyExistingElements = function() {\r\n  var elements = document.getElementsByTagName('*');\r\n  for (var i = 0; i < elements.length; i++) {\r\n      if (elements[i].style.zIndex > 0) {\r\n          elements[i].style.zIndex = 0;\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createErrorPrinter\r\n* @private\r\n*/\r\nGraphics._createErrorPrinter = function() {\r\n  this._errorPrinter = document.createElement('p');\r\n  this._errorPrinter.id = 'ErrorPrinter';\r\n  this._updateErrorPrinter();\r\n  document.body.appendChild(this._errorPrinter);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _updateErrorPrinter\r\n* @private\r\n*/\r\nGraphics._updateErrorPrinter = function() {\r\n  this._errorPrinter.width = this._width * 0.9;\r\n  this._errorPrinter.height = 40;\r\n  this._errorPrinter.style.textAlign = 'center';\r\n  this._errorPrinter.style.textShadow = '1px 1px 3px #000';\r\n  this._errorPrinter.style.fontSize = '20px';\r\n  this._errorPrinter.style.zIndex = 99;\r\n  this._centerElement(this._errorPrinter);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createCanvas\r\n* @private\r\n*/\r\nGraphics._createCanvas = function() {\r\n  this._canvas = document.createElement('canvas');\r\n  this._canvas.id = 'GameCanvas';\r\n  this._updateCanvas();\r\n  document.body.appendChild(this._canvas);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _updateCanvas\r\n* @private\r\n*/\r\nGraphics._updateCanvas = function() {\r\n  this._canvas.width = this._width;\r\n  this._canvas.height = this._height;\r\n  this._canvas.style.zIndex = 1;\r\n  this._centerElement(this._canvas);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createVideo\r\n* @private\r\n*/\r\nGraphics._createVideo = function() {\r\n  this._video = document.createElement('video');\r\n  this._video.id = 'GameVideo';\r\n  this._video.style.opacity = 0;\r\n  this._video.setAttribute('playsinline', '');\r\n  this._video.volume = this._videoVolume;\r\n  this._updateVideo();\r\n  makeVideoPlayableInline(this._video);\r\n  document.body.appendChild(this._video);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _updateVideo\r\n* @private\r\n*/\r\nGraphics._updateVideo = function() {\r\n  this._video.width = this._width;\r\n  this._video.height = this._height;\r\n  this._video.style.zIndex = 2;\r\n  this._centerElement(this._video);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createUpperCanvas\r\n* @private\r\n*/\r\nGraphics._createUpperCanvas = function() {\r\n  this._upperCanvas = document.createElement('canvas');\r\n  this._upperCanvas.id = 'UpperCanvas';\r\n  this._updateUpperCanvas();\r\n  document.body.appendChild(this._upperCanvas);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _updateUpperCanvas\r\n* @private\r\n*/\r\nGraphics._updateUpperCanvas = function() {\r\n  this._upperCanvas.width = this._width;\r\n  this._upperCanvas.height = this._height;\r\n  this._upperCanvas.style.zIndex = 3;\r\n  this._centerElement(this._upperCanvas);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _clearUpperCanvas\r\n* @private\r\n*/\r\nGraphics._clearUpperCanvas = function() {\r\n  var context = this._upperCanvas.getContext('2d');\r\n  context.clearRect(0, 0, this._width, this._height);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _paintUpperCanvas\r\n* @private\r\n*/\r\nGraphics._paintUpperCanvas = function() {\r\n  this._clearUpperCanvas();\r\n  if (this._loadingImage && this._loadingCount >= 20) {\r\n      var context = this._upperCanvas.getContext('2d');\r\n      var dx = (this._width - this._loadingImage.width) / 2;\r\n      var dy = (this._height - this._loadingImage.height) / 2;\r\n      var alpha = ((this._loadingCount - 20) / 30).clamp(0, 1);\r\n      context.save();\r\n      context.globalAlpha = alpha;\r\n      context.drawImage(this._loadingImage, dx, dy);\r\n      context.restore();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createRenderer\r\n* @private\r\n*/\r\nGraphics._createRenderer = function() {\r\n  PIXI.dontSayHello = true;\r\n  var width = this._width;\r\n  var height = this._height;\r\n  var options = { view: this._canvas };\r\n  try {\r\n      switch (this._rendererType) {\r\n      case 'canvas':\r\n          this._renderer = new PIXI.CanvasRenderer(width, height, options);\r\n          break;\r\n      case 'webgl':\r\n          this._renderer = new PIXI.WebGLRenderer(width, height, options);\r\n          break;\r\n      default:\r\n          this._renderer = PIXI.autoDetectRenderer(width, height, options);\r\n          break;\r\n      }\r\n\r\n      if(this._renderer && this._renderer.textureGC)\r\n          this._renderer.textureGC.maxIdle = 1;\r\n\r\n  } catch (e) {\r\n      this._renderer = null;\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _updateRenderer\r\n* @private\r\n*/\r\nGraphics._updateRenderer = function() {\r\n  if (this._renderer) {\r\n      this._renderer.resize(this._width, this._height);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createFPSMeter\r\n* @private\r\n*/\r\nGraphics._createFPSMeter = function() {\r\n  var options = { graph: 1, decimals: 0, theme: 'transparent', toggleOn: null };\r\n  this._fpsMeter = new FPSMeter(options);\r\n  this._fpsMeter.hide();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createModeBox\r\n* @private\r\n*/\r\nGraphics._createModeBox = function() {\r\n  var box = document.createElement('div');\r\n  box.id = 'modeTextBack';\r\n  box.style.position = 'absolute';\r\n  box.style.left = '5px';\r\n  box.style.top = '5px';\r\n  box.style.width = '119px';\r\n  box.style.height = '58px';\r\n  box.style.background = 'rgba(0,0,0,0.2)';\r\n  box.style.zIndex = 9;\r\n  box.style.opacity = 0;\r\n\r\n  var text = document.createElement('div');\r\n  text.id = 'modeText';\r\n  text.style.position = 'absolute';\r\n  text.style.left = '0px';\r\n  text.style.top = '41px';\r\n  text.style.width = '119px';\r\n  text.style.fontSize = '12px';\r\n  text.style.fontFamily = 'monospace';\r\n  text.style.color = 'white';\r\n  text.style.textAlign = 'center';\r\n  text.style.textShadow = '1px 1px 0 rgba(0,0,0,0.5)';\r\n  text.innerHTML = this.isWebGL() ? 'WebGL mode' : 'Canvas mode';\r\n\r\n  document.body.appendChild(box);\r\n  box.appendChild(text);\r\n\r\n  this._modeBox = box;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createGameFontLoader\r\n* @private\r\n*/\r\nGraphics._createGameFontLoader = function() {\r\n  this._createFontLoader('GameFont');\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createFontLoader\r\n* @param {String} name\r\n* @private\r\n*/\r\nGraphics._createFontLoader = function(name) {\r\n  var div = document.createElement('div');\r\n  var text = document.createTextNode('.');\r\n  div.style.fontFamily = name;\r\n  div.style.fontSize = '0px';\r\n  div.style.color = 'transparent';\r\n  div.style.position = 'absolute';\r\n  div.style.margin = 'auto';\r\n  div.style.top = '0px';\r\n  div.style.left = '0px';\r\n  div.style.width = '1px';\r\n  div.style.height = '1px';\r\n  div.appendChild(text);\r\n  document.body.appendChild(div);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _centerElement\r\n* @param {HTMLElement} element\r\n* @private\r\n*/\r\nGraphics._centerElement = function(element) {\r\n  var width = element.width * this._realScale;\r\n  var height = element.height * this._realScale;\r\n  element.style.position = 'absolute';\r\n  element.style.margin = 'auto';\r\n  element.style.top = 0;\r\n  element.style.left = 0;\r\n  element.style.right = 0;\r\n  element.style.bottom = 0;\r\n  element.style.width = width + 'px';\r\n  element.style.height = height + 'px';\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _disableTextSelection\r\n* @private\r\n*/\r\nGraphics._disableTextSelection = function() {\r\n  var body = document.body;\r\n  body.style.userSelect = 'none';\r\n  body.style.webkitUserSelect = 'none';\r\n  body.style.msUserSelect = 'none';\r\n  body.style.mozUserSelect = 'none';\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _disableContextMenu\r\n* @private\r\n*/\r\nGraphics._disableContextMenu = function() {\r\n  var elements = document.body.getElementsByTagName('*');\r\n  var oncontextmenu = function() { return false; };\r\n  for (var i = 0; i < elements.length; i++) {\r\n      elements[i].oncontextmenu = oncontextmenu;\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _applyCanvasFilter\r\n* @private\r\n*/\r\nGraphics._applyCanvasFilter = function() {\r\n  if (this._canvas) {\r\n      this._canvas.style.opacity = 0.5;\r\n      this._canvas.style.filter = 'blur(8px)';\r\n      this._canvas.style.webkitFilter = 'blur(8px)';\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onVideoLoad\r\n* @private\r\n*/\r\nGraphics._onVideoLoad = function() {\r\n  this._video.play();\r\n  this._updateVisibility(true);\r\n  this._videoLoading = false;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onVideoError\r\n* @private\r\n*/\r\nGraphics._onVideoError = function() {\r\n  this._updateVisibility(false);\r\n  this._videoLoading = false;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onVideoEnd\r\n* @private\r\n*/\r\nGraphics._onVideoEnd = function() {\r\n  this._updateVisibility(false);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _updateVisibility\r\n* @param {Boolean} videoVisible\r\n* @private\r\n*/\r\nGraphics._updateVisibility = function(videoVisible) {\r\n  this._video.style.opacity = videoVisible ? 1 : 0;\r\n  this._canvas.style.opacity = videoVisible ? 0 : 1;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _isVideoVisible\r\n* @return {Boolean}\r\n* @private\r\n*/\r\nGraphics._isVideoVisible = function() {\r\n  return this._video.style.opacity > 0;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _setupEventHandlers\r\n* @private\r\n*/\r\nGraphics._setupEventHandlers = function() {\r\n  window.addEventListener('resize', this._onWindowResize.bind(this));\r\n  document.addEventListener('keydown', this._onKeyDown.bind(this));\r\n  document.addEventListener('touchend', this._onTouchEnd.bind(this));\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onWindowResize\r\n* @private\r\n*/\r\nGraphics._onWindowResize = function() {\r\n  this._updateAllElements();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onKeyDown\r\n* @param {KeyboardEvent} event\r\n* @private\r\n*/\r\nGraphics._onKeyDown = function(event) {\r\n  if (!event.ctrlKey && !event.altKey) {\r\n      switch (event.keyCode) {\r\n      case 113:   // F2\r\n          event.preventDefault();\r\n          this._switchFPSMeter();\r\n          break;\r\n      case 114:   // F3\r\n          event.preventDefault();\r\n          this._switchStretchMode();\r\n          break;\r\n      case 115:   // F4\r\n          event.preventDefault();\r\n          this._switchFullScreen();\r\n          break;\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onTouchEnd\r\n* @param {TouchEvent} event\r\n* @private\r\n*/\r\nGraphics._onTouchEnd = function(event) {\r\n  if (!this._videoUnlocked) {\r\n      this._video.play();\r\n      this._videoUnlocked = true;\r\n  }\r\n  if (this._isVideoVisible() && this._video.paused) {\r\n      this._video.play();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _switchFPSMeter\r\n* @private\r\n*/\r\nGraphics._switchFPSMeter = function() {\r\n  if (this._fpsMeter.isPaused) {\r\n      this.showFps();\r\n      this._fpsMeter.showFps();\r\n      this._fpsMeterToggled = false;\r\n  } else if (!this._fpsMeterToggled) {\r\n      this._fpsMeter.showDuration();\r\n      this._fpsMeterToggled = true;\r\n  } else {\r\n      this.hideFps();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _switchStretchMode\r\n* @return {Boolean}\r\n* @private\r\n*/\r\nGraphics._switchStretchMode = function() {\r\n  this._stretchEnabled = !this._stretchEnabled;\r\n  this._updateAllElements();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _switchFullScreen\r\n* @private\r\n*/\r\nGraphics._switchFullScreen = function() {\r\n  if (this._isFullScreen()) {\r\n      this._requestFullScreen();\r\n  } else {\r\n      this._cancelFullScreen();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _isFullScreen\r\n* @return {Boolean}\r\n* @private\r\n*/\r\nGraphics._isFullScreen = function() {\r\n  return ((document.fullScreenElement && document.fullScreenElement !== null) ||\r\n          (!document.mozFullScreen && !document.webkitFullscreenElement &&\r\n           !document.msFullscreenElement));\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _requestFullScreen\r\n* @private\r\n*/\r\nGraphics._requestFullScreen = function() {\r\n  var element = document.body;\r\n  if (element.requestFullScreen) {\r\n      element.requestFullScreen();\r\n  } else if (element.mozRequestFullScreen) {\r\n      element.mozRequestFullScreen();\r\n  } else if (element.webkitRequestFullScreen) {\r\n      element.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\r\n  } else if (element.msRequestFullscreen) {\r\n      element.msRequestFullscreen();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _cancelFullScreen\r\n* @private\r\n*/\r\nGraphics._cancelFullScreen = function() {\r\n  if (document.cancelFullScreen) {\r\n      document.cancelFullScreen();\r\n  } else if (document.mozCancelFullScreen) {\r\n      document.mozCancelFullScreen();\r\n  } else if (document.webkitCancelFullScreen) {\r\n      document.webkitCancelFullScreen();\r\n  } else if (document.msExitFullscreen) {\r\n      document.msExitFullscreen();\r\n  }\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The static class that handles input data from the keyboard and gamepads.\r\n*\r\n* @class Input\r\n*/\r\nfunction Input() {\r\n  throw new Error('This is a static class');\r\n}\r\n\r\n/**\r\n* Initializes the input system.\r\n*\r\n* @static\r\n* @method initialize\r\n*/\r\nInput.initialize = function() {\r\n  this.clear();\r\n  this._wrapNwjsAlert();\r\n  this._setupEventHandlers();\r\n};\r\n\r\n/**\r\n* The wait time of the key repeat in frames.\r\n*\r\n* @static\r\n* @property keyRepeatWait\r\n* @type Number\r\n*/\r\nInput.keyRepeatWait = 24;\r\n\r\n/**\r\n* The interval of the key repeat in frames.\r\n*\r\n* @static\r\n* @property keyRepeatInterval\r\n* @type Number\r\n*/\r\nInput.keyRepeatInterval = 6;\r\n\r\n/**\r\n* A hash table to convert from a virtual key code to a mapped key name.\r\n*\r\n* @static\r\n* @property keyMapper\r\n* @type Object\r\n*/\r\nInput.keyMapper = {\r\n  9: 'tab',       // tab\r\n  13: 'ok',       // enter\r\n  16: 'shift',    // shift\r\n  17: 'control',  // control\r\n  18: 'control',  // alt\r\n  27: 'escape',   // escape\r\n  32: 'ok',       // space\r\n  33: 'pageup',   // pageup\r\n  34: 'pagedown', // pagedown\r\n  37: 'left',     // left arrow\r\n  38: 'up',       // up arrow\r\n  39: 'right',    // right arrow\r\n  40: 'down',     // down arrow\r\n  45: 'escape',   // insert\r\n  81: 'pageup',   // Q\r\n  87: 'pagedown', // W\r\n  88: 'escape',   // X\r\n  90: 'ok',       // Z\r\n  96: 'escape',   // numpad 0\r\n  98: 'down',     // numpad 2\r\n  100: 'left',    // numpad 4\r\n  102: 'right',   // numpad 6\r\n  104: 'up',      // numpad 8\r\n  120: 'debug'    // F9\r\n};\r\n\r\n/**\r\n* A hash table to convert from a gamepad button to a mapped key name.\r\n*\r\n* @static\r\n* @property gamepadMapper\r\n* @type Object\r\n*/\r\nInput.gamepadMapper = {\r\n  0: 'ok',        // A\r\n  1: 'cancel',    // B\r\n  2: 'shift',     // X\r\n  3: 'menu',      // Y\r\n  4: 'pageup',    // LB\r\n  5: 'pagedown',  // RB\r\n  12: 'up',       // D-pad up\r\n  13: 'down',     // D-pad down\r\n  14: 'left',     // D-pad left\r\n  15: 'right',    // D-pad right\r\n};\r\n\r\n/**\r\n* Clears all the input data.\r\n*\r\n* @static\r\n* @method clear\r\n*/\r\nInput.clear = function() {\r\n  this._currentState = {};\r\n  this._previousState = {};\r\n  this._gamepadStates = [];\r\n  this._latestButton = null;\r\n  this._pressedTime = 0;\r\n  this._dir4 = 0;\r\n  this._dir8 = 0;\r\n  this._preferredAxis = '';\r\n  this._date = 0;\r\n};\r\n\r\n/**\r\n* Updates the input data.\r\n*\r\n* @static\r\n* @method update\r\n*/\r\nInput.update = function() {\r\n  this._pollGamepads();\r\n  if (this._currentState[this._latestButton]) {\r\n      this._pressedTime++;\r\n  } else {\r\n      this._latestButton = null;\r\n  }\r\n  for (var name in this._currentState) {\r\n      if (this._currentState[name] && !this._previousState[name]) {\r\n          this._latestButton = name;\r\n          this._pressedTime = 0;\r\n          this._date = Date.now();\r\n      }\r\n      this._previousState[name] = this._currentState[name];\r\n  }\r\n  this._updateDirection();\r\n};\r\n\r\n/**\r\n* Checks whether a key is currently pressed down.\r\n*\r\n* @static\r\n* @method isPressed\r\n* @param {String} keyName The mapped name of the key\r\n* @return {Boolean} True if the key is pressed\r\n*/\r\nInput.isPressed = function(keyName) {\r\n  if (this._isEscapeCompatible(keyName) && this.isPressed('escape')) {\r\n      return true;\r\n  } else {\r\n      return !!this._currentState[keyName];\r\n  }\r\n};\r\n\r\n/**\r\n* Checks whether a key is just pressed.\r\n*\r\n* @static\r\n* @method isTriggered\r\n* @param {String} keyName The mapped name of the key\r\n* @return {Boolean} True if the key is triggered\r\n*/\r\nInput.isTriggered = function(keyName) {\r\n  if (this._isEscapeCompatible(keyName) && this.isTriggered('escape')) {\r\n      return true;\r\n  } else {\r\n      return this._latestButton === keyName && this._pressedTime === 0;\r\n  }\r\n};\r\n\r\n/**\r\n* Checks whether a key is just pressed or a key repeat occurred.\r\n*\r\n* @static\r\n* @method isRepeated\r\n* @param {String} keyName The mapped name of the key\r\n* @return {Boolean} True if the key is repeated\r\n*/\r\nInput.isRepeated = function(keyName) {\r\n  if (this._isEscapeCompatible(keyName) && this.isRepeated('escape')) {\r\n      return true;\r\n  } else {\r\n      return (this._latestButton === keyName &&\r\n              (this._pressedTime === 0 ||\r\n               (this._pressedTime >= this.keyRepeatWait &&\r\n                this._pressedTime % this.keyRepeatInterval === 0)));\r\n  }\r\n};\r\n\r\n/**\r\n* Checks whether a key is kept depressed.\r\n*\r\n* @static\r\n* @method isLongPressed\r\n* @param {String} keyName The mapped name of the key\r\n* @return {Boolean} True if the key is long-pressed\r\n*/\r\nInput.isLongPressed = function(keyName) {\r\n  if (this._isEscapeCompatible(keyName) && this.isLongPressed('escape')) {\r\n      return true;\r\n  } else {\r\n      return (this._latestButton === keyName &&\r\n              this._pressedTime >= this.keyRepeatWait);\r\n  }\r\n};\r\n\r\n/**\r\n* [read-only] The four direction value as a number of the numpad, or 0 for neutral.\r\n*\r\n* @static\r\n* @property dir4\r\n* @type Number\r\n*/\r\nObject.defineProperty(Input, 'dir4', {\r\n  get: function() {\r\n      return this._dir4;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* [read-only] The eight direction value as a number of the numpad, or 0 for neutral.\r\n*\r\n* @static\r\n* @property dir8\r\n* @type Number\r\n*/\r\nObject.defineProperty(Input, 'dir8', {\r\n  get: function() {\r\n      return this._dir8;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* [read-only] The time of the last input in milliseconds.\r\n*\r\n* @static\r\n* @property date\r\n* @type Number\r\n*/\r\nObject.defineProperty(Input, 'date', {\r\n  get: function() {\r\n      return this._date;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* @static\r\n* @method _wrapNwjsAlert\r\n* @private\r\n*/\r\nInput._wrapNwjsAlert = function() {\r\n  if (Utils.isNwjs()) {\r\n      var _alert = window.alert;\r\n      window.alert = function() {\r\n          var gui = require('nw.gui');\r\n          var win = gui.Window.get();\r\n          _alert.apply(this, arguments);\r\n          win.focus();\r\n          Input.clear();\r\n      };\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _setupEventHandlers\r\n* @private\r\n*/\r\nInput._setupEventHandlers = function() {\r\n  document.addEventListener('keydown', this._onKeyDown.bind(this));\r\n  document.addEventListener('keyup', this._onKeyUp.bind(this));\r\n  window.addEventListener('blur', this._onLostFocus.bind(this));\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onKeyDown\r\n* @param {KeyboardEvent} event\r\n* @private\r\n*/\r\nInput._onKeyDown = function(event) {\r\n  if (this._shouldPreventDefault(event.keyCode)) {\r\n      event.preventDefault();\r\n  }\r\n  if (event.keyCode === 144) {    // Numlock\r\n      this.clear();\r\n  }\r\n  var buttonName = this.keyMapper[event.keyCode];\r\n  if (ResourceHandler.exists() && buttonName === 'ok') {\r\n      ResourceHandler.retry();\r\n  } else if (buttonName) {\r\n      this._currentState[buttonName] = true;\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _shouldPreventDefault\r\n* @param {Number} keyCode\r\n* @private\r\n*/\r\nInput._shouldPreventDefault = function(keyCode) {\r\n  switch (keyCode) {\r\n  case 8:     // backspace\r\n  case 33:    // pageup\r\n  case 34:    // pagedown\r\n  case 37:    // left arrow\r\n  case 38:    // up arrow\r\n  case 39:    // right arrow\r\n  case 40:    // down arrow\r\n      return true;\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onKeyUp\r\n* @param {KeyboardEvent} event\r\n* @private\r\n*/\r\nInput._onKeyUp = function(event) {\r\n  var buttonName = this.keyMapper[event.keyCode];\r\n  if (buttonName) {\r\n      this._currentState[buttonName] = false;\r\n  }\r\n  if (event.keyCode === 0) {  // For QtWebEngine on OS X\r\n      this.clear();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onLostFocus\r\n* @private\r\n*/\r\nInput._onLostFocus = function() {\r\n  this.clear();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _pollGamepads\r\n* @private\r\n*/\r\nInput._pollGamepads = function() {\r\n  if (navigator.getGamepads) {\r\n      var gamepads = navigator.getGamepads();\r\n      if (gamepads) {\r\n          for (var i = 0; i < gamepads.length; i++) {\r\n              var gamepad = gamepads[i];\r\n              if (gamepad && gamepad.connected) {\r\n                  this._updateGamepadState(gamepad);\r\n              }\r\n          }\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _updateGamepadState\r\n* @param {Gamepad} gamepad\r\n* @param {Number} index\r\n* @private\r\n*/\r\nInput._updateGamepadState = function(gamepad) {\r\n  var lastState = this._gamepadStates[gamepad.index] || [];\r\n  var newState = [];\r\n  var buttons = gamepad.buttons;\r\n  var axes = gamepad.axes;\r\n  var threshold = 0.5;\r\n  newState[12] = false;\r\n  newState[13] = false;\r\n  newState[14] = false;\r\n  newState[15] = false;\r\n  for (var i = 0; i < buttons.length; i++) {\r\n      newState[i] = buttons[i].pressed;\r\n  }\r\n  if (axes[1] < -threshold) {\r\n      newState[12] = true;    // up\r\n  } else if (axes[1] > threshold) {\r\n      newState[13] = true;    // down\r\n  }\r\n  if (axes[0] < -threshold) {\r\n      newState[14] = true;    // left\r\n  } else if (axes[0] > threshold) {\r\n      newState[15] = true;    // right\r\n  }\r\n  for (var j = 0; j < newState.length; j++) {\r\n      if (newState[j] !== lastState[j]) {\r\n          var buttonName = this.gamepadMapper[j];\r\n          if (buttonName) {\r\n              this._currentState[buttonName] = newState[j];\r\n          }\r\n      }\r\n  }\r\n  this._gamepadStates[gamepad.index] = newState;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _updateDirection\r\n* @private\r\n*/\r\nInput._updateDirection = function() {\r\n  var x = this._signX();\r\n  var y = this._signY();\r\n\r\n  this._dir8 = this._makeNumpadDirection(x, y);\r\n\r\n  if (x !== 0 && y !== 0) {\r\n      if (this._preferredAxis === 'x') {\r\n          y = 0;\r\n      } else {\r\n          x = 0;\r\n      }\r\n  } else if (x !== 0) {\r\n      this._preferredAxis = 'y';\r\n  } else if (y !== 0) {\r\n      this._preferredAxis = 'x';\r\n  }\r\n\r\n  this._dir4 = this._makeNumpadDirection(x, y);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _signX\r\n* @private\r\n*/\r\nInput._signX = function() {\r\n  var x = 0;\r\n\r\n  if (this.isPressed('left')) {\r\n      x--;\r\n  }\r\n  if (this.isPressed('right')) {\r\n      x++;\r\n  }\r\n  return x;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _signY\r\n* @private\r\n*/\r\nInput._signY = function() {\r\n  var y = 0;\r\n\r\n  if (this.isPressed('up')) {\r\n      y--;\r\n  }\r\n  if (this.isPressed('down')) {\r\n      y++;\r\n  }\r\n  return y;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _makeNumpadDirection\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @return {Number}\r\n* @private\r\n*/\r\nInput._makeNumpadDirection = function(x, y) {\r\n  if (x !== 0 || y !== 0) {\r\n      return  5 - y * 3 + x;\r\n  }\r\n  return 0;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _isEscapeCompatible\r\n* @param {String} keyName\r\n* @return {Boolean}\r\n* @private\r\n*/\r\nInput._isEscapeCompatible = function(keyName) {\r\n  return keyName === 'cancel' || keyName === 'menu';\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The static class that handles input data from the mouse and touchscreen.\r\n*\r\n* @class TouchInput\r\n*/\r\nfunction TouchInput() {\r\n  throw new Error('This is a static class');\r\n}\r\n\r\n/**\r\n* Initializes the touch system.\r\n*\r\n* @static\r\n* @method initialize\r\n*/\r\nTouchInput.initialize = function() {\r\n  this.clear();\r\n  this._setupEventHandlers();\r\n};\r\n\r\n/**\r\n* The wait time of the pseudo key repeat in frames.\r\n*\r\n* @static\r\n* @property keyRepeatWait\r\n* @type Number\r\n*/\r\nTouchInput.keyRepeatWait = 24;\r\n\r\n/**\r\n* The interval of the pseudo key repeat in frames.\r\n*\r\n* @static\r\n* @property keyRepeatInterval\r\n* @type Number\r\n*/\r\nTouchInput.keyRepeatInterval = 6;\r\n\r\n/**\r\n* Clears all the touch data.\r\n*\r\n* @static\r\n* @method clear\r\n*/\r\nTouchInput.clear = function() {\r\n  this._mousePressed = false;\r\n  this._screenPressed = false;\r\n  this._pressedTime = 0;\r\n  this._events = {};\r\n  this._events.triggered = false;\r\n  this._events.cancelled = false;\r\n  this._events.moved = false;\r\n  this._events.released = false;\r\n  this._events.wheelX = 0;\r\n  this._events.wheelY = 0;\r\n  this._triggered = false;\r\n  this._cancelled = false;\r\n  this._moved = false;\r\n  this._released = false;\r\n  this._wheelX = 0;\r\n  this._wheelY = 0;\r\n  this._x = 0;\r\n  this._y = 0;\r\n  this._date = 0;\r\n};\r\n\r\n/**\r\n* Updates the touch data.\r\n*\r\n* @static\r\n* @method update\r\n*/\r\nTouchInput.update = function() {\r\n  this._triggered = this._events.triggered;\r\n  this._cancelled = this._events.cancelled;\r\n  this._moved = this._events.moved;\r\n  this._released = this._events.released;\r\n  this._wheelX = this._events.wheelX;\r\n  this._wheelY = this._events.wheelY;\r\n  this._events.triggered = false;\r\n  this._events.cancelled = false;\r\n  this._events.moved = false;\r\n  this._events.released = false;\r\n  this._events.wheelX = 0;\r\n  this._events.wheelY = 0;\r\n  if (this.isPressed()) {\r\n      this._pressedTime++;\r\n  }\r\n};\r\n\r\n/**\r\n* Checks whether the mouse button or touchscreen is currently pressed down.\r\n*\r\n* @static\r\n* @method isPressed\r\n* @return {Boolean} True if the mouse button or touchscreen is pressed\r\n*/\r\nTouchInput.isPressed = function() {\r\n  return this._mousePressed || this._screenPressed;\r\n};\r\n\r\n/**\r\n* Checks whether the left mouse button or touchscreen is just pressed.\r\n*\r\n* @static\r\n* @method isTriggered\r\n* @return {Boolean} True if the mouse button or touchscreen is triggered\r\n*/\r\nTouchInput.isTriggered = function() {\r\n  return this._triggered;\r\n};\r\n\r\n/**\r\n* Checks whether the left mouse button or touchscreen is just pressed\r\n* or a pseudo key repeat occurred.\r\n*\r\n* @static\r\n* @method isRepeated\r\n* @return {Boolean} True if the mouse button or touchscreen is repeated\r\n*/\r\nTouchInput.isRepeated = function() {\r\n  return (this.isPressed() &&\r\n          (this._triggered ||\r\n           (this._pressedTime >= this.keyRepeatWait &&\r\n            this._pressedTime % this.keyRepeatInterval === 0)));\r\n};\r\n\r\n/**\r\n* Checks whether the left mouse button or touchscreen is kept depressed.\r\n*\r\n* @static\r\n* @method isLongPressed\r\n* @return {Boolean} True if the left mouse button or touchscreen is long-pressed\r\n*/\r\nTouchInput.isLongPressed = function() {\r\n  return this.isPressed() && this._pressedTime >= this.keyRepeatWait;\r\n};\r\n\r\n/**\r\n* Checks whether the right mouse button is just pressed.\r\n*\r\n* @static\r\n* @method isCancelled\r\n* @return {Boolean} True if the right mouse button is just pressed\r\n*/\r\nTouchInput.isCancelled = function() {\r\n  return this._cancelled;\r\n};\r\n\r\n/**\r\n* Checks whether the mouse or a finger on the touchscreen is moved.\r\n*\r\n* @static\r\n* @method isMoved\r\n* @return {Boolean} True if the mouse or a finger on the touchscreen is moved\r\n*/\r\nTouchInput.isMoved = function() {\r\n  return this._moved;\r\n};\r\n\r\n/**\r\n* Checks whether the left mouse button or touchscreen is released.\r\n*\r\n* @static\r\n* @method isReleased\r\n* @return {Boolean} True if the mouse button or touchscreen is released\r\n*/\r\nTouchInput.isReleased = function() {\r\n  return this._released;\r\n};\r\n\r\n/**\r\n* [read-only] The horizontal scroll amount.\r\n*\r\n* @static\r\n* @property wheelX\r\n* @type Number\r\n*/\r\nObject.defineProperty(TouchInput, 'wheelX', {\r\n  get: function() {\r\n      return this._wheelX;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* [read-only] The vertical scroll amount.\r\n*\r\n* @static\r\n* @property wheelY\r\n* @type Number\r\n*/\r\nObject.defineProperty(TouchInput, 'wheelY', {\r\n  get: function() {\r\n      return this._wheelY;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* [read-only] The x coordinate on the canvas area of the latest touch event.\r\n*\r\n* @static\r\n* @property x\r\n* @type Number\r\n*/\r\nObject.defineProperty(TouchInput, 'x', {\r\n  get: function() {\r\n      return this._x;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* [read-only] The y coordinate on the canvas area of the latest touch event.\r\n*\r\n* @static\r\n* @property y\r\n* @type Number\r\n*/\r\nObject.defineProperty(TouchInput, 'y', {\r\n  get: function() {\r\n      return this._y;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* [read-only] The time of the last input in milliseconds.\r\n*\r\n* @static\r\n* @property date\r\n* @type Number\r\n*/\r\nObject.defineProperty(TouchInput, 'date', {\r\n  get: function() {\r\n      return this._date;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* @static\r\n* @method _setupEventHandlers\r\n* @private\r\n*/\r\nTouchInput._setupEventHandlers = function() {\r\n  var isSupportPassive = Utils.isSupportPassiveEvent();\r\n  document.addEventListener('mousedown', this._onMouseDown.bind(this));\r\n  document.addEventListener('mousemove', this._onMouseMove.bind(this));\r\n  document.addEventListener('mouseup', this._onMouseUp.bind(this));\r\n  document.addEventListener('wheel', this._onWheel.bind(this));\r\n  document.addEventListener('touchstart', this._onTouchStart.bind(this), isSupportPassive ? {passive: false} : false);\r\n  document.addEventListener('touchmove', this._onTouchMove.bind(this), isSupportPassive ? {passive: false} : false);\r\n  document.addEventListener('touchend', this._onTouchEnd.bind(this));\r\n  document.addEventListener('touchcancel', this._onTouchCancel.bind(this));\r\n  document.addEventListener('pointerdown', this._onPointerDown.bind(this));\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onMouseDown\r\n* @param {MouseEvent} event\r\n* @private\r\n*/\r\nTouchInput._onMouseDown = function(event) {\r\n  if (event.button === 0) {\r\n      this._onLeftButtonDown(event);\r\n  } else if (event.button === 1) {\r\n      this._onMiddleButtonDown(event);\r\n  } else if (event.button === 2) {\r\n      this._onRightButtonDown(event);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onLeftButtonDown\r\n* @param {MouseEvent} event\r\n* @private\r\n*/\r\nTouchInput._onLeftButtonDown = function(event) {\r\n  var x = Graphics.pageToCanvasX(event.pageX);\r\n  var y = Graphics.pageToCanvasY(event.pageY);\r\n  if (Graphics.isInsideCanvas(x, y)) {\r\n      this._mousePressed = true;\r\n      this._pressedTime = 0;\r\n      this._onTrigger(x, y);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onMiddleButtonDown\r\n* @param {MouseEvent} event\r\n* @private\r\n*/\r\nTouchInput._onMiddleButtonDown = function(event) {\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onRightButtonDown\r\n* @param {MouseEvent} event\r\n* @private\r\n*/\r\nTouchInput._onRightButtonDown = function(event) {\r\n  var x = Graphics.pageToCanvasX(event.pageX);\r\n  var y = Graphics.pageToCanvasY(event.pageY);\r\n  if (Graphics.isInsideCanvas(x, y)) {\r\n      this._onCancel(x, y);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onMouseMove\r\n* @param {MouseEvent} event\r\n* @private\r\n*/\r\nTouchInput._onMouseMove = function(event) {\r\n  if (this._mousePressed) {\r\n      var x = Graphics.pageToCanvasX(event.pageX);\r\n      var y = Graphics.pageToCanvasY(event.pageY);\r\n      this._onMove(x, y);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onMouseUp\r\n* @param {MouseEvent} event\r\n* @private\r\n*/\r\nTouchInput._onMouseUp = function(event) {\r\n  if (event.button === 0) {\r\n      var x = Graphics.pageToCanvasX(event.pageX);\r\n      var y = Graphics.pageToCanvasY(event.pageY);\r\n      this._mousePressed = false;\r\n      this._onRelease(x, y);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onWheel\r\n* @param {WheelEvent} event\r\n* @private\r\n*/\r\nTouchInput._onWheel = function(event) {\r\n  this._events.wheelX += event.deltaX;\r\n  this._events.wheelY += event.deltaY;\r\n  event.preventDefault();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onTouchStart\r\n* @param {TouchEvent} event\r\n* @private\r\n*/\r\nTouchInput._onTouchStart = function(event) {\r\n  for (var i = 0; i < event.changedTouches.length; i++) {\r\n      var touch = event.changedTouches[i];\r\n      var x = Graphics.pageToCanvasX(touch.pageX);\r\n      var y = Graphics.pageToCanvasY(touch.pageY);\r\n      if (Graphics.isInsideCanvas(x, y)) {\r\n          this._screenPressed = true;\r\n          this._pressedTime = 0;\r\n          if (event.touches.length >= 2) {\r\n              this._onCancel(x, y);\r\n          } else {\r\n              this._onTrigger(x, y);\r\n          }\r\n          event.preventDefault();\r\n      }\r\n  }\r\n  if (window.cordova || window.navigator.standalone) {\r\n      event.preventDefault();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onTouchMove\r\n* @param {TouchEvent} event\r\n* @private\r\n*/\r\nTouchInput._onTouchMove = function(event) {\r\n  for (var i = 0; i < event.changedTouches.length; i++) {\r\n      var touch = event.changedTouches[i];\r\n      var x = Graphics.pageToCanvasX(touch.pageX);\r\n      var y = Graphics.pageToCanvasY(touch.pageY);\r\n      this._onMove(x, y);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onTouchEnd\r\n* @param {TouchEvent} event\r\n* @private\r\n*/\r\nTouchInput._onTouchEnd = function(event) {\r\n  for (var i = 0; i < event.changedTouches.length; i++) {\r\n      var touch = event.changedTouches[i];\r\n      var x = Graphics.pageToCanvasX(touch.pageX);\r\n      var y = Graphics.pageToCanvasY(touch.pageY);\r\n      this._screenPressed = false;\r\n      this._onRelease(x, y);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onTouchCancel\r\n* @param {TouchEvent} event\r\n* @private\r\n*/\r\nTouchInput._onTouchCancel = function(event) {\r\n  this._screenPressed = false;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onPointerDown\r\n* @param {PointerEvent} event\r\n* @private\r\n*/\r\nTouchInput._onPointerDown = function(event) {\r\n  if (event.pointerType === 'touch' && !event.isPrimary) {\r\n      var x = Graphics.pageToCanvasX(event.pageX);\r\n      var y = Graphics.pageToCanvasY(event.pageY);\r\n      if (Graphics.isInsideCanvas(x, y)) {\r\n          // For Microsoft Edge\r\n          this._onCancel(x, y);\r\n          event.preventDefault();\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onTrigger\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @private\r\n*/\r\nTouchInput._onTrigger = function(x, y) {\r\n  this._events.triggered = true;\r\n  this._x = x;\r\n  this._y = y;\r\n  this._date = Date.now();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onCancel\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @private\r\n*/\r\nTouchInput._onCancel = function(x, y) {\r\n  this._events.cancelled = true;\r\n  this._x = x;\r\n  this._y = y;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onMove\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @private\r\n*/\r\nTouchInput._onMove = function(x, y) {\r\n  this._events.moved = true;\r\n  this._x = x;\r\n  this._y = y;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onRelease\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @private\r\n*/\r\nTouchInput._onRelease = function(x, y) {\r\n  this._events.released = true;\r\n  this._x = x;\r\n  this._y = y;\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The basic object that is rendered to the game screen.\r\n*\r\n* @class Sprite\r\n* @constructor\r\n* @param {Bitmap} bitmap The image for the sprite\r\n*/\r\nfunction Sprite() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nSprite.prototype = Object.create(PIXI.Sprite.prototype);\r\nSprite.prototype.constructor = Sprite;\r\n\r\nSprite.voidFilter = new PIXI.filters.VoidFilter();\r\n\r\nSprite.prototype.initialize = function(bitmap) {\r\n  var texture = new PIXI.Texture(new PIXI.BaseTexture());\r\n\r\n  PIXI.Sprite.call(this, texture);\r\n\r\n  this._bitmap = null;\r\n  this._frame = new Rectangle();\r\n  this._realFrame = new Rectangle();\r\n  this._blendColor = [0, 0, 0, 0];\r\n  this._colorTone = [0, 0, 0, 0];\r\n  this._canvas = null;\r\n  this._context = null;\r\n  this._tintTexture = null;\r\n\r\n  /**\r\n   * use heavy renderer that will reduce border artifacts and apply advanced blendModes\r\n   * @type {boolean}\r\n   * @private\r\n   */\r\n  this._isPicture = false;\r\n\r\n  this.spriteId = Sprite._counter++;\r\n  this.opaque = false;\r\n\r\n  this.bitmap = bitmap;\r\n};\r\n\r\n// Number of the created objects.\r\nSprite._counter = 0;\r\n\r\n/**\r\n* The image for the sprite.\r\n*\r\n* @property bitmap\r\n* @type Bitmap\r\n*/\r\nObject.defineProperty(Sprite.prototype, 'bitmap', {\r\n  get: function() {\r\n      return this._bitmap;\r\n  },\r\n  set: function(value) {\r\n      if (this._bitmap !== value) {\r\n          this._bitmap = value;\r\n\r\n          if(value){\r\n              this._refreshFrame = true;\r\n              value.addLoadListener(this._onBitmapLoad.bind(this));\r\n          }else{\r\n              this._refreshFrame = false;\r\n              this.texture.frame = Rectangle.emptyRectangle;\r\n          }\r\n      }\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The width of the sprite without the scale.\r\n*\r\n* @property width\r\n* @type Number\r\n*/\r\nObject.defineProperty(Sprite.prototype, 'width', {\r\n  get: function() {\r\n      return this._frame.width;\r\n  },\r\n  set: function(value) {\r\n      this._frame.width = value;\r\n      this._refresh();\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The height of the sprite without the scale.\r\n*\r\n* @property height\r\n* @type Number\r\n*/\r\nObject.defineProperty(Sprite.prototype, 'height', {\r\n  get: function() {\r\n      return this._frame.height;\r\n  },\r\n  set: function(value) {\r\n      this._frame.height = value;\r\n      this._refresh();\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The opacity of the sprite (0 to 255).\r\n*\r\n* @property opacity\r\n* @type Number\r\n*/\r\nObject.defineProperty(Sprite.prototype, 'opacity', {\r\n  get: function() {\r\n      return this.alpha * 255;\r\n  },\r\n  set: function(value) {\r\n      this.alpha = value.clamp(0, 255) / 255;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* Updates the sprite for each frame.\r\n*\r\n* @method update\r\n*/\r\nSprite.prototype.update = function() {\r\n  this.children.forEach(function(child) {\r\n      if (child.update) {\r\n          child.update();\r\n      }\r\n  });\r\n};\r\n\r\n/**\r\n* Sets the x and y at once.\r\n*\r\n* @method move\r\n* @param {Number} x The x coordinate of the sprite\r\n* @param {Number} y The y coordinate of the sprite\r\n*/\r\nSprite.prototype.move = function(x, y) {\r\n  this.x = x;\r\n  this.y = y;\r\n};\r\n\r\n/**\r\n* Sets the rectagle of the bitmap that the sprite displays.\r\n*\r\n* @method setFrame\r\n* @param {Number} x The x coordinate of the frame\r\n* @param {Number} y The y coordinate of the frame\r\n* @param {Number} width The width of the frame\r\n* @param {Number} height The height of the frame\r\n*/\r\nSprite.prototype.setFrame = function(x, y, width, height) {\r\n  this._refreshFrame = false;\r\n  var frame = this._frame;\r\n  if (x !== frame.x || y !== frame.y ||\r\n          width !== frame.width || height !== frame.height) {\r\n      frame.x = x;\r\n      frame.y = y;\r\n      frame.width = width;\r\n      frame.height = height;\r\n      this._refresh();\r\n  }\r\n};\r\n\r\n/**\r\n* Gets the blend color for the sprite.\r\n*\r\n* @method getBlendColor\r\n* @return {Array} The blend color [r, g, b, a]\r\n*/\r\nSprite.prototype.getBlendColor = function() {\r\n  return this._blendColor.clone();\r\n};\r\n\r\n/**\r\n* Sets the blend color for the sprite.\r\n*\r\n* @method setBlendColor\r\n* @param {Array} color The blend color [r, g, b, a]\r\n*/\r\nSprite.prototype.setBlendColor = function(color) {\r\n  if (!(color instanceof Array)) {\r\n      throw new Error('Argument must be an array');\r\n  }\r\n  if (!this._blendColor.equals(color)) {\r\n      this._blendColor = color.clone();\r\n      this._refresh();\r\n  }\r\n};\r\n\r\n/**\r\n* Gets the color tone for the sprite.\r\n*\r\n* @method getColorTone\r\n* @return {Array} The color tone [r, g, b, gray]\r\n*/\r\nSprite.prototype.getColorTone = function() {\r\n  return this._colorTone.clone();\r\n};\r\n\r\n/**\r\n* Sets the color tone for the sprite.\r\n*\r\n* @method setColorTone\r\n* @param {Array} tone The color tone [r, g, b, gray]\r\n*/\r\nSprite.prototype.setColorTone = function(tone) {\r\n  if (!(tone instanceof Array)) {\r\n      throw new Error('Argument must be an array');\r\n  }\r\n  if (!this._colorTone.equals(tone)) {\r\n      this._colorTone = tone.clone();\r\n      this._refresh();\r\n  }\r\n};\r\n\r\n/**\r\n* @method _onBitmapLoad\r\n* @private\r\n*/\r\nSprite.prototype._onBitmapLoad = function(bitmapLoaded) {\r\n  if(bitmapLoaded === this._bitmap){\r\n      if (this._refreshFrame && this._bitmap) {\r\n          this._refreshFrame = false;\r\n          this._frame.width = this._bitmap.width;\r\n          this._frame.height = this._bitmap.height;\r\n      }\r\n  }\r\n\r\n  this._refresh();\r\n};\r\n\r\n/**\r\n* @method _refresh\r\n* @private\r\n*/\r\nSprite.prototype._refresh = function() {\r\n  var frameX = Math.floor(this._frame.x);\r\n  var frameY = Math.floor(this._frame.y);\r\n  var frameW = Math.floor(this._frame.width);\r\n  var frameH = Math.floor(this._frame.height);\r\n  var bitmapW = this._bitmap ? this._bitmap.width : 0;\r\n  var bitmapH = this._bitmap ? this._bitmap.height : 0;\r\n  var realX = frameX.clamp(0, bitmapW);\r\n  var realY = frameY.clamp(0, bitmapH);\r\n  var realW = (frameW - realX + frameX).clamp(0, bitmapW - realX);\r\n  var realH = (frameH - realY + frameY).clamp(0, bitmapH - realY);\r\n\r\n  this._realFrame.x = realX;\r\n  this._realFrame.y = realY;\r\n  this._realFrame.width = realW;\r\n  this._realFrame.height = realH;\r\n  this.pivot.x = frameX - realX;\r\n  this.pivot.y = frameY - realY;\r\n\r\n  if (realW > 0 && realH > 0) {\r\n      if (this._needsTint()) {\r\n          this._createTinter(realW, realH);\r\n          this._executeTint(realX, realY, realW, realH);\r\n          this._tintTexture.update();\r\n          this.texture.baseTexture = this._tintTexture;\r\n          this.texture.frame = new Rectangle(0, 0, realW, realH);\r\n      } else {\r\n          if (this._bitmap) {\r\n              this.texture.baseTexture = this._bitmap.baseTexture;\r\n          }\r\n          this.texture.frame = this._realFrame;\r\n      }\r\n  } else if (this._bitmap) {\r\n      this.texture.frame = Rectangle.emptyRectangle;\r\n  } else {\r\n      this.texture.baseTexture.width = Math.max(this.texture.baseTexture.width, this._frame.x + this._frame.width);\r\n      this.texture.baseTexture.height = Math.max(this.texture.baseTexture.height, this._frame.y + this._frame.height);\r\n      this.texture.frame = this._frame;\r\n  }\r\n  this.texture._updateID++;\r\n};\r\n\r\n/**\r\n* @method _isInBitmapRect\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @param {Number} w\r\n* @param {Number} h\r\n* @return {Boolean}\r\n* @private\r\n*/\r\nSprite.prototype._isInBitmapRect = function(x, y, w, h) {\r\n  return (this._bitmap && x + w > 0 && y + h > 0 &&\r\n          x < this._bitmap.width && y < this._bitmap.height);\r\n};\r\n\r\n/**\r\n* @method _needsTint\r\n* @return {Boolean}\r\n* @private\r\n*/\r\nSprite.prototype._needsTint = function() {\r\n  var tone = this._colorTone;\r\n  return tone[0] || tone[1] || tone[2] || tone[3] || this._blendColor[3] > 0;\r\n};\r\n\r\n/**\r\n* @method _createTinter\r\n* @param {Number} w\r\n* @param {Number} h\r\n* @private\r\n*/\r\nSprite.prototype._createTinter = function(w, h) {\r\n  if (!this._canvas) {\r\n      this._canvas = document.createElement('canvas');\r\n      this._context = this._canvas.getContext('2d');\r\n  }\r\n\r\n  this._canvas.width = w;\r\n  this._canvas.height = h;\r\n\r\n  if (!this._tintTexture) {\r\n      this._tintTexture = new PIXI.BaseTexture(this._canvas);\r\n  }\r\n\r\n  this._tintTexture.width = w;\r\n  this._tintTexture.height = h;\r\n  this._tintTexture.scaleMode = this._bitmap.baseTexture.scaleMode;\r\n};\r\n\r\n/**\r\n* @method _executeTint\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @param {Number} w\r\n* @param {Number} h\r\n* @private\r\n*/\r\nSprite.prototype._executeTint = function(x, y, w, h) {\r\n  var context = this._context;\r\n  var tone = this._colorTone;\r\n  var color = this._blendColor;\r\n\r\n  context.globalCompositeOperation = 'copy';\r\n  context.drawImage(this._bitmap.canvas, x, y, w, h, 0, 0, w, h);\r\n\r\n  if (Graphics.canUseSaturationBlend()) {\r\n      var gray = Math.max(0, tone[3]);\r\n      context.globalCompositeOperation = 'saturation';\r\n      context.fillStyle = 'rgba(255,255,255,' + gray / 255 + ')';\r\n      context.fillRect(0, 0, w, h);\r\n  }\r\n\r\n  var r1 = Math.max(0, tone[0]);\r\n  var g1 = Math.max(0, tone[1]);\r\n  var b1 = Math.max(0, tone[2]);\r\n  context.globalCompositeOperation = 'lighter';\r\n  context.fillStyle = Utils.rgbToCssColor(r1, g1, b1);\r\n  context.fillRect(0, 0, w, h);\r\n\r\n  if (Graphics.canUseDifferenceBlend()) {\r\n      context.globalCompositeOperation = 'difference';\r\n      context.fillStyle = 'white';\r\n      context.fillRect(0, 0, w, h);\r\n\r\n      var r2 = Math.max(0, -tone[0]);\r\n      var g2 = Math.max(0, -tone[1]);\r\n      var b2 = Math.max(0, -tone[2]);\r\n      context.globalCompositeOperation = 'lighter';\r\n      context.fillStyle = Utils.rgbToCssColor(r2, g2, b2);\r\n      context.fillRect(0, 0, w, h);\r\n\r\n      context.globalCompositeOperation = 'difference';\r\n      context.fillStyle = 'white';\r\n      context.fillRect(0, 0, w, h);\r\n  }\r\n\r\n  var r3 = Math.max(0, color[0]);\r\n  var g3 = Math.max(0, color[1]);\r\n  var b3 = Math.max(0, color[2]);\r\n  var a3 = Math.max(0, color[3]);\r\n  context.globalCompositeOperation = 'source-atop';\r\n  context.fillStyle = Utils.rgbToCssColor(r3, g3, b3);\r\n  context.globalAlpha = a3 / 255;\r\n  context.fillRect(0, 0, w, h);\r\n\r\n  context.globalCompositeOperation = 'destination-in';\r\n  context.globalAlpha = 1;\r\n  context.drawImage(this._bitmap.canvas, x, y, w, h, 0, 0, w, h);\r\n};\r\n\r\nSprite.prototype._renderCanvas_PIXI = PIXI.Sprite.prototype._renderCanvas;\r\nSprite.prototype._renderWebGL_PIXI = PIXI.Sprite.prototype._renderWebGL;\r\n\r\n/**\r\n* @method _renderCanvas\r\n* @param {Object} renderer\r\n* @private\r\n*/\r\nSprite.prototype._renderCanvas = function(renderer) {\r\n  if (this.bitmap) {\r\n      this.bitmap.touch();\r\n  }\r\n  if(this.bitmap && !this.bitmap.isReady()){\r\n      return;\r\n  }\r\n\r\n  if (this.texture.frame.width > 0 && this.texture.frame.height > 0) {\r\n      this._renderCanvas_PIXI(renderer);\r\n  }\r\n};\r\n\r\n/**\r\n* checks if we need to speed up custom blendmodes\r\n* @param renderer\r\n* @private\r\n*/\r\nSprite.prototype._speedUpCustomBlendModes = function(renderer) {\r\n  var picture = renderer.plugins.picture;\r\n  var blend = this.blendMode;\r\n  if (renderer.renderingToScreen && renderer._activeRenderTarget.root) {\r\n      if (picture.drawModes[blend]) {\r\n          var stage = renderer._lastObjectRendered;\r\n          var f = stage._filters;\r\n          if (!f || !f[0]) {\r\n              setTimeout(function () {\r\n                  var f = stage._filters;\r\n                  if (!f || !f[0]) {\r\n                      stage.filters = [Sprite.voidFilter];\r\n                      stage.filterArea = new PIXI.Rectangle(0, 0, Graphics.width, Graphics.height);\r\n                  }\r\n              }, 0);\r\n          }\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _renderWebGL\r\n* @param {Object} renderer\r\n* @private\r\n*/\r\nSprite.prototype._renderWebGL = function(renderer) {\r\n  if (this.bitmap) {\r\n      this.bitmap.touch();\r\n  }\r\n  if(this.bitmap && !this.bitmap.isReady()){\r\n      return;\r\n  }\r\n  if (this.texture.frame.width > 0 && this.texture.frame.height > 0) {\r\n      if (this._bitmap) {\r\n          this._bitmap.checkDirty();\r\n      }\r\n\r\n      //copy of pixi-v4 internal code\r\n      this.calculateVertices();\r\n\r\n      if (this.pluginName === 'sprite' && this._isPicture) {\r\n          // use heavy renderer, which reduces artifacts and applies corrent blendMode,\r\n          // but does not use multitexture optimization\r\n          this._speedUpCustomBlendModes(renderer);\r\n          renderer.setObjectRenderer(renderer.plugins.picture);\r\n          renderer.plugins.picture.render(this);\r\n      } else {\r\n          // use pixi super-speed renderer\r\n          renderer.setObjectRenderer(renderer.plugins[this.pluginName]);\r\n    renderer.plugins[this.pluginName].render(this);\r\n      }\r\n  }\r\n};\r\n\r\n// The important members from Pixi.js\r\n\r\n/**\r\n* The visibility of the sprite.\r\n*\r\n* @property visible\r\n* @type Boolean\r\n*/\r\n\r\n/**\r\n* The x coordinate of the sprite.\r\n*\r\n* @property x\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* The y coordinate of the sprite.\r\n*\r\n* @property y\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* The origin point of the sprite. (0,0) to (1,1).\r\n*\r\n* @property anchor\r\n* @type Point\r\n*/\r\n\r\n/**\r\n* The scale factor of the sprite.\r\n*\r\n* @property scale\r\n* @type Point\r\n*/\r\n\r\n/**\r\n* The rotation of the sprite in radians.\r\n*\r\n* @property rotation\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* The blend mode to be applied to the sprite.\r\n*\r\n* @property blendMode\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* Sets the filters for the sprite.\r\n*\r\n* @property filters\r\n* @type Array\r\n*/\r\n\r\n/**\r\n* [read-only] The array of children of the sprite.\r\n*\r\n* @property children\r\n* @type Array\r\n*/\r\n\r\n/**\r\n* [read-only] The object that contains the sprite.\r\n*\r\n* @property parent\r\n* @type Object\r\n*/\r\n\r\n/**\r\n* Adds a child to the container.\r\n*\r\n* @method addChild\r\n* @param {Object} child The child to add\r\n* @return {Object} The child that was added\r\n*/\r\n\r\n/**\r\n* Adds a child to the container at a specified index.\r\n*\r\n* @method addChildAt\r\n* @param {Object} child The child to add\r\n* @param {Number} index The index to place the child in\r\n* @return {Object} The child that was added\r\n*/\r\n\r\n/**\r\n* Removes a child from the container.\r\n*\r\n* @method removeChild\r\n* @param {Object} child The child to remove\r\n* @return {Object} The child that was removed\r\n*/\r\n\r\n/**\r\n* Removes a child from the specified index position.\r\n*\r\n* @method removeChildAt\r\n* @param {Number} index The index to get the child from\r\n* @return {Object} The child that was removed\r\n*/\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The tilemap which displays 2D tile-based game map.\r\n*\r\n* @class Tilemap\r\n* @constructor\r\n*/\r\nfunction Tilemap() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nTilemap.prototype = Object.create(PIXI.Container.prototype);\r\nTilemap.prototype.constructor = Tilemap;\r\n\r\nTilemap.prototype.initialize = function() {\r\n  PIXI.Container.call(this);\r\n\r\n  this._margin = 20;\r\n  this._width = Graphics.width + this._margin * 2;\r\n  this._height = Graphics.height + this._margin * 2;\r\n  this._tileWidth = 48;\r\n  this._tileHeight = 48;\r\n  this._mapWidth = 0;\r\n  this._mapHeight = 0;\r\n  this._mapData = null;\r\n  this._layerWidth = 0;\r\n  this._layerHeight = 0;\r\n  this._lastTiles = [];\r\n\r\n  /**\r\n   * The bitmaps used as a tileset.\r\n   *\r\n   * @property bitmaps\r\n   * @type Array\r\n   */\r\n  this.bitmaps = [];\r\n\r\n  /**\r\n   * The origin point of the tilemap for scrolling.\r\n   *\r\n   * @property origin\r\n   * @type Point\r\n   */\r\n  this.origin = new Point();\r\n\r\n  /**\r\n   * The tileset flags.\r\n   *\r\n   * @property flags\r\n   * @type Array\r\n   */\r\n  this.flags = [];\r\n\r\n  /**\r\n   * The animation count for autotiles.\r\n   *\r\n   * @property animationCount\r\n   * @type Number\r\n   */\r\n  this.animationCount = 0;\r\n\r\n  /**\r\n   * Whether the tilemap loops horizontal.\r\n   *\r\n   * @property horizontalWrap\r\n   * @type Boolean\r\n   */\r\n  this.horizontalWrap = false;\r\n\r\n  /**\r\n   * Whether the tilemap loops vertical.\r\n   *\r\n   * @property verticalWrap\r\n   * @type Boolean\r\n   */\r\n  this.verticalWrap = false;\r\n\r\n  this._createLayers();\r\n  this.refresh();\r\n};\r\n\r\n/**\r\n* The width of the screen in pixels.\r\n*\r\n* @property width\r\n* @type Number\r\n*/\r\nObject.defineProperty(Tilemap.prototype, 'width', {\r\n  get: function() {\r\n      return this._width;\r\n  },\r\n  set: function(value) {\r\n      if (this._width !== value) {\r\n          this._width = value;\r\n          this._createLayers();\r\n      }\r\n  }\r\n});\r\n\r\n/**\r\n* The height of the screen in pixels.\r\n*\r\n* @property height\r\n* @type Number\r\n*/\r\nObject.defineProperty(Tilemap.prototype, 'height', {\r\n  get: function() {\r\n      return this._height;\r\n  },\r\n  set: function(value) {\r\n      if (this._height !== value) {\r\n          this._height = value;\r\n          this._createLayers();\r\n      }\r\n  }\r\n});\r\n\r\n/**\r\n* The width of a tile in pixels.\r\n*\r\n* @property tileWidth\r\n* @type Number\r\n*/\r\nObject.defineProperty(Tilemap.prototype, 'tileWidth', {\r\n  get: function() {\r\n      return this._tileWidth;\r\n  },\r\n  set: function(value) {\r\n      if (this._tileWidth !== value) {\r\n          this._tileWidth = value;\r\n          this._createLayers();\r\n      }\r\n  }\r\n});\r\n\r\n/**\r\n* The height of a tile in pixels.\r\n*\r\n* @property tileHeight\r\n* @type Number\r\n*/\r\nObject.defineProperty(Tilemap.prototype, 'tileHeight', {\r\n  get: function() {\r\n      return this._tileHeight;\r\n  },\r\n  set: function(value) {\r\n      if (this._tileHeight !== value) {\r\n          this._tileHeight = value;\r\n          this._createLayers();\r\n      }\r\n  }\r\n});\r\n\r\n/**\r\n* Sets the tilemap data.\r\n*\r\n* @method setData\r\n* @param {Number} width The width of the map in number of tiles\r\n* @param {Number} height The height of the map in number of tiles\r\n* @param {Array} data The one dimensional array for the map data\r\n*/\r\nTilemap.prototype.setData = function(width, height, data) {\r\n  this._mapWidth = width;\r\n  this._mapHeight = height;\r\n  this._mapData = data;\r\n};\r\n\r\n/**\r\n* Checks whether the tileset is ready to render.\r\n*\r\n* @method isReady\r\n* @type Boolean\r\n* @return {Boolean} True if the tilemap is ready\r\n*/\r\nTilemap.prototype.isReady = function() {\r\n  for (var i = 0; i < this.bitmaps.length; i++) {\r\n      if (this.bitmaps[i] && !this.bitmaps[i].isReady()) {\r\n          return false;\r\n      }\r\n  }\r\n  return true;\r\n};\r\n\r\n/**\r\n* Updates the tilemap for each frame.\r\n*\r\n* @method update\r\n*/\r\nTilemap.prototype.update = function() {\r\n  this.animationCount++;\r\n  this.animationFrame = Math.floor(this.animationCount / 30);\r\n  this.children.forEach(function(child) {\r\n      if (child.update) {\r\n          child.update();\r\n      }\r\n  });\r\n  for (var i=0; i<this.bitmaps.length;i++) {\r\n      if (this.bitmaps[i]) {\r\n          this.bitmaps[i].touch();\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* Forces to repaint the entire tilemap.\r\n*\r\n* @method refresh\r\n*/\r\nTilemap.prototype.refresh = function() {\r\n  this._lastTiles.length = 0;\r\n};\r\n\r\n/**\r\n* Forces to refresh the tileset\r\n*\r\n* @method refresh\r\n*/\r\nTilemap.prototype.refreshTileset = function() {\r\n\r\n};\r\n\r\n/**\r\n* @method updateTransform\r\n* @private\r\n*/\r\nTilemap.prototype.updateTransform = function() {\r\n  var ox = Math.floor(this.origin.x);\r\n  var oy = Math.floor(this.origin.y);\r\n  var startX = Math.floor((ox - this._margin) / this._tileWidth);\r\n  var startY = Math.floor((oy - this._margin) / this._tileHeight);\r\n  this._updateLayerPositions(startX, startY);\r\n  if (this._needsRepaint || this._lastAnimationFrame !== this.animationFrame ||\r\n      this._lastStartX !== startX || this._lastStartY !== startY) {\r\n      this._frameUpdated = this._lastAnimationFrame !== this.animationFrame;\r\n      this._lastAnimationFrame = this.animationFrame;\r\n      this._lastStartX = startX;\r\n      this._lastStartY = startY;\r\n      this._paintAllTiles(startX, startY);\r\n      this._needsRepaint = false;\r\n  }\r\n  this._sortChildren();\r\n  PIXI.Container.prototype.updateTransform.call(this);\r\n};\r\n\r\n/**\r\n* @method _createLayers\r\n* @private\r\n*/\r\nTilemap.prototype._createLayers = function() {\r\n  var width = this._width;\r\n  var height = this._height;\r\n  var margin = this._margin;\r\n  var tileCols = Math.ceil(width / this._tileWidth) + 1;\r\n  var tileRows = Math.ceil(height / this._tileHeight) + 1;\r\n  var layerWidth = tileCols * this._tileWidth;\r\n  var layerHeight = tileRows * this._tileHeight;\r\n  this._lowerBitmap = new Bitmap(layerWidth, layerHeight);\r\n  this._upperBitmap = new Bitmap(layerWidth, layerHeight);\r\n  this._layerWidth = layerWidth;\r\n  this._layerHeight = layerHeight;\r\n\r\n  /*\r\n   * Z coordinate:\r\n   *\r\n   * 0 : Lower tiles\r\n   * 1 : Lower characters\r\n   * 3 : Normal characters\r\n   * 4 : Upper tiles\r\n   * 5 : Upper characters\r\n   * 6 : Airship shadow\r\n   * 7 : Balloon\r\n   * 8 : Animation\r\n   * 9 : Destination\r\n   */\r\n\r\n  this._lowerLayer = new Sprite();\r\n  this._lowerLayer.move(-margin, -margin, width, height);\r\n  this._lowerLayer.z = 0;\r\n\r\n  this._upperLayer = new Sprite();\r\n  this._upperLayer.move(-margin, -margin, width, height);\r\n  this._upperLayer.z = 4;\r\n\r\n  for (var i = 0; i < 4; i++) {\r\n      this._lowerLayer.addChild(new Sprite(this._lowerBitmap));\r\n      this._upperLayer.addChild(new Sprite(this._upperBitmap));\r\n  }\r\n\r\n  this.addChild(this._lowerLayer);\r\n  this.addChild(this._upperLayer);\r\n};\r\n\r\n/**\r\n* @method _updateLayerPositions\r\n* @param {Number} startX\r\n* @param {Number} startY\r\n* @private\r\n*/\r\nTilemap.prototype._updateLayerPositions = function(startX, startY) {\r\n  var m = this._margin;\r\n  var ox = Math.floor(this.origin.x);\r\n  var oy = Math.floor(this.origin.y);\r\n  var x2 = (ox - m).mod(this._layerWidth);\r\n  var y2 = (oy - m).mod(this._layerHeight);\r\n  var w1 = this._layerWidth - x2;\r\n  var h1 = this._layerHeight - y2;\r\n  var w2 = this._width - w1;\r\n  var h2 = this._height - h1;\r\n\r\n  for (var i = 0; i < 2; i++) {\r\n      var children;\r\n      if (i === 0) {\r\n          children = this._lowerLayer.children;\r\n      } else {\r\n          children = this._upperLayer.children;\r\n      }\r\n      children[0].move(0, 0, w1, h1);\r\n      children[0].setFrame(x2, y2, w1, h1);\r\n      children[1].move(w1, 0, w2, h1);\r\n      children[1].setFrame(0, y2, w2, h1);\r\n      children[2].move(0, h1, w1, h2);\r\n      children[2].setFrame(x2, 0, w1, h2);\r\n      children[3].move(w1, h1, w2, h2);\r\n      children[3].setFrame(0, 0, w2, h2);\r\n  }\r\n};\r\n\r\n/**\r\n* @method _paintAllTiles\r\n* @param {Number} startX\r\n* @param {Number} startY\r\n* @private\r\n*/\r\nTilemap.prototype._paintAllTiles = function(startX, startY) {\r\n  var tileCols = Math.ceil(this._width / this._tileWidth) + 1;\r\n  var tileRows = Math.ceil(this._height / this._tileHeight) + 1;\r\n  for (var y = 0; y < tileRows; y++) {\r\n      for (var x = 0; x < tileCols; x++) {\r\n          this._paintTiles(startX, startY, x, y);\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _paintTiles\r\n* @param {Number} startX\r\n* @param {Number} startY\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @private\r\n*/\r\nTilemap.prototype._paintTiles = function(startX, startY, x, y) {\r\n  var tableEdgeVirtualId = 10000;\r\n  var mx = startX + x;\r\n  var my = startY + y;\r\n  var dx = (mx * this._tileWidth).mod(this._layerWidth);\r\n  var dy = (my * this._tileHeight).mod(this._layerHeight);\r\n  var lx = dx / this._tileWidth;\r\n  var ly = dy / this._tileHeight;\r\n  var tileId0 = this._readMapData(mx, my, 0);\r\n  var tileId1 = this._readMapData(mx, my, 1);\r\n  var tileId2 = this._readMapData(mx, my, 2);\r\n  var tileId3 = this._readMapData(mx, my, 3);\r\n  var shadowBits = this._readMapData(mx, my, 4);\r\n  var upperTileId1 = this._readMapData(mx, my - 1, 1);\r\n  var lowerTiles = [];\r\n  var upperTiles = [];\r\n\r\n  if (this._isHigherTile(tileId0)) {\r\n      upperTiles.push(tileId0);\r\n  } else {\r\n      lowerTiles.push(tileId0);\r\n  }\r\n  if (this._isHigherTile(tileId1)) {\r\n      upperTiles.push(tileId1);\r\n  } else {\r\n      lowerTiles.push(tileId1);\r\n  }\r\n\r\n  lowerTiles.push(-shadowBits);\r\n\r\n  if (this._isTableTile(upperTileId1) && !this._isTableTile(tileId1)) {\r\n      if (!Tilemap.isShadowingTile(tileId0)) {\r\n          lowerTiles.push(tableEdgeVirtualId + upperTileId1);\r\n      }\r\n  }\r\n\r\n  if (this._isOverpassPosition(mx, my)) {\r\n      upperTiles.push(tileId2);\r\n      upperTiles.push(tileId3);\r\n  } else {\r\n      if (this._isHigherTile(tileId2)) {\r\n          upperTiles.push(tileId2);\r\n      } else {\r\n          lowerTiles.push(tileId2);\r\n      }\r\n      if (this._isHigherTile(tileId3)) {\r\n          upperTiles.push(tileId3);\r\n      } else {\r\n          lowerTiles.push(tileId3);\r\n      }\r\n  }\r\n\r\n  var lastLowerTiles = this._readLastTiles(0, lx, ly);\r\n  if (!lowerTiles.equals(lastLowerTiles) ||\r\n          (Tilemap.isTileA1(tileId0) && this._frameUpdated)) {\r\n      this._lowerBitmap.clearRect(dx, dy, this._tileWidth, this._tileHeight);\r\n      for (var i = 0; i < lowerTiles.length; i++) {\r\n          var lowerTileId = lowerTiles[i];\r\n          if (lowerTileId < 0) {\r\n              this._drawShadow(this._lowerBitmap, shadowBits, dx, dy);\r\n          } else if (lowerTileId >= tableEdgeVirtualId) {\r\n              this._drawTableEdge(this._lowerBitmap, upperTileId1, dx, dy);\r\n          } else {\r\n              this._drawTile(this._lowerBitmap, lowerTileId, dx, dy);\r\n          }\r\n      }\r\n      this._writeLastTiles(0, lx, ly, lowerTiles);\r\n  }\r\n\r\n  var lastUpperTiles = this._readLastTiles(1, lx, ly);\r\n  if (!upperTiles.equals(lastUpperTiles)) {\r\n      this._upperBitmap.clearRect(dx, dy, this._tileWidth, this._tileHeight);\r\n      for (var j = 0; j < upperTiles.length; j++) {\r\n          this._drawTile(this._upperBitmap, upperTiles[j], dx, dy);\r\n      }\r\n      this._writeLastTiles(1, lx, ly, upperTiles);\r\n  }\r\n};\r\n\r\n/**\r\n* @method _readLastTiles\r\n* @param {Number} i\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @private\r\n*/\r\nTilemap.prototype._readLastTiles = function(i, x, y) {\r\n  var array1 = this._lastTiles[i];\r\n  if (array1) {\r\n      var array2 = array1[y];\r\n      if (array2) {\r\n          var tiles = array2[x];\r\n          if (tiles) {\r\n              return tiles;\r\n          }\r\n      }\r\n  }\r\n  return [];\r\n};\r\n\r\n/**\r\n* @method _writeLastTiles\r\n* @param {Number} i\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @param {Array} tiles\r\n* @private\r\n*/\r\nTilemap.prototype._writeLastTiles = function(i, x, y, tiles) {\r\n  var array1 = this._lastTiles[i];\r\n  if (!array1) {\r\n      array1 = this._lastTiles[i] = [];\r\n  }\r\n  var array2 = array1[y];\r\n  if (!array2) {\r\n      array2 = array1[y] = [];\r\n  }\r\n  array2[x] = tiles;\r\n};\r\n\r\n/**\r\n* @method _drawTile\r\n* @param {Bitmap} bitmap\r\n* @param {Number} tileId\r\n* @param {Number} dx\r\n* @param {Number} dy\r\n* @private\r\n*/\r\nTilemap.prototype._drawTile = function(bitmap, tileId, dx, dy) {\r\n  if (Tilemap.isVisibleTile(tileId)) {\r\n      if (Tilemap.isAutotile(tileId)) {\r\n          this._drawAutotile(bitmap, tileId, dx, dy);\r\n      } else {\r\n          this._drawNormalTile(bitmap, tileId, dx, dy);\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _drawNormalTile\r\n* @param {Bitmap} bitmap\r\n* @param {Number} tileId\r\n* @param {Number} dx\r\n* @param {Number} dy\r\n* @private\r\n*/\r\nTilemap.prototype._drawNormalTile = function(bitmap, tileId, dx, dy) {\r\n  var setNumber = 0;\r\n\r\n  if (Tilemap.isTileA5(tileId)) {\r\n      setNumber = 4;\r\n  } else {\r\n      setNumber = 5 + Math.floor(tileId / 256);\r\n  }\r\n\r\n  var w = this._tileWidth;\r\n  var h = this._tileHeight;\r\n  var sx = (Math.floor(tileId / 128) % 2 * 8 + tileId % 8) * w;\r\n  var sy = (Math.floor(tileId % 256 / 8) % 16) * h;\r\n\r\n  var source = this.bitmaps[setNumber];\r\n  if (source) {\r\n      bitmap.bltImage(source, sx, sy, w, h, dx, dy, w, h);\r\n  }\r\n};\r\n\r\n/**\r\n* @method _drawAutotile\r\n* @param {Bitmap} bitmap\r\n* @param {Number} tileId\r\n* @param {Number} dx\r\n* @param {Number} dy\r\n* @private\r\n*/\r\nTilemap.prototype._drawAutotile = function(bitmap, tileId, dx, dy) {\r\n  var autotileTable = Tilemap.FLOOR_AUTOTILE_TABLE;\r\n  var kind = Tilemap.getAutotileKind(tileId);\r\n  var shape = Tilemap.getAutotileShape(tileId);\r\n  var tx = kind % 8;\r\n  var ty = Math.floor(kind / 8);\r\n  var bx = 0;\r\n  var by = 0;\r\n  var setNumber = 0;\r\n  var isTable = false;\r\n\r\n  if (Tilemap.isTileA1(tileId)) {\r\n      var waterSurfaceIndex = [0, 1, 2, 1][this.animationFrame % 4];\r\n      setNumber = 0;\r\n      if (kind === 0) {\r\n          bx = waterSurfaceIndex * 2;\r\n          by = 0;\r\n      } else if (kind === 1) {\r\n          bx = waterSurfaceIndex * 2;\r\n          by = 3;\r\n      } else if (kind === 2) {\r\n          bx = 6;\r\n          by = 0;\r\n      } else if (kind === 3) {\r\n          bx = 6;\r\n          by = 3;\r\n      } else {\r\n          bx = Math.floor(tx / 4) * 8;\r\n          by = ty * 6 + Math.floor(tx / 2) % 2 * 3;\r\n          if (kind % 2 === 0) {\r\n              bx += waterSurfaceIndex * 2;\r\n          }\r\n          else {\r\n              bx += 6;\r\n              autotileTable = Tilemap.WATERFALL_AUTOTILE_TABLE;\r\n              by += this.animationFrame % 3;\r\n          }\r\n      }\r\n  } else if (Tilemap.isTileA2(tileId)) {\r\n      setNumber = 1;\r\n      bx = tx * 2;\r\n      by = (ty - 2) * 3;\r\n      isTable = this._isTableTile(tileId);\r\n  } else if (Tilemap.isTileA3(tileId)) {\r\n      setNumber = 2;\r\n      bx = tx * 2;\r\n      by = (ty - 6) * 2;\r\n      autotileTable = Tilemap.WALL_AUTOTILE_TABLE;\r\n  } else if (Tilemap.isTileA4(tileId)) {\r\n      setNumber = 3;\r\n      bx = tx * 2;\r\n      by = Math.floor((ty - 10) * 2.5 + (ty % 2 === 1 ? 0.5 : 0));\r\n      if (ty % 2 === 1) {\r\n          autotileTable = Tilemap.WALL_AUTOTILE_TABLE;\r\n      }\r\n  }\r\n\r\n  var table = autotileTable[shape];\r\n  var source = this.bitmaps[setNumber];\r\n\r\n  if (table && source) {\r\n      var w1 = this._tileWidth / 2;\r\n      var h1 = this._tileHeight / 2;\r\n      for (var i = 0; i < 4; i++) {\r\n          var qsx = table[i][0];\r\n          var qsy = table[i][1];\r\n          var sx1 = (bx * 2 + qsx) * w1;\r\n          var sy1 = (by * 2 + qsy) * h1;\r\n          var dx1 = dx + (i % 2) * w1;\r\n          var dy1 = dy + Math.floor(i / 2) * h1;\r\n          if (isTable && (qsy === 1 || qsy === 5)) {\r\n              var qsx2 = qsx;\r\n              var qsy2 = 3;\r\n              if (qsy === 1) {\r\n                  qsx2 = [0,3,2,1][qsx];\r\n              }\r\n              var sx2 = (bx * 2 + qsx2) * w1;\r\n              var sy2 = (by * 2 + qsy2) * h1;\r\n              bitmap.bltImage(source, sx2, sy2, w1, h1, dx1, dy1, w1, h1);\r\n              dy1 += h1/2;\r\n              bitmap.bltImage(source, sx1, sy1, w1, h1/2, dx1, dy1, w1, h1/2);\r\n          } else {\r\n              bitmap.bltImage(source, sx1, sy1, w1, h1, dx1, dy1, w1, h1);\r\n          }\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _drawTableEdge\r\n* @param {Bitmap} bitmap\r\n* @param {Number} tileId\r\n* @param {Number} dx\r\n* @param {Number} dy\r\n* @private\r\n*/\r\nTilemap.prototype._drawTableEdge = function(bitmap, tileId, dx, dy) {\r\n  if (Tilemap.isTileA2(tileId)) {\r\n      var autotileTable = Tilemap.FLOOR_AUTOTILE_TABLE;\r\n      var kind = Tilemap.getAutotileKind(tileId);\r\n      var shape = Tilemap.getAutotileShape(tileId);\r\n      var tx = kind % 8;\r\n      var ty = Math.floor(kind / 8);\r\n      var setNumber = 1;\r\n      var bx = tx * 2;\r\n      var by = (ty - 2) * 3;\r\n      var table = autotileTable[shape];\r\n\r\n      if (table) {\r\n          var source = this.bitmaps[setNumber];\r\n          var w1 = this._tileWidth / 2;\r\n          var h1 = this._tileHeight / 2;\r\n          for (var i = 0; i < 2; i++) {\r\n              var qsx = table[2 + i][0];\r\n              var qsy = table[2 + i][1];\r\n              var sx1 = (bx * 2 + qsx) * w1;\r\n              var sy1 = (by * 2 + qsy) * h1 + h1/2;\r\n              var dx1 = dx + (i % 2) * w1;\r\n              var dy1 = dy + Math.floor(i / 2) * h1;\r\n              bitmap.bltImage(source, sx1, sy1, w1, h1/2, dx1, dy1, w1, h1/2);\r\n          }\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _drawShadow\r\n* @param {Bitmap} bitmap\r\n* @param {Number} shadowBits\r\n* @param {Number} dx\r\n* @param {Number} dy\r\n* @private\r\n*/\r\nTilemap.prototype._drawShadow = function(bitmap, shadowBits, dx, dy) {\r\n  if (shadowBits & 0x0f) {\r\n      var w1 = this._tileWidth / 2;\r\n      var h1 = this._tileHeight / 2;\r\n      var color = 'rgba(0,0,0,0.5)';\r\n      for (var i = 0; i < 4; i++) {\r\n          if (shadowBits & (1 << i)) {\r\n              var dx1 = dx + (i % 2) * w1;\r\n              var dy1 = dy + Math.floor(i / 2) * h1;\r\n              bitmap.fillRect(dx1, dy1, w1, h1, color);\r\n          }\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _readMapData\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @param {Number} z\r\n* @return {Number}\r\n* @private\r\n*/\r\nTilemap.prototype._readMapData = function(x, y, z) {\r\n  if (this._mapData) {\r\n      var width = this._mapWidth;\r\n      var height = this._mapHeight;\r\n      if (this.horizontalWrap) {\r\n          x = x.mod(width);\r\n      }\r\n      if (this.verticalWrap) {\r\n          y = y.mod(height);\r\n      }\r\n      if (x >= 0 && x < width && y >= 0 && y < height) {\r\n          return this._mapData[(z * height + y) * width + x] || 0;\r\n      } else {\r\n          return 0;\r\n      }\r\n  } else {\r\n      return 0;\r\n  }\r\n};\r\n\r\n/**\r\n* @method _isHigherTile\r\n* @param {Number} tileId\r\n* @return {Boolean}\r\n* @private\r\n*/\r\nTilemap.prototype._isHigherTile = function(tileId) {\r\n  return this.flags[tileId] & 0x10;\r\n};\r\n\r\n/**\r\n* @method _isTableTile\r\n* @param {Number} tileId\r\n* @return {Boolean}\r\n* @private\r\n*/\r\nTilemap.prototype._isTableTile = function(tileId) {\r\n  return Tilemap.isTileA2(tileId) && (this.flags[tileId] & 0x80);\r\n};\r\n\r\n/**\r\n* @method _isOverpassPosition\r\n* @param {Number} mx\r\n* @param {Number} my\r\n* @return {Boolean}\r\n* @private\r\n*/\r\nTilemap.prototype._isOverpassPosition = function(mx, my) {\r\n  return false;\r\n};\r\n\r\n/**\r\n* @method _sortChildren\r\n* @private\r\n*/\r\nTilemap.prototype._sortChildren = function() {\r\n  this.children.sort(this._compareChildOrder.bind(this));\r\n};\r\n\r\n/**\r\n* @method _compareChildOrder\r\n* @param {Object} a\r\n* @param {Object} b\r\n* @private\r\n*/\r\nTilemap.prototype._compareChildOrder = function(a, b) {\r\n  if (a.z !== b.z) {\r\n      return a.z - b.z;\r\n  } else if (a.y !== b.y) {\r\n      return a.y - b.y;\r\n  } else {\r\n      return a.spriteId - b.spriteId;\r\n  }\r\n};\r\n\r\n// Tile type checkers\r\n\r\nTilemap.TILE_ID_B      = 0;\r\nTilemap.TILE_ID_C      = 256;\r\nTilemap.TILE_ID_D      = 512;\r\nTilemap.TILE_ID_E      = 768;\r\nTilemap.TILE_ID_A5     = 1536;\r\nTilemap.TILE_ID_A1     = 2048;\r\nTilemap.TILE_ID_A2     = 2816;\r\nTilemap.TILE_ID_A3     = 4352;\r\nTilemap.TILE_ID_A4     = 5888;\r\nTilemap.TILE_ID_MAX    = 8192;\r\n\r\nTilemap.isVisibleTile = function(tileId) {\r\n  return tileId > 0 && tileId < this.TILE_ID_MAX;\r\n};\r\n\r\nTilemap.isAutotile = function(tileId) {\r\n  return tileId >= this.TILE_ID_A1;\r\n};\r\n\r\nTilemap.getAutotileKind = function(tileId) {\r\n  return Math.floor((tileId - this.TILE_ID_A1) / 48);\r\n};\r\n\r\nTilemap.getAutotileShape = function(tileId) {\r\n  return (tileId - this.TILE_ID_A1) % 48;\r\n};\r\n\r\nTilemap.makeAutotileId = function(kind, shape) {\r\n  return this.TILE_ID_A1 + kind * 48 + shape;\r\n};\r\n\r\nTilemap.isSameKindTile = function(tileID1, tileID2) {\r\n  if (this.isAutotile(tileID1) && this.isAutotile(tileID2)) {\r\n      return this.getAutotileKind(tileID1) === this.getAutotileKind(tileID2);\r\n  } else {\r\n      return tileID1 === tileID2;\r\n  }\r\n};\r\n\r\nTilemap.isTileA1 = function(tileId) {\r\n  return tileId >= this.TILE_ID_A1 && tileId < this.TILE_ID_A2;\r\n};\r\n\r\nTilemap.isTileA2 = function(tileId) {\r\n  return tileId >= this.TILE_ID_A2 && tileId < this.TILE_ID_A3;\r\n};\r\n\r\nTilemap.isTileA3 = function(tileId) {\r\n  return tileId >= this.TILE_ID_A3 && tileId < this.TILE_ID_A4;\r\n};\r\n\r\nTilemap.isTileA4 = function(tileId) {\r\n  return tileId >= this.TILE_ID_A4 && tileId < this.TILE_ID_MAX;\r\n};\r\n\r\nTilemap.isTileA5 = function(tileId) {\r\n  return tileId >= this.TILE_ID_A5 && tileId < this.TILE_ID_A1;\r\n};\r\n\r\nTilemap.isWaterTile = function(tileId) {\r\n  if (this.isTileA1(tileId)) {\r\n      return !(tileId >= this.TILE_ID_A1 + 96 && tileId < this.TILE_ID_A1 + 192);\r\n  } else {\r\n      return false;\r\n  }\r\n};\r\n\r\nTilemap.isWaterfallTile = function(tileId) {\r\n  if (tileId >= this.TILE_ID_A1 + 192 && tileId < this.TILE_ID_A2) {\r\n      return this.getAutotileKind(tileId) % 2 === 1;\r\n  } else {\r\n      return false;\r\n  }\r\n};\r\n\r\nTilemap.isGroundTile = function(tileId) {\r\n  return this.isTileA1(tileId) || this.isTileA2(tileId) || this.isTileA5(tileId);\r\n};\r\n\r\nTilemap.isShadowingTile = function(tileId) {\r\n  return this.isTileA3(tileId) || this.isTileA4(tileId);\r\n};\r\n\r\nTilemap.isRoofTile = function(tileId) {\r\n  return this.isTileA3(tileId) && this.getAutotileKind(tileId) % 16 < 8;\r\n};\r\n\r\nTilemap.isWallTopTile = function(tileId) {\r\n  return this.isTileA4(tileId) && this.getAutotileKind(tileId) % 16 < 8;\r\n};\r\n\r\nTilemap.isWallSideTile = function(tileId) {\r\n  return (this.isTileA3(tileId) || this.isTileA4(tileId)) &&\r\n          this.getAutotileKind(tileId) % 16 >= 8;\r\n};\r\n\r\nTilemap.isWallTile = function(tileId) {\r\n  return this.isWallTopTile(tileId) || this.isWallSideTile(tileId);\r\n};\r\n\r\nTilemap.isFloorTypeAutotile = function(tileId) {\r\n  return (this.isTileA1(tileId) && !this.isWaterfallTile(tileId)) ||\r\n          this.isTileA2(tileId) || this.isWallTopTile(tileId);\r\n};\r\n\r\nTilemap.isWallTypeAutotile = function(tileId) {\r\n  return this.isRoofTile(tileId) || this.isWallSideTile(tileId);\r\n};\r\n\r\nTilemap.isWaterfallTypeAutotile = function(tileId) {\r\n  return this.isWaterfallTile(tileId);\r\n};\r\n\r\n// Autotile shape number to coordinates of tileset images\r\n\r\nTilemap.FLOOR_AUTOTILE_TABLE = [\r\n  [[2,4],[1,4],[2,3],[1,3]],[[2,0],[1,4],[2,3],[1,3]],\r\n  [[2,4],[3,0],[2,3],[1,3]],[[2,0],[3,0],[2,3],[1,3]],\r\n  [[2,4],[1,4],[2,3],[3,1]],[[2,0],[1,4],[2,3],[3,1]],\r\n  [[2,4],[3,0],[2,3],[3,1]],[[2,0],[3,0],[2,3],[3,1]],\r\n  [[2,4],[1,4],[2,1],[1,3]],[[2,0],[1,4],[2,1],[1,3]],\r\n  [[2,4],[3,0],[2,1],[1,3]],[[2,0],[3,0],[2,1],[1,3]],\r\n  [[2,4],[1,4],[2,1],[3,1]],[[2,0],[1,4],[2,1],[3,1]],\r\n  [[2,4],[3,0],[2,1],[3,1]],[[2,0],[3,0],[2,1],[3,1]],\r\n  [[0,4],[1,4],[0,3],[1,3]],[[0,4],[3,0],[0,3],[1,3]],\r\n  [[0,4],[1,4],[0,3],[3,1]],[[0,4],[3,0],[0,3],[3,1]],\r\n  [[2,2],[1,2],[2,3],[1,3]],[[2,2],[1,2],[2,3],[3,1]],\r\n  [[2,2],[1,2],[2,1],[1,3]],[[2,2],[1,2],[2,1],[3,1]],\r\n  [[2,4],[3,4],[2,3],[3,3]],[[2,4],[3,4],[2,1],[3,3]],\r\n  [[2,0],[3,4],[2,3],[3,3]],[[2,0],[3,4],[2,1],[3,3]],\r\n  [[2,4],[1,4],[2,5],[1,5]],[[2,0],[1,4],[2,5],[1,5]],\r\n  [[2,4],[3,0],[2,5],[1,5]],[[2,0],[3,0],[2,5],[1,5]],\r\n  [[0,4],[3,4],[0,3],[3,3]],[[2,2],[1,2],[2,5],[1,5]],\r\n  [[0,2],[1,2],[0,3],[1,3]],[[0,2],[1,2],[0,3],[3,1]],\r\n  [[2,2],[3,2],[2,3],[3,3]],[[2,2],[3,2],[2,1],[3,3]],\r\n  [[2,4],[3,4],[2,5],[3,5]],[[2,0],[3,4],[2,5],[3,5]],\r\n  [[0,4],[1,4],[0,5],[1,5]],[[0,4],[3,0],[0,5],[1,5]],\r\n  [[0,2],[3,2],[0,3],[3,3]],[[0,2],[1,2],[0,5],[1,5]],\r\n  [[0,4],[3,4],[0,5],[3,5]],[[2,2],[3,2],[2,5],[3,5]],\r\n  [[0,2],[3,2],[0,5],[3,5]],[[0,0],[1,0],[0,1],[1,1]]\r\n];\r\n\r\nTilemap.WALL_AUTOTILE_TABLE = [\r\n  [[2,2],[1,2],[2,1],[1,1]],[[0,2],[1,2],[0,1],[1,1]],\r\n  [[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],\r\n  [[2,2],[3,2],[2,1],[3,1]],[[0,2],[3,2],[0,1],[3,1]],\r\n  [[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]],\r\n  [[2,2],[1,2],[2,3],[1,3]],[[0,2],[1,2],[0,3],[1,3]],\r\n  [[2,0],[1,0],[2,3],[1,3]],[[0,0],[1,0],[0,3],[1,3]],\r\n  [[2,2],[3,2],[2,3],[3,3]],[[0,2],[3,2],[0,3],[3,3]],\r\n  [[2,0],[3,0],[2,3],[3,3]],[[0,0],[3,0],[0,3],[3,3]]\r\n];\r\n\r\nTilemap.WATERFALL_AUTOTILE_TABLE = [\r\n  [[2,0],[1,0],[2,1],[1,1]],[[0,0],[1,0],[0,1],[1,1]],\r\n  [[2,0],[3,0],[2,1],[3,1]],[[0,0],[3,0],[0,1],[3,1]]\r\n];\r\n\r\n// The important members from Pixi.js\r\n\r\n/**\r\n* [read-only] The array of children of the tilemap.\r\n*\r\n* @property children\r\n* @type Array\r\n*/\r\n\r\n/**\r\n* [read-only] The object that contains the tilemap.\r\n*\r\n* @property parent\r\n* @type Object\r\n*/\r\n\r\n/**\r\n* Adds a child to the container.\r\n*\r\n* @method addChild\r\n* @param {Object} child The child to add\r\n* @return {Object} The child that was added\r\n*/\r\n\r\n/**\r\n* Adds a child to the container at a specified index.\r\n*\r\n* @method addChildAt\r\n* @param {Object} child The child to add\r\n* @param {Number} index The index to place the child in\r\n* @return {Object} The child that was added\r\n*/\r\n\r\n/**\r\n* Removes a child from the container.\r\n*\r\n* @method removeChild\r\n* @param {Object} child The child to remove\r\n* @return {Object} The child that was removed\r\n*/\r\n\r\n/**\r\n* Removes a child from the specified index position.\r\n*\r\n* @method removeChildAt\r\n* @param {Number} index The index to get the child from\r\n* @return {Object} The child that was removed\r\n*/\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The tilemap which displays 2D tile-based game map using shaders\r\n*\r\n* @class Tilemap\r\n* @constructor\r\n*/\r\nfunction ShaderTilemap() {\r\n  Tilemap.apply(this, arguments);\r\n  this.roundPixels = true;\r\n}\r\n\r\nShaderTilemap.prototype = Object.create(Tilemap.prototype);\r\nShaderTilemap.prototype.constructor = ShaderTilemap;\r\n\r\n// we need this constant for some platforms (Samsung S4, S5, Tab4, HTC One H8)\r\nPIXI.glCore.VertexArrayObject.FORCE_NATIVE = true;\r\nPIXI.settings.GC_MODE = PIXI.GC_MODES.AUTO;\r\nPIXI.tilemap.TileRenderer.SCALE_MODE = PIXI.SCALE_MODES.NEAREST;\r\nPIXI.tilemap.TileRenderer.DO_CLEAR = true;\r\n\r\n/**\r\n* Uploads animation state in renderer\r\n*\r\n* @method _hackRenderer\r\n* @private\r\n*/\r\nShaderTilemap.prototype._hackRenderer = function(renderer) {\r\n  var af = this.animationFrame % 4;\r\n  if (af==3) af = 1;\r\n  renderer.plugins.tilemap.tileAnim[0] = af * this._tileWidth;\r\n  renderer.plugins.tilemap.tileAnim[1] = (this.animationFrame % 3) * this._tileHeight;\r\n  return renderer;\r\n};\r\n\r\n/**\r\n* PIXI render method\r\n*\r\n* @method renderCanvas\r\n* @param {Object} pixi renderer\r\n*/\r\nShaderTilemap.prototype.renderCanvas = function(renderer) {\r\n  this._hackRenderer(renderer);\r\n  PIXI.Container.prototype.renderCanvas.call(this, renderer);\r\n};\r\n\r\n\r\n/**\r\n* PIXI render method\r\n*\r\n* @method renderWebGL\r\n* @param {Object} pixi renderer\r\n*/\r\nShaderTilemap.prototype.renderWebGL = function(renderer) {\r\n  this._hackRenderer(renderer);\r\n  PIXI.Container.prototype.renderWebGL.call(this, renderer);\r\n};\r\n\r\n/**\r\n* Forces to repaint the entire tilemap AND update bitmaps list if needed\r\n*\r\n* @method refresh\r\n*/\r\nShaderTilemap.prototype.refresh = function() {\r\n  if (this._lastBitmapLength !== this.bitmaps.length) {\r\n      this._lastBitmapLength = this.bitmaps.length;\r\n      this.refreshTileset();\r\n  };\r\n  this._needsRepaint = true;\r\n};\r\n\r\n/**\r\n* Call after you update tileset\r\n*\r\n* @method updateBitmaps\r\n*/\r\nShaderTilemap.prototype.refreshTileset = function() {\r\n  var bitmaps = this.bitmaps.map(function(x) { return x._baseTexture ? new PIXI.Texture(x._baseTexture) : x; } );\r\n  this.lowerLayer.setBitmaps(bitmaps);\r\n  this.upperLayer.setBitmaps(bitmaps);\r\n};\r\n\r\n/**\r\n* @method updateTransform\r\n* @private\r\n*/\r\nShaderTilemap.prototype.updateTransform = function() {\r\n  if (this.roundPixels) {\r\n      var ox = Math.floor(this.origin.x);\r\n      var oy = Math.floor(this.origin.y);\r\n  } else {\r\n      ox = this.origin.x;\r\n      oy = this.origin.y;\r\n  }\r\n  var startX = Math.floor((ox - this._margin) / this._tileWidth);\r\n  var startY = Math.floor((oy - this._margin) / this._tileHeight);\r\n  this._updateLayerPositions(startX, startY);\r\n  if (this._needsRepaint ||\r\n      this._lastStartX !== startX || this._lastStartY !== startY) {\r\n      this._lastStartX = startX;\r\n      this._lastStartY = startY;\r\n      this._paintAllTiles(startX, startY);\r\n      this._needsRepaint = false;\r\n  }\r\n  this._sortChildren();\r\n  PIXI.Container.prototype.updateTransform.call(this);\r\n};\r\n\r\n/**\r\n* @method _createLayers\r\n* @private\r\n*/\r\nShaderTilemap.prototype._createLayers = function() {\r\n  var width = this._width;\r\n  var height = this._height;\r\n  var margin = this._margin;\r\n  var tileCols = Math.ceil(width / this._tileWidth) + 1;\r\n  var tileRows = Math.ceil(height / this._tileHeight) + 1;\r\n  var layerWidth = this._layerWidth = tileCols * this._tileWidth;\r\n  var layerHeight = this._layerHeight = tileRows * this._tileHeight;\r\n  this._needsRepaint = true;\r\n\r\n  if (!this.lowerZLayer) {\r\n      //@hackerham: create layers only in initialization. Doesn't depend on width/height\r\n      this.addChild(this.lowerZLayer = new PIXI.tilemap.ZLayer(this, 0));\r\n      this.addChild(this.upperZLayer = new PIXI.tilemap.ZLayer(this, 4));\r\n\r\n      var parameters = PluginManager.parameters('ShaderTilemap');\r\n      var useSquareShader = Number(parameters.hasOwnProperty('squareShader') ? parameters['squareShader'] : 0);\r\n\r\n      this.lowerZLayer.addChild(this.lowerLayer = new PIXI.tilemap.CompositeRectTileLayer(0, [], useSquareShader));\r\n      this.lowerLayer.shadowColor = new Float32Array([0.0, 0.0, 0.0, 0.5]);\r\n      this.upperZLayer.addChild(this.upperLayer = new PIXI.tilemap.CompositeRectTileLayer(4, [], useSquareShader));\r\n  }\r\n};\r\n\r\n/**\r\n* @method _updateLayerPositions\r\n* @param {Number} startX\r\n* @param {Number} startY\r\n* @private\r\n*/\r\nShaderTilemap.prototype._updateLayerPositions = function(startX, startY) {\r\n  if (this.roundPixels) {\r\n      var ox = Math.floor(this.origin.x);\r\n      var oy = Math.floor(this.origin.y);\r\n  } else {\r\n      ox = this.origin.x;\r\n      oy = this.origin.y;\r\n  }\r\n  this.lowerZLayer.position.x = startX * this._tileWidth - ox;\r\n  this.lowerZLayer.position.y = startY * this._tileHeight - oy;\r\n  this.upperZLayer.position.x = startX * this._tileWidth - ox;\r\n  this.upperZLayer.position.y = startY * this._tileHeight - oy;\r\n};\r\n\r\n/**\r\n* @method _paintAllTiles\r\n* @param {Number} startX\r\n* @param {Number} startY\r\n* @private\r\n*/\r\nShaderTilemap.prototype._paintAllTiles = function(startX, startY) {\r\n  this.lowerZLayer.clear();\r\n  this.upperZLayer.clear();\r\n  var tileCols = Math.ceil(this._width / this._tileWidth) + 1;\r\n  var tileRows = Math.ceil(this._height / this._tileHeight) + 1;\r\n  for (var y = 0; y < tileRows; y++) {\r\n      for (var x = 0; x < tileCols; x++) {\r\n          this._paintTiles(startX, startY, x, y);\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _paintTiles\r\n* @param {Number} startX\r\n* @param {Number} startY\r\n* @param {Number} x\r\n* @param {Number} y\r\n* @private\r\n*/\r\nShaderTilemap.prototype._paintTiles = function(startX, startY, x, y) {\r\n  var mx = startX + x;\r\n  var my = startY + y;\r\n  var dx = x * this._tileWidth, dy = y * this._tileHeight;\r\n  var tileId0 = this._readMapData(mx, my, 0);\r\n  var tileId1 = this._readMapData(mx, my, 1);\r\n  var tileId2 = this._readMapData(mx, my, 2);\r\n  var tileId3 = this._readMapData(mx, my, 3);\r\n  var shadowBits = this._readMapData(mx, my, 4);\r\n  var upperTileId1 = this._readMapData(mx, my - 1, 1);\r\n  var lowerLayer = this.lowerLayer.children[0];\r\n  var upperLayer = this.upperLayer.children[0];\r\n\r\n  if (this._isHigherTile(tileId0)) {\r\n      this._drawTile(upperLayer, tileId0, dx, dy);\r\n  } else {\r\n      this._drawTile(lowerLayer, tileId0, dx, dy);\r\n  }\r\n  if (this._isHigherTile(tileId1)) {\r\n      this._drawTile(upperLayer, tileId1, dx, dy);\r\n  } else {\r\n      this._drawTile(lowerLayer, tileId1, dx, dy);\r\n  }\r\n\r\n  this._drawShadow(lowerLayer, shadowBits, dx, dy);\r\n  if (this._isTableTile(upperTileId1) && !this._isTableTile(tileId1)) {\r\n      if (!Tilemap.isShadowingTile(tileId0)) {\r\n          this._drawTableEdge(lowerLayer, upperTileId1, dx, dy);\r\n      }\r\n  }\r\n\r\n  if (this._isOverpassPosition(mx, my)) {\r\n      this._drawTile(upperLayer, tileId2, dx, dy);\r\n      this._drawTile(upperLayer, tileId3, dx, dy);\r\n  } else {\r\n      if (this._isHigherTile(tileId2)) {\r\n          this._drawTile(upperLayer, tileId2, dx, dy);\r\n      } else {\r\n          this._drawTile(lowerLayer, tileId2, dx, dy);\r\n      }\r\n      if (this._isHigherTile(tileId3)) {\r\n          this._drawTile(upperLayer, tileId3, dx, dy);\r\n      } else {\r\n          this._drawTile(lowerLayer, tileId3, dx, dy);\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _drawTile\r\n* @param {Array} layers\r\n* @param {Number} tileId\r\n* @param {Number} dx\r\n* @param {Number} dy\r\n* @private\r\n*/\r\nShaderTilemap.prototype._drawTile = function(layer, tileId, dx, dy) {\r\n  if (Tilemap.isVisibleTile(tileId)) {\r\n      if (Tilemap.isAutotile(tileId)) {\r\n          this._drawAutotile(layer, tileId, dx, dy);\r\n      } else {\r\n          this._drawNormalTile(layer, tileId, dx, dy);\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _drawNormalTile\r\n* @param {Array} layers\r\n* @param {Number} tileId\r\n* @param {Number} dx\r\n* @param {Number} dy\r\n* @private\r\n*/\r\nShaderTilemap.prototype._drawNormalTile = function(layer, tileId, dx, dy) {\r\n  var setNumber = 0;\r\n\r\n  if (Tilemap.isTileA5(tileId)) {\r\n      setNumber = 4;\r\n  } else {\r\n      setNumber = 5 + Math.floor(tileId / 256);\r\n  }\r\n\r\n  var w = this._tileWidth;\r\n  var h = this._tileHeight;\r\n  var sx = (Math.floor(tileId / 128) % 2 * 8 + tileId % 8) * w;\r\n  var sy = (Math.floor(tileId % 256 / 8) % 16) * h;\r\n\r\n  layer.addRect(setNumber, sx, sy, dx, dy, w, h);\r\n};\r\n\r\n/**\r\n* @method _drawAutotile\r\n* @param {Array} layers\r\n* @param {Number} tileId\r\n* @param {Number} dx\r\n* @param {Number} dy\r\n* @private\r\n*/\r\nShaderTilemap.prototype._drawAutotile = function(layer, tileId, dx, dy) {\r\n  var autotileTable = Tilemap.FLOOR_AUTOTILE_TABLE;\r\n  var kind = Tilemap.getAutotileKind(tileId);\r\n  var shape = Tilemap.getAutotileShape(tileId);\r\n  var tx = kind % 8;\r\n  var ty = Math.floor(kind / 8);\r\n  var bx = 0;\r\n  var by = 0;\r\n  var setNumber = 0;\r\n  var isTable = false;\r\n  var animX = 0, animY = 0;\r\n\r\n  if (Tilemap.isTileA1(tileId)) {\r\n      setNumber = 0;\r\n      if (kind === 0) {\r\n          animX = 2;\r\n          by = 0;\r\n      } else if (kind === 1) {\r\n          animX = 2;\r\n          by = 3;\r\n      } else if (kind === 2) {\r\n          bx = 6;\r\n          by = 0;\r\n      } else if (kind === 3) {\r\n          bx = 6;\r\n          by = 3;\r\n      } else {\r\n          bx = Math.floor(tx / 4) * 8;\r\n          by = ty * 6 + Math.floor(tx / 2) % 2 * 3;\r\n          if (kind % 2 === 0) {\r\n              animX = 2;\r\n          }\r\n          else {\r\n              bx += 6;\r\n              autotileTable = Tilemap.WATERFALL_AUTOTILE_TABLE;\r\n              animY = 1;\r\n          }\r\n      }\r\n  } else if (Tilemap.isTileA2(tileId)) {\r\n      setNumber = 1;\r\n      bx = tx * 2;\r\n      by = (ty - 2) * 3;\r\n      isTable = this._isTableTile(tileId);\r\n  } else if (Tilemap.isTileA3(tileId)) {\r\n      setNumber = 2;\r\n      bx = tx * 2;\r\n      by = (ty - 6) * 2;\r\n      autotileTable = Tilemap.WALL_AUTOTILE_TABLE;\r\n  } else if (Tilemap.isTileA4(tileId)) {\r\n      setNumber = 3;\r\n      bx = tx * 2;\r\n      by = Math.floor((ty - 10) * 2.5 + (ty % 2 === 1 ? 0.5 : 0));\r\n      if (ty % 2 === 1) {\r\n          autotileTable = Tilemap.WALL_AUTOTILE_TABLE;\r\n      }\r\n  }\r\n\r\n  var table = autotileTable[shape];\r\n  var w1 = this._tileWidth / 2;\r\n  var h1 = this._tileHeight / 2;\r\n  for (var i = 0; i < 4; i++) {\r\n      var qsx = table[i][0];\r\n      var qsy = table[i][1];\r\n      var sx1 = (bx * 2 + qsx) * w1;\r\n      var sy1 = (by * 2 + qsy) * h1;\r\n      var dx1 = dx + (i % 2) * w1;\r\n      var dy1 = dy + Math.floor(i / 2) * h1;\r\n      if (isTable && (qsy === 1 || qsy === 5)) {\r\n          var qsx2 = qsx;\r\n          var qsy2 = 3;\r\n          if (qsy === 1) {\r\n              //qsx2 = [0, 3, 2, 1][qsx];\r\n              qsx2 = (4-qsx)%4;\r\n          }\r\n          var sx2 = (bx * 2 + qsx2) * w1;\r\n          var sy2 = (by * 2 + qsy2) * h1;\r\n          layer.addRect(setNumber, sx2, sy2, dx1, dy1, w1, h1, animX, animY);\r\n          layer.addRect(setNumber, sx1, sy1, dx1, dy1+h1/2, w1, h1/2, animX, animY);\r\n      } else {\r\n          layer.addRect(setNumber, sx1, sy1, dx1, dy1, w1, h1, animX, animY);\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _drawTableEdge\r\n* @param {Array} layers\r\n* @param {Number} tileId\r\n* @param {Number} dx\r\n* @param {Number} dy\r\n* @private\r\n*/\r\nShaderTilemap.prototype._drawTableEdge = function(layer, tileId, dx, dy) {\r\n  if (Tilemap.isTileA2(tileId)) {\r\n      var autotileTable = Tilemap.FLOOR_AUTOTILE_TABLE;\r\n      var kind = Tilemap.getAutotileKind(tileId);\r\n      var shape = Tilemap.getAutotileShape(tileId);\r\n      var tx = kind % 8;\r\n      var ty = Math.floor(kind / 8);\r\n      var setNumber = 1;\r\n      var bx = tx * 2;\r\n      var by = (ty - 2) * 3;\r\n      var table = autotileTable[shape];\r\n      var w1 = this._tileWidth / 2;\r\n      var h1 = this._tileHeight / 2;\r\n      for (var i = 0; i < 2; i++) {\r\n          var qsx = table[2 + i][0];\r\n          var qsy = table[2 + i][1];\r\n          var sx1 = (bx * 2 + qsx) * w1;\r\n          var sy1 = (by * 2 + qsy) * h1 + h1 / 2;\r\n          var dx1 = dx + (i % 2) * w1;\r\n          var dy1 = dy + Math.floor(i / 2) * h1;\r\n          layer.addRect(setNumber, sx1, sy1, dx1, dy1, w1, h1/2);\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _drawShadow\r\n* @param {Number} shadowBits\r\n* @param {Number} dx\r\n* @param {Number} dy\r\n* @private\r\n*/\r\nShaderTilemap.prototype._drawShadow = function(layer, shadowBits, dx, dy) {\r\n  if (shadowBits & 0x0f) {\r\n      var w1 = this._tileWidth / 2;\r\n      var h1 = this._tileHeight / 2;\r\n      for (var i = 0; i < 4; i++) {\r\n          if (shadowBits & (1 << i)) {\r\n              var dx1 = dx + (i % 2) * w1;\r\n              var dy1 = dy + Math.floor(i / 2) * h1;\r\n              layer.addRect(-1, 0, 0, dx1, dy1, w1, h1);\r\n          }\r\n      }\r\n  }\r\n};\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The sprite object for a tiling image.\r\n*\r\n* @class TilingSprite\r\n* @constructor\r\n* @param {Bitmap} bitmap The image for the tiling sprite\r\n*/\r\nfunction TilingSprite() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nTilingSprite.prototype = Object.create(PIXI.extras.PictureTilingSprite.prototype);\r\nTilingSprite.prototype.constructor = TilingSprite;\r\n\r\nTilingSprite.prototype.initialize = function(bitmap) {\r\n  var texture = new PIXI.Texture(new PIXI.BaseTexture());\r\n\r\n  PIXI.extras.PictureTilingSprite.call(this, texture);\r\n\r\n  this._bitmap = null;\r\n  this._width = 0;\r\n  this._height = 0;\r\n  this._frame = new Rectangle();\r\n  this.spriteId = Sprite._counter++;\r\n  /**\r\n   * The origin point of the tiling sprite for scrolling.\r\n   *\r\n   * @property origin\r\n   * @type Point\r\n   */\r\n  this.origin = new Point();\r\n\r\n  this.bitmap = bitmap;\r\n};\r\n\r\nTilingSprite.prototype._renderCanvas_PIXI = PIXI.extras.PictureTilingSprite.prototype._renderCanvas;\r\nTilingSprite.prototype._renderWebGL_PIXI = PIXI.extras.PictureTilingSprite.prototype._renderWebGL;\r\n\r\n/**\r\n* @method _renderCanvas\r\n* @param {Object} renderer\r\n* @private\r\n*/\r\nTilingSprite.prototype._renderCanvas = function(renderer) {\r\n  if (this._bitmap) {\r\n      this._bitmap.touch();\r\n  }\r\n  if (this.texture.frame.width > 0 && this.texture.frame.height > 0) {\r\n      this._renderCanvas_PIXI(renderer);\r\n  }\r\n};\r\n\r\n/**\r\n* @method _renderWebGL\r\n* @param {Object} renderer\r\n* @private\r\n*/\r\nTilingSprite.prototype._renderWebGL = function(renderer) {\r\n  if (this._bitmap) {\r\n      this._bitmap.touch();\r\n  }\r\n  if (this.texture.frame.width > 0 && this.texture.frame.height > 0) {\r\n      if (this._bitmap) {\r\n          this._bitmap.checkDirty();\r\n      }\r\n      this._renderWebGL_PIXI(renderer);\r\n  }\r\n};\r\n\r\n/**\r\n* The image for the tiling sprite.\r\n*\r\n* @property bitmap\r\n* @type Bitmap\r\n*/\r\nObject.defineProperty(TilingSprite.prototype, 'bitmap', {\r\n  get: function() {\r\n      return this._bitmap;\r\n  },\r\n  set: function(value) {\r\n      if (this._bitmap !== value) {\r\n          this._bitmap = value;\r\n          if (this._bitmap) {\r\n              this._bitmap.addLoadListener(this._onBitmapLoad.bind(this));\r\n          } else {\r\n              this.texture.frame = Rectangle.emptyRectangle;\r\n          }\r\n      }\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The opacity of the tiling sprite (0 to 255).\r\n*\r\n* @property opacity\r\n* @type Number\r\n*/\r\nObject.defineProperty(TilingSprite.prototype, 'opacity', {\r\n  get: function() {\r\n      return this.alpha * 255;\r\n  },\r\n  set: function(value) {\r\n      this.alpha = value.clamp(0, 255) / 255;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* Updates the tiling sprite for each frame.\r\n*\r\n* @method update\r\n*/\r\nTilingSprite.prototype.update = function() {\r\n  this.children.forEach(function(child) {\r\n      if (child.update) {\r\n          child.update();\r\n      }\r\n  });\r\n};\r\n\r\n/**\r\n* Sets the x, y, width, and height all at once.\r\n*\r\n* @method move\r\n* @param {Number} x The x coordinate of the tiling sprite\r\n* @param {Number} y The y coordinate of the tiling sprite\r\n* @param {Number} width The width of the tiling sprite\r\n* @param {Number} height The height of the tiling sprite\r\n*/\r\nTilingSprite.prototype.move = function(x, y, width, height) {\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n  this._width = width || 0;\r\n  this._height = height || 0;\r\n};\r\n\r\n/**\r\n* Specifies the region of the image that the tiling sprite will use.\r\n*\r\n* @method setFrame\r\n* @param {Number} x The x coordinate of the frame\r\n* @param {Number} y The y coordinate of the frame\r\n* @param {Number} width The width of the frame\r\n* @param {Number} height The height of the frame\r\n*/\r\nTilingSprite.prototype.setFrame = function(x, y, width, height) {\r\n  this._frame.x = x;\r\n  this._frame.y = y;\r\n  this._frame.width = width;\r\n  this._frame.height = height;\r\n  this._refresh();\r\n};\r\n\r\n/**\r\n* @method updateTransform\r\n* @private\r\n*/\r\nTilingSprite.prototype.updateTransform = function() {\r\n  this.tilePosition.x = Math.round(-this.origin.x);\r\n  this.tilePosition.y = Math.round(-this.origin.y);\r\n  this.updateTransformTS();\r\n};\r\n\r\nTilingSprite.prototype.updateTransformTS = PIXI.extras.TilingSprite.prototype.updateTransform;\r\n\r\n/**\r\n* @method _onBitmapLoad\r\n* @private\r\n*/\r\nTilingSprite.prototype._onBitmapLoad = function() {\r\n  this.texture.baseTexture = this._bitmap.baseTexture;\r\n  this._refresh();\r\n};\r\n\r\n/**\r\n* @method _refresh\r\n* @private\r\n*/\r\nTilingSprite.prototype._refresh = function() {\r\n  var frame = this._frame.clone();\r\n  if (frame.width === 0 && frame.height === 0 && this._bitmap) {\r\n      frame.width = this._bitmap.width;\r\n      frame.height = this._bitmap.height;\r\n  }\r\n  this.texture.frame = frame;\r\n  this.texture._updateID++;\r\n  this.tilingTexture = null;\r\n};\r\n\r\n\r\nTilingSprite.prototype._speedUpCustomBlendModes = Sprite.prototype._speedUpCustomBlendModes;\r\n\r\n/**\r\n* @method _renderWebGL\r\n* @param {Object} renderer\r\n* @private\r\n*/\r\nTilingSprite.prototype._renderWebGL = function(renderer) {\r\n  if (this._bitmap) {\r\n      this._bitmap.touch();\r\n      this._bitmap.checkDirty();\r\n  }\r\n\r\n  this._speedUpCustomBlendModes(renderer);\r\n\r\n  this._renderWebGL_PIXI(renderer);\r\n};\r\n\r\n// The important members from Pixi.js\r\n\r\n/**\r\n* The visibility of the tiling sprite.\r\n*\r\n* @property visible\r\n* @type Boolean\r\n*/\r\n\r\n/**\r\n* The x coordinate of the tiling sprite.\r\n*\r\n* @property x\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* The y coordinate of the tiling sprite.\r\n*\r\n* @property y\r\n* @type Number\r\n*/\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The sprite which covers the entire game screen.\r\n*\r\n* @class ScreenSprite\r\n* @constructor\r\n*/\r\nfunction ScreenSprite() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nScreenSprite.prototype = Object.create(PIXI.Container.prototype);\r\nScreenSprite.prototype.constructor = ScreenSprite;\r\n\r\nScreenSprite.prototype.initialize = function () {\r\n  PIXI.Container.call(this);\r\n\r\n  this._graphics = new PIXI.Graphics();\r\n  this.addChild(this._graphics);\r\n  this.opacity = 0;\r\n\r\n  this._red = -1;\r\n  this._green = -1;\r\n  this._blue = -1;\r\n  this._colorText = '';\r\n  this.setBlack();\r\n};\r\n\r\n/**\r\n* The opacity of the sprite (0 to 255).\r\n*\r\n* @property opacity\r\n* @type Number\r\n*/\r\nObject.defineProperty(ScreenSprite.prototype, 'opacity', {\r\n  get: function () {\r\n      return this.alpha * 255;\r\n  },\r\n  set: function (value) {\r\n      this.alpha = value.clamp(0, 255) / 255;\r\n  },\r\n  configurable: true\r\n});\r\n\r\nScreenSprite.YEPWarned = false;\r\nScreenSprite.warnYep = function () {\r\n  if (!ScreenSprite.YEPWarned) {\r\n      console.log(\"Deprecation warning. Please update YEP_CoreEngine. ScreenSprite is not a sprite, it has graphics inside.\");\r\n      ScreenSprite.YEPWarned = true;\r\n  }\r\n};\r\n\r\nObject.defineProperty(ScreenSprite.prototype, 'anchor', {\r\n  get: function () {\r\n      ScreenSprite.warnYep();\r\n      this.scale.x = 1;\r\n      this.scale.y = 1;\r\n      return {x: 0, y: 0};\r\n  },\r\n  set: function (value) {\r\n      this.alpha = value.clamp(0, 255) / 255;\r\n  },\r\n  configurable: true\r\n});\r\n\r\nObject.defineProperty(ScreenSprite.prototype, 'blendMode', {\r\n  get: function () {\r\n      return this._graphics.blendMode;\r\n  },\r\n  set: function (value) {\r\n      this._graphics.blendMode = value;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* Sets black to the color of the screen sprite.\r\n*\r\n* @method setBlack\r\n*/\r\nScreenSprite.prototype.setBlack = function () {\r\n  this.setColor(0, 0, 0);\r\n};\r\n\r\n/**\r\n* Sets white to the color of the screen sprite.\r\n*\r\n* @method setWhite\r\n*/\r\nScreenSprite.prototype.setWhite = function () {\r\n  this.setColor(255, 255, 255);\r\n};\r\n\r\n/**\r\n* Sets the color of the screen sprite by values.\r\n*\r\n* @method setColor\r\n* @param {Number} r The red value in the range (0, 255)\r\n* @param {Number} g The green value in the range (0, 255)\r\n* @param {Number} b The blue value in the range (0, 255)\r\n*/\r\nScreenSprite.prototype.setColor = function (r, g, b) {\r\n  if (this._red !== r || this._green !== g || this._blue !== b) {\r\n      r = Math.round(r || 0).clamp(0, 255);\r\n      g = Math.round(g || 0).clamp(0, 255);\r\n      b = Math.round(b || 0).clamp(0, 255);\r\n      this._red = r;\r\n      this._green = g;\r\n      this._blue = b;\r\n      this._colorText = Utils.rgbToCssColor(r, g, b);\r\n\r\n      var graphics = this._graphics;\r\n      graphics.clear();\r\n      var intColor = (r << 16) | (g << 8) | b;\r\n      graphics.beginFill(intColor, 1);\r\n      //whole screen with zoom. BWAHAHAHAHA\r\n      graphics.drawRect(-Graphics.width * 5, -Graphics.height * 5, Graphics.width * 10, Graphics.height * 10);\r\n  }\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The window in the game.\r\n*\r\n* @class Window\r\n* @constructor\r\n*/\r\nfunction Window() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nWindow.prototype = Object.create(PIXI.Container.prototype);\r\nWindow.prototype.constructor = Window;\r\n\r\nWindow.prototype.initialize = function() {\r\n  PIXI.Container.call(this);\r\n\r\n  this._isWindow = true;\r\n  this._windowskin = null;\r\n  this._width = 0;\r\n  this._height = 0;\r\n  this._cursorRect = new Rectangle();\r\n  this._openness = 255;\r\n  this._animationCount = 0;\r\n\r\n  this._padding = 18;\r\n  this._margin = 4;\r\n  this._colorTone = [0, 0, 0];\r\n\r\n  this._windowSpriteContainer = null;\r\n  this._windowBackSprite = null;\r\n  this._windowCursorSprite = null;\r\n  this._windowFrameSprite = null;\r\n  this._windowContentsSprite = null;\r\n  this._windowArrowSprites = [];\r\n  this._windowPauseSignSprite = null;\r\n\r\n  this._createAllParts();\r\n\r\n  /**\r\n   * The origin point of the window for scrolling.\r\n   *\r\n   * @property origin\r\n   * @type Point\r\n   */\r\n  this.origin = new Point();\r\n\r\n  /**\r\n   * The active state for the window.\r\n   *\r\n   * @property active\r\n   * @type Boolean\r\n   */\r\n  this.active = true;\r\n\r\n  /**\r\n   * The visibility of the down scroll arrow.\r\n   *\r\n   * @property downArrowVisible\r\n   * @type Boolean\r\n   */\r\n  this.downArrowVisible = false;\r\n\r\n  /**\r\n   * The visibility of the up scroll arrow.\r\n   *\r\n   * @property upArrowVisible\r\n   * @type Boolean\r\n   */\r\n  this.upArrowVisible = false;\r\n\r\n  /**\r\n   * The visibility of the pause sign.\r\n   *\r\n   * @property pause\r\n   * @type Boolean\r\n   */\r\n  this.pause = false;\r\n};\r\n\r\n/**\r\n* The image used as a window skin.\r\n*\r\n* @property windowskin\r\n* @type Bitmap\r\n*/\r\nObject.defineProperty(Window.prototype, 'windowskin', {\r\n  get: function() {\r\n      return this._windowskin;\r\n  },\r\n  set: function(value) {\r\n      if (this._windowskin !== value) {\r\n          this._windowskin = value;\r\n          this._windowskin.addLoadListener(this._onWindowskinLoad.bind(this));\r\n      }\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The bitmap used for the window contents.\r\n*\r\n* @property contents\r\n* @type Bitmap\r\n*/\r\nObject.defineProperty(Window.prototype, 'contents', {\r\n  get: function() {\r\n      return this._windowContentsSprite.bitmap;\r\n  },\r\n  set: function(value) {\r\n      this._windowContentsSprite.bitmap = value;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The width of the window in pixels.\r\n*\r\n* @property width\r\n* @type Number\r\n*/\r\nObject.defineProperty(Window.prototype, 'width', {\r\n  get: function() {\r\n      return this._width;\r\n  },\r\n  set: function(value) {\r\n      this._width = value;\r\n      this._refreshAllParts();\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The height of the window in pixels.\r\n*\r\n* @property height\r\n* @type Number\r\n*/\r\nObject.defineProperty(Window.prototype, 'height', {\r\n  get: function() {\r\n      return this._height;\r\n  },\r\n  set: function(value) {\r\n      this._height = value;\r\n      this._refreshAllParts();\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The size of the padding between the frame and contents.\r\n*\r\n* @property padding\r\n* @type Number\r\n*/\r\nObject.defineProperty(Window.prototype, 'padding', {\r\n  get: function() {\r\n      return this._padding;\r\n  },\r\n  set: function(value) {\r\n      this._padding = value;\r\n      this._refreshAllParts();\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The size of the margin for the window background.\r\n*\r\n* @property margin\r\n* @type Number\r\n*/\r\nObject.defineProperty(Window.prototype, 'margin', {\r\n  get: function() {\r\n      return this._margin;\r\n  },\r\n  set: function(value) {\r\n      this._margin = value;\r\n      this._refreshAllParts();\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The opacity of the window without contents (0 to 255).\r\n*\r\n* @property opacity\r\n* @type Number\r\n*/\r\nObject.defineProperty(Window.prototype, 'opacity', {\r\n  get: function() {\r\n      return this._windowSpriteContainer.alpha * 255;\r\n  },\r\n  set: function(value) {\r\n      this._windowSpriteContainer.alpha = value.clamp(0, 255) / 255;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The opacity of the window background (0 to 255).\r\n*\r\n* @property backOpacity\r\n* @type Number\r\n*/\r\nObject.defineProperty(Window.prototype, 'backOpacity', {\r\n  get: function() {\r\n      return this._windowBackSprite.alpha * 255;\r\n  },\r\n  set: function(value) {\r\n      this._windowBackSprite.alpha = value.clamp(0, 255) / 255;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The opacity of the window contents (0 to 255).\r\n*\r\n* @property contentsOpacity\r\n* @type Number\r\n*/\r\nObject.defineProperty(Window.prototype, 'contentsOpacity', {\r\n  get: function() {\r\n      return this._windowContentsSprite.alpha * 255;\r\n  },\r\n  set: function(value) {\r\n      this._windowContentsSprite.alpha = value.clamp(0, 255) / 255;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The openness of the window (0 to 255).\r\n*\r\n* @property openness\r\n* @type Number\r\n*/\r\nObject.defineProperty(Window.prototype, 'openness', {\r\n  get: function() {\r\n      return this._openness;\r\n  },\r\n  set: function(value) {\r\n      if (this._openness !== value) {\r\n          this._openness = value.clamp(0, 255);\r\n          this._windowSpriteContainer.scale.y = this._openness / 255;\r\n          this._windowSpriteContainer.y = this.height / 2 * (1 - this._openness / 255);\r\n      }\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* Updates the window for each frame.\r\n*\r\n* @method update\r\n*/\r\nWindow.prototype.update = function() {\r\n  if (this.active) {\r\n      this._animationCount++;\r\n  }\r\n  this.children.forEach(function(child) {\r\n      if (child.update) {\r\n          child.update();\r\n      }\r\n  });\r\n};\r\n\r\n/**\r\n* Sets the x, y, width, and height all at once.\r\n*\r\n* @method move\r\n* @param {Number} x The x coordinate of the window\r\n* @param {Number} y The y coordinate of the window\r\n* @param {Number} width The width of the window\r\n* @param {Number} height The height of the window\r\n*/\r\nWindow.prototype.move = function(x, y, width, height) {\r\n  this.x = x || 0;\r\n  this.y = y || 0;\r\n  if (this._width !== width || this._height !== height) {\r\n      this._width = width || 0;\r\n      this._height = height || 0;\r\n      this._refreshAllParts();\r\n  }\r\n};\r\n\r\n/**\r\n* Returns true if the window is completely open (openness == 255).\r\n*\r\n* @method isOpen\r\n*/\r\nWindow.prototype.isOpen = function() {\r\n  return this._openness >= 255;\r\n};\r\n\r\n/**\r\n* Returns true if the window is completely closed (openness == 0).\r\n*\r\n* @method isClosed\r\n*/\r\nWindow.prototype.isClosed = function() {\r\n  return this._openness <= 0;\r\n};\r\n\r\n/**\r\n* Sets the position of the command cursor.\r\n*\r\n* @method setCursorRect\r\n* @param {Number} x The x coordinate of the cursor\r\n* @param {Number} y The y coordinate of the cursor\r\n* @param {Number} width The width of the cursor\r\n* @param {Number} height The height of the cursor\r\n*/\r\nWindow.prototype.setCursorRect = function(x, y, width, height) {\r\n  var cx = Math.floor(x || 0);\r\n  var cy = Math.floor(y || 0);\r\n  var cw = Math.floor(width || 0);\r\n  var ch = Math.floor(height || 0);\r\n  var rect = this._cursorRect;\r\n  if (rect.x !== cx || rect.y !== cy || rect.width !== cw || rect.height !== ch) {\r\n      this._cursorRect.x = cx;\r\n      this._cursorRect.y = cy;\r\n      this._cursorRect.width = cw;\r\n      this._cursorRect.height = ch;\r\n      this._refreshCursor();\r\n  }\r\n};\r\n\r\n/**\r\n* Changes the color of the background.\r\n*\r\n* @method setTone\r\n* @param {Number} r The red value in the range (-255, 255)\r\n* @param {Number} g The green value in the range (-255, 255)\r\n* @param {Number} b The blue value in the range (-255, 255)\r\n*/\r\nWindow.prototype.setTone = function(r, g, b) {\r\n  var tone = this._colorTone;\r\n  if (r !== tone[0] || g !== tone[1] || b !== tone[2]) {\r\n      this._colorTone = [r, g, b];\r\n      this._refreshBack();\r\n  }\r\n};\r\n\r\n/**\r\n* Adds a child between the background and contents.\r\n*\r\n* @method addChildToBack\r\n* @param {Object} child The child to add\r\n* @return {Object} The child that was added\r\n*/\r\nWindow.prototype.addChildToBack = function(child) {\r\n  var containerIndex = this.children.indexOf(this._windowSpriteContainer);\r\n  return this.addChildAt(child, containerIndex + 1);\r\n};\r\n\r\n/**\r\n* @method updateTransform\r\n* @private\r\n*/\r\nWindow.prototype.updateTransform = function() {\r\n  this._updateCursor();\r\n  this._updateArrows();\r\n  this._updatePauseSign();\r\n  this._updateContents();\r\n  PIXI.Container.prototype.updateTransform.call(this);\r\n};\r\n\r\n/**\r\n* @method _createAllParts\r\n* @private\r\n*/\r\nWindow.prototype._createAllParts = function() {\r\n  this._windowSpriteContainer = new PIXI.Container();\r\n  this._windowBackSprite = new Sprite();\r\n  this._windowCursorSprite = new Sprite();\r\n  this._windowFrameSprite = new Sprite();\r\n  this._windowContentsSprite = new Sprite();\r\n  this._downArrowSprite = new Sprite();\r\n  this._upArrowSprite = new Sprite();\r\n  this._windowPauseSignSprite = new Sprite();\r\n  this._windowBackSprite.bitmap = new Bitmap(1, 1);\r\n  this._windowBackSprite.alpha = 192 / 255;\r\n  this.addChild(this._windowSpriteContainer);\r\n  this._windowSpriteContainer.addChild(this._windowBackSprite);\r\n  this._windowSpriteContainer.addChild(this._windowFrameSprite);\r\n  this.addChild(this._windowCursorSprite);\r\n  this.addChild(this._windowContentsSprite);\r\n  this.addChild(this._downArrowSprite);\r\n  this.addChild(this._upArrowSprite);\r\n  this.addChild(this._windowPauseSignSprite);\r\n};\r\n\r\n/**\r\n* @method _onWindowskinLoad\r\n* @private\r\n*/\r\nWindow.prototype._onWindowskinLoad = function() {\r\n  this._refreshAllParts();\r\n};\r\n\r\n/**\r\n* @method _refreshAllParts\r\n* @private\r\n*/\r\nWindow.prototype._refreshAllParts = function() {\r\n  this._refreshBack();\r\n  this._refreshFrame();\r\n  this._refreshCursor();\r\n  this._refreshContents();\r\n  this._refreshArrows();\r\n  this._refreshPauseSign();\r\n};\r\n\r\n/**\r\n* @method _refreshBack\r\n* @private\r\n*/\r\nWindow.prototype._refreshBack = function() {\r\n  var m = this._margin;\r\n  var w = this._width - m * 2;\r\n  var h = this._height - m * 2;\r\n  var bitmap = new Bitmap(w, h);\r\n\r\n  this._windowBackSprite.bitmap = bitmap;\r\n  this._windowBackSprite.setFrame(0, 0, w, h);\r\n  this._windowBackSprite.move(m, m);\r\n\r\n  if (w > 0 && h > 0 && this._windowskin) {\r\n      var p = 96;\r\n      bitmap.blt(this._windowskin, 0, 0, p, p, 0, 0, w, h);\r\n      for (var y = 0; y < h; y += p) {\r\n          for (var x = 0; x < w; x += p) {\r\n              bitmap.blt(this._windowskin, 0, p, p, p, x, y, p, p);\r\n          }\r\n      }\r\n      var tone = this._colorTone;\r\n      bitmap.adjustTone(tone[0], tone[1], tone[2]);\r\n  }\r\n};\r\n\r\n/**\r\n* @method _refreshFrame\r\n* @private\r\n*/\r\nWindow.prototype._refreshFrame = function() {\r\n  var w = this._width;\r\n  var h = this._height;\r\n  var m = 24;\r\n  var bitmap = new Bitmap(w, h);\r\n\r\n  this._windowFrameSprite.bitmap = bitmap;\r\n  this._windowFrameSprite.setFrame(0, 0, w, h);\r\n\r\n  if (w > 0 && h > 0 && this._windowskin) {\r\n      var skin = this._windowskin;\r\n      var p = 96;\r\n      var q = 96;\r\n      bitmap.blt(skin, p+m, 0+0, p-m*2, m, m, 0, w-m*2, m);\r\n      bitmap.blt(skin, p+m, 0+q-m, p-m*2, m, m, h-m, w-m*2, m);\r\n      bitmap.blt(skin, p+0, 0+m, m, p-m*2, 0, m, m, h-m*2);\r\n      bitmap.blt(skin, p+q-m, 0+m, m, p-m*2, w-m, m, m, h-m*2);\r\n      bitmap.blt(skin, p+0, 0+0, m, m, 0, 0, m, m);\r\n      bitmap.blt(skin, p+q-m, 0+0, m, m, w-m, 0, m, m);\r\n      bitmap.blt(skin, p+0, 0+q-m, m, m, 0, h-m, m, m);\r\n      bitmap.blt(skin, p+q-m, 0+q-m, m, m, w-m, h-m, m, m);\r\n  }\r\n};\r\n\r\n/**\r\n* @method _refreshCursor\r\n* @private\r\n*/\r\nWindow.prototype._refreshCursor = function() {\r\n  var pad = this._padding;\r\n  var x = this._cursorRect.x + pad - this.origin.x;\r\n  var y = this._cursorRect.y + pad - this.origin.y;\r\n  var w = this._cursorRect.width;\r\n  var h = this._cursorRect.height;\r\n  var m = 4;\r\n  var x2 = Math.max(x, pad);\r\n  var y2 = Math.max(y, pad);\r\n  var ox = x - x2;\r\n  var oy = y - y2;\r\n  var w2 = Math.min(w, this._width - pad - x2);\r\n  var h2 = Math.min(h, this._height - pad - y2);\r\n  var bitmap = new Bitmap(w2, h2);\r\n\r\n  this._windowCursorSprite.bitmap = bitmap;\r\n  this._windowCursorSprite.setFrame(0, 0, w2, h2);\r\n  this._windowCursorSprite.move(x2, y2);\r\n\r\n  if (w > 0 && h > 0 && this._windowskin) {\r\n      var skin = this._windowskin;\r\n      var p = 96;\r\n      var q = 48;\r\n      bitmap.blt(skin, p+m, p+m, q-m*2, q-m*2, ox+m, oy+m, w-m*2, h-m*2);\r\n      bitmap.blt(skin, p+m, p+0, q-m*2, m, ox+m, oy+0, w-m*2, m);\r\n      bitmap.blt(skin, p+m, p+q-m, q-m*2, m, ox+m, oy+h-m, w-m*2, m);\r\n      bitmap.blt(skin, p+0, p+m, m, q-m*2, ox+0, oy+m, m, h-m*2);\r\n      bitmap.blt(skin, p+q-m, p+m, m, q-m*2, ox+w-m, oy+m, m, h-m*2);\r\n      bitmap.blt(skin, p+0, p+0, m, m, ox+0, oy+0, m, m);\r\n      bitmap.blt(skin, p+q-m, p+0, m, m, ox+w-m, oy+0, m, m);\r\n      bitmap.blt(skin, p+0, p+q-m, m, m, ox+0, oy+h-m, m, m);\r\n      bitmap.blt(skin, p+q-m, p+q-m, m, m, ox+w-m, oy+h-m, m, m);\r\n  }\r\n};\r\n\r\n/**\r\n* @method _refreshContents\r\n* @private\r\n*/\r\nWindow.prototype._refreshContents = function() {\r\n  this._windowContentsSprite.move(this.padding, this.padding);\r\n};\r\n\r\n/**\r\n* @method _refreshArrows\r\n* @private\r\n*/\r\nWindow.prototype._refreshArrows = function() {\r\n  var w = this._width;\r\n  var h = this._height;\r\n  var p = 24;\r\n  var q = p/2;\r\n  var sx = 96+p;\r\n  var sy = 0+p;\r\n  this._downArrowSprite.bitmap = this._windowskin;\r\n  this._downArrowSprite.anchor.x = 0.5;\r\n  this._downArrowSprite.anchor.y = 0.5;\r\n  this._downArrowSprite.setFrame(sx+q, sy+q+p, p, q);\r\n  this._downArrowSprite.move(w/2, h-q);\r\n  this._upArrowSprite.bitmap = this._windowskin;\r\n  this._upArrowSprite.anchor.x = 0.5;\r\n  this._upArrowSprite.anchor.y = 0.5;\r\n  this._upArrowSprite.setFrame(sx+q, sy, p, q);\r\n  this._upArrowSprite.move(w/2, q);\r\n};\r\n\r\n/**\r\n* @method _refreshPauseSign\r\n* @private\r\n*/\r\nWindow.prototype._refreshPauseSign = function() {\r\n  var sx = 144;\r\n  var sy = 96;\r\n  var p = 24;\r\n  this._windowPauseSignSprite.bitmap = this._windowskin;\r\n  this._windowPauseSignSprite.anchor.x = 0.5;\r\n  this._windowPauseSignSprite.anchor.y = 1;\r\n  this._windowPauseSignSprite.move(this._width / 2, this._height);\r\n  this._windowPauseSignSprite.setFrame(sx, sy, p, p);\r\n  this._windowPauseSignSprite.alpha = 0;\r\n};\r\n\r\n/**\r\n* @method _updateCursor\r\n* @private\r\n*/\r\nWindow.prototype._updateCursor = function() {\r\n  var blinkCount = this._animationCount % 40;\r\n  var cursorOpacity = this.contentsOpacity;\r\n  if (this.active) {\r\n      if (blinkCount < 20) {\r\n          cursorOpacity -= blinkCount * 8;\r\n      } else {\r\n          cursorOpacity -= (40 - blinkCount) * 8;\r\n      }\r\n  }\r\n  this._windowCursorSprite.alpha = cursorOpacity / 255;\r\n  this._windowCursorSprite.visible = this.isOpen();\r\n};\r\n\r\n/**\r\n* @method _updateContents\r\n* @private\r\n*/\r\nWindow.prototype._updateContents = function() {\r\n  var w = this._width - this._padding * 2;\r\n  var h = this._height - this._padding * 2;\r\n  if (w > 0 && h > 0) {\r\n      this._windowContentsSprite.setFrame(this.origin.x, this.origin.y, w, h);\r\n      this._windowContentsSprite.visible = this.isOpen();\r\n  } else {\r\n      this._windowContentsSprite.visible = false;\r\n  }\r\n};\r\n\r\n/**\r\n* @method _updateArrows\r\n* @private\r\n*/\r\nWindow.prototype._updateArrows = function() {\r\n  this._downArrowSprite.visible = this.isOpen() && this.downArrowVisible;\r\n  this._upArrowSprite.visible = this.isOpen() && this.upArrowVisible;\r\n};\r\n\r\n/**\r\n* @method _updatePauseSign\r\n* @private\r\n*/\r\nWindow.prototype._updatePauseSign = function() {\r\n  var sprite = this._windowPauseSignSprite;\r\n  var x = Math.floor(this._animationCount / 16) % 2;\r\n  var y = Math.floor(this._animationCount / 16 / 2) % 2;\r\n  var sx = 144;\r\n  var sy = 96;\r\n  var p = 24;\r\n  if (!this.pause) {\r\n      sprite.alpha = 0;\r\n  } else if (sprite.alpha < 1) {\r\n      sprite.alpha = Math.min(sprite.alpha + 0.1, 1);\r\n  }\r\n  sprite.setFrame(sx+x*p, sy+y*p, p, p);\r\n  sprite.visible = this.isOpen();\r\n};\r\n\r\n// The important members from Pixi.js\r\n\r\n/**\r\n* The visibility of the window.\r\n*\r\n* @property visible\r\n* @type Boolean\r\n*/\r\n\r\n/**\r\n* The x coordinate of the window.\r\n*\r\n* @property x\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* The y coordinate of the window.\r\n*\r\n* @property y\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* [read-only] The array of children of the window.\r\n*\r\n* @property children\r\n* @type Array\r\n*/\r\n\r\n/**\r\n* [read-only] The object that contains the window.\r\n*\r\n* @property parent\r\n* @type Object\r\n*/\r\n\r\n/**\r\n* Adds a child to the container.\r\n*\r\n* @method addChild\r\n* @param {Object} child The child to add\r\n* @return {Object} The child that was added\r\n*/\r\n\r\n/**\r\n* Adds a child to the container at a specified index.\r\n*\r\n* @method addChildAt\r\n* @param {Object} child The child to add\r\n* @param {Number} index The index to place the child in\r\n* @return {Object} The child that was added\r\n*/\r\n\r\n/**\r\n* Removes a child from the container.\r\n*\r\n* @method removeChild\r\n* @param {Object} child The child to remove\r\n* @return {Object} The child that was removed\r\n*/\r\n\r\n/**\r\n* Removes a child from the specified index position.\r\n*\r\n* @method removeChildAt\r\n* @param {Number} index The index to get the child from\r\n* @return {Object} The child that was removed\r\n*/\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The layer which contains game windows.\r\n*\r\n* @class WindowLayer\r\n* @constructor\r\n*/\r\nfunction WindowLayer() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nWindowLayer.prototype = Object.create(PIXI.Container.prototype);\r\nWindowLayer.prototype.constructor = WindowLayer;\r\n\r\nWindowLayer.prototype.initialize = function() {\r\n  PIXI.Container.call(this);\r\n  this._width = 0;\r\n  this._height = 0;\r\n  this._tempCanvas = null;\r\n  this._translationMatrix = [1, 0, 0, 0, 1, 0, 0, 0, 1];\r\n\r\n  this._windowMask = new PIXI.Graphics();\r\n  this._windowMask.beginFill(0xffffff, 1);\r\n  this._windowMask.drawRect(0, 0, 0, 0);\r\n  this._windowMask.endFill();\r\n  this._windowRect = this._windowMask.graphicsData[0].shape;\r\n\r\n  this._renderSprite = null;\r\n  this.filterArea = new PIXI.Rectangle();\r\n  this.filters = [WindowLayer.voidFilter];\r\n\r\n  //temporary fix for memory leak bug\r\n  this.on('removed', this.onRemoveAsAChild);\r\n};\r\n\r\nWindowLayer.prototype.onRemoveAsAChild = function() {\r\n  this.removeChildren();\r\n}\r\n\r\nWindowLayer.voidFilter = new PIXI.filters.VoidFilter();\r\n\r\n/**\r\n* The width of the window layer in pixels.\r\n*\r\n* @property width\r\n* @type Number\r\n*/\r\nObject.defineProperty(WindowLayer.prototype, 'width', {\r\n  get: function() {\r\n      return this._width;\r\n  },\r\n  set: function(value) {\r\n      this._width = value;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The height of the window layer in pixels.\r\n*\r\n* @property height\r\n* @type Number\r\n*/\r\nObject.defineProperty(WindowLayer.prototype, 'height', {\r\n  get: function() {\r\n      return this._height;\r\n  },\r\n  set: function(value) {\r\n      this._height = value;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* Sets the x, y, width, and height all at once.\r\n*\r\n* @method move\r\n* @param {Number} x The x coordinate of the window layer\r\n* @param {Number} y The y coordinate of the window layer\r\n* @param {Number} width The width of the window layer\r\n* @param {Number} height The height of the window layer\r\n*/\r\nWindowLayer.prototype.move = function(x, y, width, height) {\r\n  this.x = x;\r\n  this.y = y;\r\n  this.width = width;\r\n  this.height = height;\r\n};\r\n\r\n/**\r\n* Updates the window layer for each frame.\r\n*\r\n* @method update\r\n*/\r\nWindowLayer.prototype.update = function() {\r\n  this.children.forEach(function(child) {\r\n      if (child.update) {\r\n          child.update();\r\n      }\r\n  });\r\n};\r\n\r\n/**\r\n* @method _renderCanvas\r\n* @param {Object} renderSession\r\n* @private\r\n*/\r\nWindowLayer.prototype.renderCanvas = function(renderer) {\r\n  if (!this.visible || !this.renderable) {\r\n      return;\r\n  }\r\n\r\n  if (!this._tempCanvas) {\r\n      this._tempCanvas = document.createElement('canvas');\r\n  }\r\n\r\n  this._tempCanvas.width = Graphics.width;\r\n  this._tempCanvas.height = Graphics.height;\r\n\r\n  var realCanvasContext = renderer.context;\r\n  var context = this._tempCanvas.getContext('2d');\r\n\r\n  context.save();\r\n  context.clearRect(0, 0, Graphics.width, Graphics.height);\r\n  context.beginPath();\r\n  context.rect(this.x, this.y, this.width, this.height);\r\n  context.closePath();\r\n  context.clip();\r\n\r\n  renderer.context = context;\r\n\r\n  for (var i = 0; i < this.children.length; i++) {\r\n      var child = this.children[i];\r\n      if (child._isWindow && child.visible && child.openness > 0) {\r\n          this._canvasClearWindowRect(renderer, child);\r\n          context.save();\r\n          child.renderCanvas(renderer);\r\n          context.restore();\r\n      }\r\n  }\r\n\r\n  context.restore();\r\n\r\n  renderer.context = realCanvasContext;\r\n  renderer.context.setTransform(1, 0, 0, 1, 0, 0);\r\n  renderer.context.globalCompositeOperation = 'source-over';\r\n  renderer.context.globalAlpha = 1;\r\n  renderer.context.drawImage(this._tempCanvas, 0, 0);\r\n\r\n  for (var j = 0; j < this.children.length; j++) {\r\n      if (!this.children[j]._isWindow) {\r\n          this.children[j].renderCanvas(renderer);\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _canvasClearWindowRect\r\n* @param {Object} renderSession\r\n* @param {Window} window\r\n* @private\r\n*/\r\nWindowLayer.prototype._canvasClearWindowRect = function(renderSession, window) {\r\n  var rx = this.x + window.x;\r\n  var ry = this.y + window.y + window.height / 2 * (1 - window._openness / 255);\r\n  var rw = window.width;\r\n  var rh = window.height * window._openness / 255;\r\n  renderSession.context.clearRect(rx, ry, rw, rh);\r\n};\r\n\r\n/**\r\n* @method _renderWebGL\r\n* @param {Object} renderSession\r\n* @private\r\n*/\r\nWindowLayer.prototype.renderWebGL = function(renderer) {\r\n  if (!this.visible || !this.renderable) {\r\n      return;\r\n  }\r\n\r\n  if (this.children.length==0) {\r\n      return;\r\n  }\r\n\r\n  renderer.flush();\r\n  this.filterArea.copy(this);\r\n  renderer.filterManager.pushFilter(this, this.filters);\r\n  renderer.currentRenderer.start();\r\n\r\n  var shift = new PIXI.Point();\r\n  var rt = renderer._activeRenderTarget;\r\n  var projectionMatrix = rt.projectionMatrix;\r\n  shift.x = Math.round((projectionMatrix.tx + 1) / 2 * rt.sourceFrame.width);\r\n  shift.y = Math.round((projectionMatrix.ty + 1) / 2 * rt.sourceFrame.height);\r\n\r\n  for (var i = 0; i < this.children.length; i++) {\r\n      var child = this.children[i];\r\n      if (child._isWindow && child.visible && child.openness > 0) {\r\n          this._maskWindow(child, shift);\r\n          renderer.maskManager.pushScissorMask(this, this._windowMask);\r\n          renderer.clear();\r\n          renderer.maskManager.popScissorMask();\r\n          renderer.currentRenderer.start();\r\n          child.renderWebGL(renderer);\r\n          renderer.currentRenderer.flush();\r\n      }\r\n  }\r\n\r\n  renderer.flush();\r\n  renderer.filterManager.popFilter();\r\n  renderer.maskManager.popScissorMask();\r\n\r\n  for (var j = 0; j < this.children.length; j++) {\r\n      if (!this.children[j]._isWindow) {\r\n          this.children[j].renderWebGL(renderer);\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _maskWindow\r\n* @param {Window} window\r\n* @private\r\n*/\r\nWindowLayer.prototype._maskWindow = function(window, shift) {\r\n  this._windowMask._currentBounds = null;\r\n  this._windowMask.boundsDirty = true;\r\n  var rect = this._windowRect;\r\n  rect.x = this.x + shift.x + window.x;\r\n  rect.y = this.x + shift.y + window.y + window.height / 2 * (1 - window._openness / 255);\r\n  rect.width = window.width;\r\n  rect.height = window.height * window._openness / 255;\r\n};\r\n\r\n// The important members from Pixi.js\r\n\r\n/**\r\n* The x coordinate of the window layer.\r\n*\r\n* @property x\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* The y coordinate of the window layer.\r\n*\r\n* @property y\r\n* @type Number\r\n*/\r\n\r\n/**\r\n* [read-only] The array of children of the window layer.\r\n*\r\n* @property children\r\n* @type Array\r\n*/\r\n\r\n/**\r\n* [read-only] The object that contains the window layer.\r\n*\r\n* @property parent\r\n* @type Object\r\n*/\r\n\r\n/**\r\n* Adds a child to the container.\r\n*\r\n* @method addChild\r\n* @param {Object} child The child to add\r\n* @return {Object} The child that was added\r\n*/\r\n\r\n/**\r\n* Adds a child to the container at a specified index.\r\n*\r\n* @method addChildAt\r\n* @param {Object} child The child to add\r\n* @param {Number} index The index to place the child in\r\n* @return {Object} The child that was added\r\n*/\r\n\r\n/**\r\n* Removes a child from the container.\r\n*\r\n* @method removeChild\r\n* @param {Object} child The child to remove\r\n* @return {Object} The child that was removed\r\n*/\r\n\r\n/**\r\n* Removes a child from the specified index position.\r\n*\r\n* @method removeChildAt\r\n* @param {Number} index The index to get the child from\r\n* @return {Object} The child that was removed\r\n*/\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The weather effect which displays rain, storm, or snow.\r\n*\r\n* @class Weather\r\n* @constructor\r\n*/\r\nfunction Weather() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nWeather.prototype = Object.create(PIXI.Container.prototype);\r\nWeather.prototype.constructor = Weather;\r\n\r\nWeather.prototype.initialize = function() {\r\n  PIXI.Container.call(this);\r\n\r\n  this._width = Graphics.width;\r\n  this._height = Graphics.height;\r\n  this._sprites = [];\r\n\r\n  this._createBitmaps();\r\n  this._createDimmer();\r\n\r\n  /**\r\n   * The type of the weather in ['none', 'rain', 'storm', 'snow'].\r\n   *\r\n   * @property type\r\n   * @type String\r\n   */\r\n  this.type = 'none';\r\n\r\n  /**\r\n   * The power of the weather in the range (0, 9).\r\n   *\r\n   * @property power\r\n   * @type Number\r\n   */\r\n  this.power = 0;\r\n\r\n  /**\r\n   * The origin point of the weather for scrolling.\r\n   *\r\n   * @property origin\r\n   * @type Point\r\n   */\r\n  this.origin = new Point();\r\n};\r\n\r\n/**\r\n* Updates the weather for each frame.\r\n*\r\n* @method update\r\n*/\r\nWeather.prototype.update = function() {\r\n  this._updateDimmer();\r\n  this._updateAllSprites();\r\n};\r\n\r\n/**\r\n* @method _createBitmaps\r\n* @private\r\n*/\r\nWeather.prototype._createBitmaps = function() {\r\n  this._rainBitmap = new Bitmap(1, 60);\r\n  this._rainBitmap.fillAll('white');\r\n  this._stormBitmap = new Bitmap(2, 100);\r\n  this._stormBitmap.fillAll('white');\r\n  this._snowBitmap = new Bitmap(9, 9);\r\n  this._snowBitmap.drawCircle(4, 4, 4, 'white');\r\n};\r\n\r\n/**\r\n* @method _createDimmer\r\n* @private\r\n*/\r\nWeather.prototype._createDimmer = function() {\r\n  this._dimmerSprite = new ScreenSprite();\r\n  this._dimmerSprite.setColor(80, 80, 80);\r\n  this.addChild(this._dimmerSprite);\r\n};\r\n\r\n/**\r\n* @method _updateDimmer\r\n* @private\r\n*/\r\nWeather.prototype._updateDimmer = function() {\r\n  this._dimmerSprite.opacity = Math.floor(this.power * 6);\r\n};\r\n\r\n/**\r\n* @method _updateAllSprites\r\n* @private\r\n*/\r\nWeather.prototype._updateAllSprites = function() {\r\n  var maxSprites = Math.floor(this.power * 10);\r\n  while (this._sprites.length < maxSprites) {\r\n      this._addSprite();\r\n  }\r\n  while (this._sprites.length > maxSprites) {\r\n      this._removeSprite();\r\n  }\r\n  this._sprites.forEach(function(sprite) {\r\n      this._updateSprite(sprite);\r\n      sprite.x = sprite.ax - this.origin.x;\r\n      sprite.y = sprite.ay - this.origin.y;\r\n  }, this);\r\n};\r\n\r\n/**\r\n* @method _addSprite\r\n* @private\r\n*/\r\nWeather.prototype._addSprite = function() {\r\n  var sprite = new Sprite(this.viewport);\r\n  sprite.opacity = 0;\r\n  this._sprites.push(sprite);\r\n  this.addChild(sprite);\r\n};\r\n\r\n/**\r\n* @method _removeSprite\r\n* @private\r\n*/\r\nWeather.prototype._removeSprite = function() {\r\n  this.removeChild(this._sprites.pop());\r\n};\r\n\r\n/**\r\n* @method _updateSprite\r\n* @param {Sprite} sprite\r\n* @private\r\n*/\r\nWeather.prototype._updateSprite = function(sprite) {\r\n  switch (this.type) {\r\n  case 'rain':\r\n      this._updateRainSprite(sprite);\r\n      break;\r\n  case 'storm':\r\n      this._updateStormSprite(sprite);\r\n      break;\r\n  case 'snow':\r\n      this._updateSnowSprite(sprite);\r\n      break;\r\n  }\r\n  if (sprite.opacity < 40) {\r\n      this._rebornSprite(sprite);\r\n  }\r\n};\r\n\r\n/**\r\n* @method _updateRainSprite\r\n* @param {Sprite} sprite\r\n* @private\r\n*/\r\nWeather.prototype._updateRainSprite = function(sprite) {\r\n  sprite.bitmap = this._rainBitmap;\r\n  sprite.rotation = Math.PI / 16;\r\n  sprite.ax -= 6 * Math.sin(sprite.rotation);\r\n  sprite.ay += 6 * Math.cos(sprite.rotation);\r\n  sprite.opacity -= 6;\r\n};\r\n\r\n/**\r\n* @method _updateStormSprite\r\n* @param {Sprite} sprite\r\n* @private\r\n*/\r\nWeather.prototype._updateStormSprite = function(sprite) {\r\n  sprite.bitmap = this._stormBitmap;\r\n  sprite.rotation = Math.PI / 8;\r\n  sprite.ax -= 8 * Math.sin(sprite.rotation);\r\n  sprite.ay += 8 * Math.cos(sprite.rotation);\r\n  sprite.opacity -= 8;\r\n};\r\n\r\n/**\r\n* @method _updateSnowSprite\r\n* @param {Sprite} sprite\r\n* @private\r\n*/\r\nWeather.prototype._updateSnowSprite = function(sprite) {\r\n  sprite.bitmap = this._snowBitmap;\r\n  sprite.rotation = Math.PI / 16;\r\n  sprite.ax -= 3 * Math.sin(sprite.rotation);\r\n  sprite.ay += 3 * Math.cos(sprite.rotation);\r\n  sprite.opacity -= 3;\r\n};\r\n\r\n/**\r\n* @method _rebornSprite\r\n* @param {Sprite} sprite\r\n* @private\r\n*/\r\nWeather.prototype._rebornSprite = function(sprite) {\r\n  sprite.ax = Math.randomInt(Graphics.width + 100) - 100 + this.origin.x;\r\n  sprite.ay = Math.randomInt(Graphics.height + 200) - 200 + this.origin.y;\r\n  sprite.opacity = 160 + Math.randomInt(60);\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The color matrix filter for WebGL.\r\n*\r\n* @class ToneFilter\r\n* @extends PIXI.Filter\r\n* @constructor\r\n*/\r\nfunction ToneFilter() {\r\n  PIXI.filters.ColorMatrixFilter.call(this);\r\n}\r\n\r\nToneFilter.prototype = Object.create(PIXI.filters.ColorMatrixFilter.prototype);\r\nToneFilter.prototype.constructor = ToneFilter;\r\n\r\n/**\r\n* Changes the hue.\r\n*\r\n* @method adjustHue\r\n* @param {Number} value The hue value in the range (-360, 360)\r\n*/\r\nToneFilter.prototype.adjustHue = function(value) {\r\n  this.hue(value, true);\r\n};\r\n\r\n/**\r\n* Changes the saturation.\r\n*\r\n* @method adjustSaturation\r\n* @param {Number} value The saturation value in the range (-255, 255)\r\n*/\r\nToneFilter.prototype.adjustSaturation = function(value) {\r\n  value = (value || 0).clamp(-255, 255) / 255;\r\n  this.saturate(value, true);\r\n};\r\n\r\n/**\r\n* Changes the tone.\r\n*\r\n* @method adjustTone\r\n* @param {Number} r The red strength in the range (-255, 255)\r\n* @param {Number} g The green strength in the range (-255, 255)\r\n* @param {Number} b The blue strength in the range (-255, 255)\r\n*/\r\nToneFilter.prototype.adjustTone = function(r, g, b) {\r\n  r = (r || 0).clamp(-255, 255) / 255;\r\n  g = (g || 0).clamp(-255, 255) / 255;\r\n  b = (b || 0).clamp(-255, 255) / 255;\r\n\r\n  if (r !== 0 || g !== 0 || b !== 0) {\r\n      var matrix = [\r\n          1, 0, 0, r, 0,\r\n          0, 1, 0, g, 0,\r\n          0, 0, 1, b, 0,\r\n          0, 0, 0, 1, 0\r\n      ];\r\n\r\n      this._loadMatrix(matrix, true);\r\n  }\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The sprite which changes the screen color in 2D canvas mode.\r\n*\r\n* @class ToneSprite\r\n* @constructor\r\n*/\r\nfunction ToneSprite() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nToneSprite.prototype = Object.create(PIXI.Container.prototype);\r\nToneSprite.prototype.constructor = ToneSprite;\r\n\r\nToneSprite.prototype.initialize = function() {\r\n  PIXI.Container.call(this);\r\n  this.clear();\r\n};\r\n\r\n/**\r\n* Clears the tone.\r\n*\r\n* @method reset\r\n*/\r\nToneSprite.prototype.clear = function() {\r\n  this._red = 0;\r\n  this._green = 0;\r\n  this._blue = 0;\r\n  this._gray = 0;\r\n};\r\n\r\n/**\r\n* Sets the tone.\r\n*\r\n* @method setTone\r\n* @param {Number} r The red strength in the range (-255, 255)\r\n* @param {Number} g The green strength in the range (-255, 255)\r\n* @param {Number} b The blue strength in the range (-255, 255)\r\n* @param {Number} gray The grayscale level in the range (0, 255)\r\n*/\r\nToneSprite.prototype.setTone = function(r, g, b, gray) {\r\n  this._red = Math.round(r || 0).clamp(-255, 255);\r\n  this._green = Math.round(g || 0).clamp(-255, 255);\r\n  this._blue = Math.round(b || 0).clamp(-255, 255);\r\n  this._gray = Math.round(gray || 0).clamp(0, 255);\r\n};\r\n\r\n/**\r\n* @method _renderCanvas\r\n* @param {Object} renderSession\r\n* @private\r\n*/\r\nToneSprite.prototype._renderCanvas = function(renderer) {\r\n  if (this.visible) {\r\n      var context = renderer.context;\r\n      var t = this.worldTransform;\r\n      var r = renderer.resolution;\r\n      var width = Graphics.width;\r\n      var height = Graphics.height;\r\n      context.save();\r\n      context.setTransform(t.a, t.b, t.c, t.d, t.tx * r, t.ty * r);\r\n      if (Graphics.canUseSaturationBlend() && this._gray > 0) {\r\n          context.globalCompositeOperation = 'saturation';\r\n          context.globalAlpha = this._gray / 255;\r\n          context.fillStyle = '#ffffff';\r\n          context.fillRect(0, 0, width, height);\r\n      }\r\n      context.globalAlpha = 1;\r\n      var r1 = Math.max(0, this._red);\r\n      var g1 = Math.max(0, this._green);\r\n      var b1 = Math.max(0, this._blue);\r\n      if (r1 || g1 || b1) {\r\n          context.globalCompositeOperation = 'lighter';\r\n          context.fillStyle = Utils.rgbToCssColor(r1, g1, b1);\r\n          context.fillRect(0, 0, width, height);\r\n      }\r\n      if (Graphics.canUseDifferenceBlend()) {\r\n          var r2 = Math.max(0, -this._red);\r\n          var g2 = Math.max(0, -this._green);\r\n          var b2 = Math.max(0, -this._blue);\r\n          if (r2 || g2 || b2) {\r\n              context.globalCompositeOperation = 'difference';\r\n              context.fillStyle = '#ffffff';\r\n              context.fillRect(0, 0, width, height);\r\n              context.globalCompositeOperation = 'lighter';\r\n              context.fillStyle = Utils.rgbToCssColor(r2, g2, b2);\r\n              context.fillRect(0, 0, width, height);\r\n              context.globalCompositeOperation = 'difference';\r\n              context.fillStyle = '#ffffff';\r\n              context.fillRect(0, 0, width, height);\r\n          }\r\n      }\r\n      context.restore();\r\n  }\r\n};\r\n\r\n/**\r\n* @method _renderWebGL\r\n* @param {Object} renderSession\r\n* @private\r\n*/\r\nToneSprite.prototype._renderWebGL = function(renderer) {\r\n  // Not supported\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The root object of the display tree.\r\n*\r\n* @class Stage\r\n* @constructor\r\n*/\r\nfunction Stage() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nStage.prototype = Object.create(PIXI.Container.prototype);\r\nStage.prototype.constructor = Stage;\r\n\r\nStage.prototype.initialize = function() {\r\n  PIXI.Container.call(this);\r\n\r\n  // The interactive flag causes a memory leak.\r\n  this.interactive = false;\r\n};\r\n\r\n/**\r\n* [read-only] The array of children of the stage.\r\n*\r\n* @property children\r\n* @type Array\r\n*/\r\n\r\n/**\r\n* Adds a child to the container.\r\n*\r\n* @method addChild\r\n* @param {Object} child The child to add\r\n* @return {Object} The child that was added\r\n*/\r\n\r\n/**\r\n* Adds a child to the container at a specified index.\r\n*\r\n* @method addChildAt\r\n* @param {Object} child The child to add\r\n* @param {Number} index The index to place the child in\r\n* @return {Object} The child that was added\r\n*/\r\n\r\n/**\r\n* Removes a child from the container.\r\n*\r\n* @method removeChild\r\n* @param {Object} child The child to remove\r\n* @return {Object} The child that was removed\r\n*/\r\n\r\n/**\r\n* Removes a child from the specified index position.\r\n*\r\n* @method removeChildAt\r\n* @param {Number} index The index to get the child from\r\n* @return {Object} The child that was removed\r\n*/\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The audio object of Web Audio API.\r\n*\r\n* @class WebAudio\r\n* @constructor\r\n* @param {String} url The url of the audio file\r\n*/\r\nfunction WebAudio() {\r\n  this.initialize.apply(this, arguments);\r\n}\r\n\r\nWebAudio._standAlone = (function(top){\r\n  return !top.ResourceHandler;\r\n})(this);\r\n\r\nWebAudio.prototype.initialize = function(url) {\r\n  if (!WebAudio._initialized) {\r\n      WebAudio.initialize();\r\n  }\r\n  this.clear();\r\n\r\n  if(!WebAudio._standAlone){\r\n      this._loader = ResourceHandler.createLoader(url, this._load.bind(this, url), function() {\r\n          this._hasError = true;\r\n      }.bind(this));\r\n  }\r\n  this._load(url);\r\n  this._url = url;\r\n};\r\n\r\nWebAudio._masterVolume   = 1;\r\nWebAudio._context        = null;\r\nWebAudio._masterGainNode = null;\r\nWebAudio._initialized    = false;\r\nWebAudio._unlocked       = false;\r\n\r\n/**\r\n* Initializes the audio system.\r\n*\r\n* @static\r\n* @method initialize\r\n* @param {Boolean} noAudio Flag for the no-audio mode\r\n* @return {Boolean} True if the audio system is available\r\n*/\r\nWebAudio.initialize = function(noAudio) {\r\n  if (!this._initialized) {\r\n      if (!noAudio) {\r\n          this._createContext();\r\n          this._detectCodecs();\r\n          this._createMasterGainNode();\r\n          this._setupEventHandlers();\r\n      }\r\n      this._initialized = true;\r\n  }\r\n  return !!this._context;\r\n};\r\n\r\n/**\r\n* Checks whether the browser can play ogg files.\r\n*\r\n* @static\r\n* @method canPlayOgg\r\n* @return {Boolean} True if the browser can play ogg files\r\n*/\r\nWebAudio.canPlayOgg = function() {\r\n  if (!this._initialized) {\r\n      this.initialize();\r\n  }\r\n  return !!this._canPlayOgg;\r\n};\r\n\r\n/**\r\n* Checks whether the browser can play m4a files.\r\n*\r\n* @static\r\n* @method canPlayM4a\r\n* @return {Boolean} True if the browser can play m4a files\r\n*/\r\nWebAudio.canPlayM4a = function() {\r\n  if (!this._initialized) {\r\n      this.initialize();\r\n  }\r\n  return !!this._canPlayM4a;\r\n};\r\n\r\n/**\r\n* Sets the master volume of the all audio.\r\n*\r\n* @static\r\n* @method setMasterVolume\r\n* @param {Number} value Master volume (min: 0, max: 1)\r\n*/\r\nWebAudio.setMasterVolume = function(value) {\r\n  this._masterVolume = value;\r\n  if (this._masterGainNode) {\r\n      this._masterGainNode.gain.setValueAtTime(this._masterVolume, this._context.currentTime);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createContext\r\n* @private\r\n*/\r\nWebAudio._createContext = function() {\r\n  try {\r\n      if (typeof AudioContext !== 'undefined') {\r\n          this._context = new AudioContext();\r\n      } else if (typeof webkitAudioContext !== 'undefined') {\r\n          this._context = new webkitAudioContext();\r\n      }\r\n  } catch (e) {\r\n      this._context = null;\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _detectCodecs\r\n* @private\r\n*/\r\nWebAudio._detectCodecs = function() {\r\n  var audio = document.createElement('audio');\r\n  if (audio.canPlayType) {\r\n      this._canPlayOgg = audio.canPlayType('audio/ogg');\r\n      this._canPlayM4a = audio.canPlayType('audio/mp4');\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _createMasterGainNode\r\n* @private\r\n*/\r\nWebAudio._createMasterGainNode = function() {\r\n  var context = WebAudio._context;\r\n  if (context) {\r\n      this._masterGainNode = context.createGain();\r\n      this._masterGainNode.gain.setValueAtTime(this._masterVolume, context.currentTime);\r\n      this._masterGainNode.connect(context.destination);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _setupEventHandlers\r\n* @private\r\n*/\r\nWebAudio._setupEventHandlers = function() {\r\n  document.addEventListener(\"touchend\", function() {\r\n          var context = WebAudio._context;\r\n          if (context && context.state === \"suspended\" && typeof context.resume === \"function\") {\r\n              context.resume().then(function() {\r\n                  WebAudio._onTouchStart();\r\n              })\r\n          } else {\r\n              WebAudio._onTouchStart();\r\n          }\r\n  });\r\n  document.addEventListener('touchstart', this._onTouchStart.bind(this));\r\n  document.addEventListener('visibilitychange', this._onVisibilityChange.bind(this));\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onTouchStart\r\n* @private\r\n*/\r\nWebAudio._onTouchStart = function() {\r\n  var context = WebAudio._context;\r\n  if (context && !this._unlocked) {\r\n      // Unlock Web Audio on iOS\r\n      var node = context.createBufferSource();\r\n      node.start(0);\r\n      this._unlocked = true;\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onVisibilityChange\r\n* @private\r\n*/\r\nWebAudio._onVisibilityChange = function() {\r\n  if (document.visibilityState === 'hidden') {\r\n      this._onHide();\r\n  } else {\r\n      this._onShow();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onHide\r\n* @private\r\n*/\r\nWebAudio._onHide = function() {\r\n  if (this._shouldMuteOnHide()) {\r\n      this._fadeOut(1);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onShow\r\n* @private\r\n*/\r\nWebAudio._onShow = function() {\r\n  if (this._shouldMuteOnHide()) {\r\n      this._fadeIn(0.5);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _shouldMuteOnHide\r\n* @private\r\n*/\r\nWebAudio._shouldMuteOnHide = function() {\r\n  return Utils.isMobileDevice();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _fadeIn\r\n* @param {Number} duration\r\n* @private\r\n*/\r\nWebAudio._fadeIn = function(duration) {\r\n  if (this._masterGainNode) {\r\n      var gain = this._masterGainNode.gain;\r\n      var currentTime = WebAudio._context.currentTime;\r\n      gain.setValueAtTime(0, currentTime);\r\n      gain.linearRampToValueAtTime(this._masterVolume, currentTime + duration);\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _fadeOut\r\n* @param {Number} duration\r\n* @private\r\n*/\r\nWebAudio._fadeOut = function(duration) {\r\n  if (this._masterGainNode) {\r\n      var gain = this._masterGainNode.gain;\r\n      var currentTime = WebAudio._context.currentTime;\r\n      gain.setValueAtTime(this._masterVolume, currentTime);\r\n      gain.linearRampToValueAtTime(0, currentTime + duration);\r\n  }\r\n};\r\n\r\n/**\r\n* Clears the audio data.\r\n*\r\n* @method clear\r\n*/\r\nWebAudio.prototype.clear = function() {\r\n  this.stop();\r\n  this._buffer = null;\r\n  this._sourceNode = null;\r\n  this._gainNode = null;\r\n  this._pannerNode = null;\r\n  this._totalTime = 0;\r\n  this._sampleRate = 0;\r\n  this._loopStart = 0;\r\n  this._loopLength = 0;\r\n  this._startTime = 0;\r\n  this._volume = 1;\r\n  this._pitch = 1;\r\n  this._pan = 0;\r\n  this._endTimer = null;\r\n  this._loadListeners = [];\r\n  this._stopListeners = [];\r\n  this._hasError = false;\r\n  this._autoPlay = false;\r\n};\r\n\r\n/**\r\n* [read-only] The url of the audio file.\r\n*\r\n* @property url\r\n* @type String\r\n*/\r\nObject.defineProperty(WebAudio.prototype, 'url', {\r\n  get: function() {\r\n      return this._url;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The volume of the audio.\r\n*\r\n* @property volume\r\n* @type Number\r\n*/\r\nObject.defineProperty(WebAudio.prototype, 'volume', {\r\n  get: function() {\r\n      return this._volume;\r\n  },\r\n  set: function(value) {\r\n      this._volume = value;\r\n      if (this._gainNode) {\r\n          this._gainNode.gain.setValueAtTime(this._volume, WebAudio._context.currentTime);\r\n      }\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The pitch of the audio.\r\n*\r\n* @property pitch\r\n* @type Number\r\n*/\r\nObject.defineProperty(WebAudio.prototype, 'pitch', {\r\n  get: function() {\r\n      return this._pitch;\r\n  },\r\n  set: function(value) {\r\n      if (this._pitch !== value) {\r\n          this._pitch = value;\r\n          if (this.isPlaying()) {\r\n              this.play(this._sourceNode.loop, 0);\r\n          }\r\n      }\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The pan of the audio.\r\n*\r\n* @property pan\r\n* @type Number\r\n*/\r\nObject.defineProperty(WebAudio.prototype, 'pan', {\r\n  get: function() {\r\n      return this._pan;\r\n  },\r\n  set: function(value) {\r\n      this._pan = value;\r\n      this._updatePanner();\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* Checks whether the audio data is ready to play.\r\n*\r\n* @method isReady\r\n* @return {Boolean} True if the audio data is ready to play\r\n*/\r\nWebAudio.prototype.isReady = function() {\r\n  return !!this._buffer;\r\n};\r\n\r\n/**\r\n* Checks whether a loading error has occurred.\r\n*\r\n* @method isError\r\n* @return {Boolean} True if a loading error has occurred\r\n*/\r\nWebAudio.prototype.isError = function() {\r\n  return this._hasError;\r\n};\r\n\r\n/**\r\n* Checks whether the audio is playing.\r\n*\r\n* @method isPlaying\r\n* @return {Boolean} True if the audio is playing\r\n*/\r\nWebAudio.prototype.isPlaying = function() {\r\n  return !!this._sourceNode;\r\n};\r\n\r\n/**\r\n* Plays the audio.\r\n*\r\n* @method play\r\n* @param {Boolean} loop Whether the audio data play in a loop\r\n* @param {Number} offset The start position to play in seconds\r\n*/\r\nWebAudio.prototype.play = function(loop, offset) {\r\n  if (this.isReady()) {\r\n      offset = offset || 0;\r\n      this._startPlaying(loop, offset);\r\n  } else if (WebAudio._context) {\r\n      this._autoPlay = true;\r\n      this.addLoadListener(function() {\r\n          if (this._autoPlay) {\r\n              this.play(loop, offset);\r\n          }\r\n      }.bind(this));\r\n  }\r\n};\r\n\r\n/**\r\n* Stops the audio.\r\n*\r\n* @method stop\r\n*/\r\nWebAudio.prototype.stop = function() {\r\n  this._autoPlay = false;\r\n  this._removeEndTimer();\r\n  this._removeNodes();\r\n  if (this._stopListeners) {\r\n      while (this._stopListeners.length > 0) {\r\n          var listner = this._stopListeners.shift();\r\n          listner();\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* Performs the audio fade-in.\r\n*\r\n* @method fadeIn\r\n* @param {Number} duration Fade-in time in seconds\r\n*/\r\nWebAudio.prototype.fadeIn = function(duration) {\r\n  if (this.isReady()) {\r\n      if (this._gainNode) {\r\n          var gain = this._gainNode.gain;\r\n          var currentTime = WebAudio._context.currentTime;\r\n          gain.setValueAtTime(0, currentTime);\r\n          gain.linearRampToValueAtTime(this._volume, currentTime + duration);\r\n      }\r\n  } else if (this._autoPlay) {\r\n      this.addLoadListener(function() {\r\n          this.fadeIn(duration);\r\n      }.bind(this));\r\n  }\r\n};\r\n\r\n/**\r\n* Performs the audio fade-out.\r\n*\r\n* @method fadeOut\r\n* @param {Number} duration Fade-out time in seconds\r\n*/\r\nWebAudio.prototype.fadeOut = function(duration) {\r\n  if (this._gainNode) {\r\n      var gain = this._gainNode.gain;\r\n      var currentTime = WebAudio._context.currentTime;\r\n      gain.setValueAtTime(this._volume, currentTime);\r\n      gain.linearRampToValueAtTime(0, currentTime + duration);\r\n  }\r\n  this._autoPlay = false;\r\n};\r\n\r\n/**\r\n* Gets the seek position of the audio.\r\n*\r\n* @method seek\r\n*/\r\nWebAudio.prototype.seek = function() {\r\n  if (WebAudio._context) {\r\n      var pos = (WebAudio._context.currentTime - this._startTime) * this._pitch;\r\n      if (this._loopLength > 0) {\r\n          while (pos >= this._loopStart + this._loopLength) {\r\n              pos -= this._loopLength;\r\n          }\r\n      }\r\n      return pos;\r\n  } else {\r\n      return 0;\r\n  }\r\n};\r\n\r\n/**\r\n* Add a callback function that will be called when the audio data is loaded.\r\n*\r\n* @method addLoadListener\r\n* @param {Function} listner The callback function\r\n*/\r\nWebAudio.prototype.addLoadListener = function(listner) {\r\n  this._loadListeners.push(listner);\r\n};\r\n\r\n/**\r\n* Add a callback function that will be called when the playback is stopped.\r\n*\r\n* @method addStopListener\r\n* @param {Function} listner The callback function\r\n*/\r\nWebAudio.prototype.addStopListener = function(listner) {\r\n  this._stopListeners.push(listner);\r\n};\r\n\r\n/**\r\n* @method _load\r\n* @param {String} url\r\n* @private\r\n*/\r\nWebAudio.prototype._load = function(url) {\r\n  if (WebAudio._context) {\r\n      var xhr = new XMLHttpRequest();\r\n      if(Decrypter.hasEncryptedAudio) url = Decrypter.extToEncryptExt(url);\r\n      xhr.open('GET', url);\r\n      xhr.responseType = 'arraybuffer';\r\n      xhr.onload = function() {\r\n          if (xhr.status < 400) {\r\n              this._onXhrLoad(xhr);\r\n          }\r\n      }.bind(this);\r\n      xhr.onerror = this._loader || function(){this._hasError = true;}.bind(this);\r\n      xhr.send();\r\n  }\r\n};\r\n\r\n/**\r\n* @method _onXhrLoad\r\n* @param {XMLHttpRequest} xhr\r\n* @private\r\n*/\r\nWebAudio.prototype._onXhrLoad = function(xhr) {\r\n  var array = xhr.response;\r\n  if(Decrypter.hasEncryptedAudio) array = Decrypter.decryptArrayBuffer(array);\r\n  this._readLoopComments(new Uint8Array(array));\r\n  WebAudio._context.decodeAudioData(array, function(buffer) {\r\n      this._buffer = buffer;\r\n      this._totalTime = buffer.duration;\r\n      if (this._loopLength > 0 && this._sampleRate > 0) {\r\n          this._loopStart /= this._sampleRate;\r\n          this._loopLength /= this._sampleRate;\r\n      } else {\r\n          this._loopStart = 0;\r\n          this._loopLength = this._totalTime;\r\n      }\r\n      this._onLoad();\r\n  }.bind(this));\r\n};\r\n\r\n/**\r\n* @method _startPlaying\r\n* @param {Boolean} loop\r\n* @param {Number} offset\r\n* @private\r\n*/\r\nWebAudio.prototype._startPlaying = function(loop, offset) {\r\n  this._removeEndTimer();\r\n  this._removeNodes();\r\n  this._createNodes();\r\n  this._connectNodes();\r\n  this._sourceNode.loop = loop;\r\n  this._sourceNode.start(0, offset);\r\n  this._startTime = WebAudio._context.currentTime - offset / this._pitch;\r\n  this._createEndTimer();\r\n};\r\n\r\n/**\r\n* @method _createNodes\r\n* @private\r\n*/\r\nWebAudio.prototype._createNodes = function() {\r\n  var context = WebAudio._context;\r\n  this._sourceNode = context.createBufferSource();\r\n  this._sourceNode.buffer = this._buffer;\r\n  this._sourceNode.loopStart = this._loopStart;\r\n  this._sourceNode.loopEnd = this._loopStart + this._loopLength;\r\n  this._sourceNode.playbackRate.setValueAtTime(this._pitch, context.currentTime);\r\n  this._gainNode = context.createGain();\r\n  this._gainNode.gain.setValueAtTime(this._volume, context.currentTime);\r\n  this._pannerNode = context.createPanner();\r\n  this._pannerNode.panningModel = 'equalpower';\r\n  this._updatePanner();\r\n};\r\n\r\n/**\r\n* @method _connectNodes\r\n* @private\r\n*/\r\nWebAudio.prototype._connectNodes = function() {\r\n  this._sourceNode.connect(this._gainNode);\r\n  this._gainNode.connect(this._pannerNode);\r\n  this._pannerNode.connect(WebAudio._masterGainNode);\r\n};\r\n\r\n/**\r\n* @method _removeNodes\r\n* @private\r\n*/\r\nWebAudio.prototype._removeNodes = function() {\r\n  if (this._sourceNode) {\r\n      this._sourceNode.stop(0);\r\n      this._sourceNode = null;\r\n      this._gainNode = null;\r\n      this._pannerNode = null;\r\n  }\r\n};\r\n\r\n/**\r\n* @method _createEndTimer\r\n* @private\r\n*/\r\nWebAudio.prototype._createEndTimer = function() {\r\n  if (this._sourceNode && !this._sourceNode.loop) {\r\n      var endTime = this._startTime + this._totalTime / this._pitch;\r\n      var delay =  endTime - WebAudio._context.currentTime;\r\n      this._endTimer = setTimeout(function() {\r\n          this.stop();\r\n      }.bind(this), delay * 1000);\r\n  }\r\n};\r\n\r\n/**\r\n* @method _removeEndTimer\r\n* @private\r\n*/\r\nWebAudio.prototype._removeEndTimer = function() {\r\n  if (this._endTimer) {\r\n      clearTimeout(this._endTimer);\r\n      this._endTimer = null;\r\n  }\r\n};\r\n\r\n/**\r\n* @method _updatePanner\r\n* @private\r\n*/\r\nWebAudio.prototype._updatePanner = function() {\r\n  if (this._pannerNode) {\r\n      var x = this._pan;\r\n      var z = 1 - Math.abs(x);\r\n      this._pannerNode.setPosition(x, 0, z);\r\n  }\r\n};\r\n\r\n/**\r\n* @method _onLoad\r\n* @private\r\n*/\r\nWebAudio.prototype._onLoad = function() {\r\n  while (this._loadListeners.length > 0) {\r\n      var listner = this._loadListeners.shift();\r\n      listner();\r\n  }\r\n};\r\n\r\n/**\r\n* @method _readLoopComments\r\n* @param {Uint8Array} array\r\n* @private\r\n*/\r\nWebAudio.prototype._readLoopComments = function(array) {\r\n  this._readOgg(array);\r\n  this._readMp4(array);\r\n};\r\n\r\n/**\r\n* @method _readOgg\r\n* @param {Uint8Array} array\r\n* @private\r\n*/\r\nWebAudio.prototype._readOgg = function(array) {\r\n  var index = 0;\r\n  while (index < array.length) {\r\n      if (this._readFourCharacters(array, index) === 'OggS') {\r\n          index += 26;\r\n          var vorbisHeaderFound = false;\r\n          var numSegments = array[index++];\r\n          var segments = [];\r\n          for (var i = 0; i < numSegments; i++) {\r\n              segments.push(array[index++]);\r\n          }\r\n          for (i = 0; i < numSegments; i++) {\r\n              if (this._readFourCharacters(array, index + 1) === 'vorb') {\r\n                  var headerType = array[index];\r\n                  if (headerType === 1) {\r\n                      this._sampleRate = this._readLittleEndian(array, index + 12);\r\n                  } else if (headerType === 3) {\r\n                      this._readMetaData(array, index, segments[i]);\r\n                  }\r\n                  vorbisHeaderFound = true;\r\n              }\r\n              index += segments[i];\r\n          }\r\n          if (!vorbisHeaderFound) {\r\n              break;\r\n          }\r\n      } else {\r\n          break;\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _readMp4\r\n* @param {Uint8Array} array\r\n* @private\r\n*/\r\nWebAudio.prototype._readMp4 = function(array) {\r\n  if (this._readFourCharacters(array, 4) === 'ftyp') {\r\n      var index = 0;\r\n      while (index < array.length) {\r\n          var size = this._readBigEndian(array, index);\r\n          var name = this._readFourCharacters(array, index + 4);\r\n          if (name === 'moov') {\r\n              index += 8;\r\n          } else {\r\n              if (name === 'mvhd') {\r\n                  this._sampleRate = this._readBigEndian(array, index + 20);\r\n              }\r\n              if (name === 'udta' || name === 'meta') {\r\n                  this._readMetaData(array, index, size);\r\n              }\r\n              index += size;\r\n              if (size <= 1) {\r\n                  break;\r\n              }\r\n          }\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _readMetaData\r\n* @param {Uint8Array} array\r\n* @param {Number} index\r\n* @param {Number} size\r\n* @private\r\n*/\r\nWebAudio.prototype._readMetaData = function(array, index, size) {\r\n  for (var i = index; i < index + size - 10; i++) {\r\n      if (this._readFourCharacters(array, i) === 'LOOP') {\r\n          var text = '';\r\n          while (array[i] > 0) {\r\n              text += String.fromCharCode(array[i++]);\r\n          }\r\n          if (text.match(/LOOPSTART=([0-9]+)/)) {\r\n              this._loopStart = parseInt(RegExp.$1);\r\n          }\r\n          if (text.match(/LOOPLENGTH=([0-9]+)/)) {\r\n              this._loopLength = parseInt(RegExp.$1);\r\n          }\r\n          if (text == 'LOOPSTART' || text == 'LOOPLENGTH') {\r\n              var text2 = '';\r\n              i += 16;\r\n              while (array[i] > 0) {\r\n                  text2 += String.fromCharCode(array[i++]);\r\n              }\r\n              if (text == 'LOOPSTART') {\r\n                  this._loopStart = parseInt(text2);\r\n              } else {\r\n                  this._loopLength = parseInt(text2);\r\n              }\r\n          }\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @method _readLittleEndian\r\n* @param {Uint8Array} array\r\n* @param {Number} index\r\n* @private\r\n*/\r\nWebAudio.prototype._readLittleEndian = function(array, index) {\r\n  return (array[index + 3] * 0x1000000 + array[index + 2] * 0x10000 +\r\n          array[index + 1] * 0x100 + array[index + 0]);\r\n};\r\n\r\n/**\r\n* @method _readBigEndian\r\n* @param {Uint8Array} array\r\n* @param {Number} index\r\n* @private\r\n*/\r\nWebAudio.prototype._readBigEndian = function(array, index) {\r\n  return (array[index + 0] * 0x1000000 + array[index + 1] * 0x10000 +\r\n          array[index + 2] * 0x100 + array[index + 3]);\r\n};\r\n\r\n/**\r\n* @method _readFourCharacters\r\n* @param {Uint8Array} array\r\n* @param {Number} index\r\n* @private\r\n*/\r\nWebAudio.prototype._readFourCharacters = function(array, index) {\r\n  var string = '';\r\n  for (var i = 0; i < 4; i++) {\r\n      string += String.fromCharCode(array[index + i]);\r\n  }\r\n  return string;\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The static class that handles HTML5 Audio.\r\n*\r\n* @class Html5Audio\r\n* @constructor\r\n*/\r\nfunction Html5Audio() {\r\n  throw new Error('This is a static class');\r\n}\r\n\r\nHtml5Audio._initialized = false;\r\nHtml5Audio._unlocked = false;\r\nHtml5Audio._audioElement = null;\r\nHtml5Audio._gainTweenInterval = null;\r\nHtml5Audio._tweenGain = 0;\r\nHtml5Audio._tweenTargetGain = 0;\r\nHtml5Audio._tweenGainStep = 0;\r\nHtml5Audio._staticSePath = null;\r\n\r\n/**\r\n* Sets up the Html5 Audio.\r\n*\r\n* @static\r\n* @method setup\r\n* @param {String} url The url of the audio file\r\n*/\r\nHtml5Audio.setup = function (url) {\r\n  if (!this._initialized) {\r\n      this.initialize();\r\n  }\r\n  this.clear();\r\n\r\n  if(Decrypter.hasEncryptedAudio && this._audioElement.src) {\r\n      window.URL.revokeObjectURL(this._audioElement.src);\r\n  }\r\n  this._url = url;\r\n};\r\n\r\n/**\r\n* Initializes the audio system.\r\n*\r\n* @static\r\n* @method initialize\r\n* @return {Boolean} True if the audio system is available\r\n*/\r\nHtml5Audio.initialize = function () {\r\n  if (!this._initialized) {\r\n      if (!this._audioElement) {\r\n          try {\r\n              this._audioElement = new Audio();\r\n          } catch (e) {\r\n              this._audioElement = null;\r\n          }\r\n      }\r\n      if (!!this._audioElement) this._setupEventHandlers();\r\n      this._initialized = true;\r\n  }\r\n  return !!this._audioElement;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _setupEventHandlers\r\n* @private\r\n*/\r\nHtml5Audio._setupEventHandlers = function () {\r\n  document.addEventListener('touchstart', this._onTouchStart.bind(this));\r\n  document.addEventListener('visibilitychange', this._onVisibilityChange.bind(this));\r\n  this._audioElement.addEventListener(\"loadeddata\", this._onLoadedData.bind(this));\r\n  this._audioElement.addEventListener(\"error\", this._onError.bind(this));\r\n  this._audioElement.addEventListener(\"ended\", this._onEnded.bind(this));\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onTouchStart\r\n* @private\r\n*/\r\nHtml5Audio._onTouchStart = function () {\r\n  if (this._audioElement && !this._unlocked) {\r\n      if (this._isLoading) {\r\n          this._load(this._url);\r\n          this._unlocked = true;\r\n      } else {\r\n          if (this._staticSePath) {\r\n              this._audioElement.src = this._staticSePath;\r\n              this._audioElement.volume = 0;\r\n              this._audioElement.loop = false;\r\n              this._audioElement.play();\r\n              this._unlocked = true;\r\n          }\r\n      }\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onVisibilityChange\r\n* @private\r\n*/\r\nHtml5Audio._onVisibilityChange = function () {\r\n  if (document.visibilityState === 'hidden') {\r\n      this._onHide();\r\n  } else {\r\n      this._onShow();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onLoadedData\r\n* @private\r\n*/\r\nHtml5Audio._onLoadedData = function () {\r\n  this._buffered = true;\r\n  if (this._unlocked) this._onLoad();\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onError\r\n* @private\r\n*/\r\nHtml5Audio._onError = function () {\r\n  this._hasError = true;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onEnded\r\n* @private\r\n*/\r\nHtml5Audio._onEnded = function () {\r\n  if (!this._audioElement.loop) {\r\n      this.stop();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onHide\r\n* @private\r\n*/\r\nHtml5Audio._onHide = function () {\r\n  this._audioElement.volume = 0;\r\n  this._tweenGain = 0;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onShow\r\n* @private\r\n*/\r\nHtml5Audio._onShow = function () {\r\n  this.fadeIn(0.5);\r\n};\r\n\r\n/**\r\n* Clears the audio data.\r\n*\r\n* @static\r\n* @method clear\r\n*/\r\nHtml5Audio.clear = function () {\r\n  this.stop();\r\n  this._volume = 1;\r\n  this._loadListeners = [];\r\n  this._hasError = false;\r\n  this._autoPlay = false;\r\n  this._isLoading = false;\r\n  this._buffered = false;\r\n};\r\n\r\n/**\r\n* Set the URL of static se.\r\n*\r\n* @static\r\n* @param {String} url\r\n*/\r\nHtml5Audio.setStaticSe = function (url) {\r\n  if (!this._initialized) {\r\n      this.initialize();\r\n      this.clear();\r\n  }\r\n  this._staticSePath = url;\r\n};\r\n\r\n/**\r\n* [read-only] The url of the audio file.\r\n*\r\n* @property url\r\n* @type String\r\n*/\r\nObject.defineProperty(Html5Audio, 'url', {\r\n  get: function () {\r\n      return Html5Audio._url;\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* The volume of the audio.\r\n*\r\n* @property volume\r\n* @type Number\r\n*/\r\nObject.defineProperty(Html5Audio, 'volume', {\r\n  get: function () {\r\n      return Html5Audio._volume;\r\n  }.bind(this),\r\n  set: function (value) {\r\n      Html5Audio._volume = value;\r\n      if (Html5Audio._audioElement) {\r\n          Html5Audio._audioElement.volume = this._volume;\r\n      }\r\n  },\r\n  configurable: true\r\n});\r\n\r\n/**\r\n* Checks whether the audio data is ready to play.\r\n*\r\n* @static\r\n* @method isReady\r\n* @return {Boolean} True if the audio data is ready to play\r\n*/\r\nHtml5Audio.isReady = function () {\r\n  return this._buffered;\r\n};\r\n\r\n/**\r\n* Checks whether a loading error has occurred.\r\n*\r\n* @static\r\n* @method isError\r\n* @return {Boolean} True if a loading error has occurred\r\n*/\r\nHtml5Audio.isError = function () {\r\n  return this._hasError;\r\n};\r\n\r\n/**\r\n* Checks whether the audio is playing.\r\n*\r\n* @static\r\n* @method isPlaying\r\n* @return {Boolean} True if the audio is playing\r\n*/\r\nHtml5Audio.isPlaying = function () {\r\n  return !this._audioElement.paused;\r\n};\r\n\r\n/**\r\n* Plays the audio.\r\n*\r\n* @static\r\n* @method play\r\n* @param {Boolean} loop Whether the audio data play in a loop\r\n* @param {Number} offset The start position to play in seconds\r\n*/\r\nHtml5Audio.play = function (loop, offset) {\r\n  if (this.isReady()) {\r\n      offset = offset || 0;\r\n      this._startPlaying(loop, offset);\r\n  } else if (Html5Audio._audioElement) {\r\n      this._autoPlay = true;\r\n      this.addLoadListener(function () {\r\n          if (this._autoPlay) {\r\n              this.play(loop, offset);\r\n              if (this._gainTweenInterval) {\r\n                  clearInterval(this._gainTweenInterval);\r\n                  this._gainTweenInterval = null;\r\n              }\r\n          }\r\n      }.bind(this));\r\n      if (!this._isLoading) this._load(this._url);\r\n  }\r\n};\r\n\r\n/**\r\n* Stops the audio.\r\n*\r\n* @static\r\n* @method stop\r\n*/\r\nHtml5Audio.stop = function () {\r\n  if (this._audioElement) this._audioElement.pause();\r\n  this._autoPlay = false;\r\n  if (this._tweenInterval) {\r\n      clearInterval(this._tweenInterval);\r\n      this._tweenInterval = null;\r\n      this._audioElement.volume = 0;\r\n  }\r\n};\r\n\r\n/**\r\n* Performs the audio fade-in.\r\n*\r\n* @static\r\n* @method fadeIn\r\n* @param {Number} duration Fade-in time in seconds\r\n*/\r\nHtml5Audio.fadeIn = function (duration) {\r\n  if (this.isReady()) {\r\n      if (this._audioElement) {\r\n          this._tweenTargetGain = this._volume;\r\n          this._tweenGain = 0;\r\n          this._startGainTween(duration);\r\n      }\r\n  } else if (this._autoPlay) {\r\n      this.addLoadListener(function () {\r\n          this.fadeIn(duration);\r\n      }.bind(this));\r\n  }\r\n};\r\n\r\n/**\r\n* Performs the audio fade-out.\r\n*\r\n* @static\r\n* @method fadeOut\r\n* @param {Number} duration Fade-out time in seconds\r\n*/\r\nHtml5Audio.fadeOut = function (duration) {\r\n  if (this._audioElement) {\r\n      this._tweenTargetGain = 0;\r\n      this._tweenGain = this._volume;\r\n      this._startGainTween(duration);\r\n  }\r\n};\r\n\r\n/**\r\n* Gets the seek position of the audio.\r\n*\r\n* @static\r\n* @method seek\r\n*/\r\nHtml5Audio.seek = function () {\r\n  if (this._audioElement) {\r\n      return this._audioElement.currentTime;\r\n  } else {\r\n      return 0;\r\n  }\r\n};\r\n\r\n/**\r\n* Add a callback function that will be called when the audio data is loaded.\r\n*\r\n* @static\r\n* @method addLoadListener\r\n* @param {Function} listner The callback function\r\n*/\r\nHtml5Audio.addLoadListener = function (listner) {\r\n  this._loadListeners.push(listner);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _load\r\n* @param {String} url\r\n* @private\r\n*/\r\nHtml5Audio._load = function (url) {\r\n  if (this._audioElement) {\r\n      this._isLoading = true;\r\n      this._audioElement.src = url;\r\n      this._audioElement.load();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _startPlaying\r\n* @param {Boolean} loop\r\n* @param {Number} offset\r\n* @private\r\n*/\r\nHtml5Audio._startPlaying = function (loop, offset) {\r\n  this._audioElement.loop = loop;\r\n  if (this._gainTweenInterval) {\r\n      clearInterval(this._gainTweenInterval);\r\n      this._gainTweenInterval = null;\r\n  }\r\n  if (this._audioElement) {\r\n      this._audioElement.volume = this._volume;\r\n      this._audioElement.currentTime = offset;\r\n      this._audioElement.play();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _onLoad\r\n* @private\r\n*/\r\nHtml5Audio._onLoad = function () {\r\n  this._isLoading = false;\r\n  while (this._loadListeners.length > 0) {\r\n      var listener = this._loadListeners.shift();\r\n      listener();\r\n  }\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _startGainTween\r\n* @params {Number} duration\r\n* @private\r\n*/\r\nHtml5Audio._startGainTween = function (duration) {\r\n  this._audioElement.volume = this._tweenGain;\r\n  if (this._gainTweenInterval) {\r\n      clearInterval(this._gainTweenInterval);\r\n      this._gainTweenInterval = null;\r\n  }\r\n  this._tweenGainStep = (this._tweenTargetGain - this._tweenGain) / (60 * duration);\r\n  this._gainTweenInterval = setInterval(function () {\r\n      Html5Audio._applyTweenValue(Html5Audio._tweenTargetGain);\r\n  }, 1000 / 60);\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _applyTweenValue\r\n* @param {Number} volume\r\n* @private\r\n*/\r\nHtml5Audio._applyTweenValue = function (volume) {\r\n  Html5Audio._tweenGain += Html5Audio._tweenGainStep;\r\n  if (Html5Audio._tweenGain < 0 && Html5Audio._tweenGainStep < 0) {\r\n      Html5Audio._tweenGain = 0;\r\n  }\r\n  else if (Html5Audio._tweenGain > volume && Html5Audio._tweenGainStep > 0) {\r\n      Html5Audio._tweenGain = volume;\r\n  }\r\n\r\n  if (Math.abs(Html5Audio._tweenTargetGain - Html5Audio._tweenGain) < 0.01) {\r\n      Html5Audio._tweenGain = Html5Audio._tweenTargetGain;\r\n      clearInterval(Html5Audio._gainTweenInterval);\r\n      Html5Audio._gainTweenInterval = null;\r\n  }\r\n\r\n  Html5Audio._audioElement.volume = Html5Audio._tweenGain;\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The static class that handles JSON with object information.\r\n*\r\n* @class JsonEx\r\n*/\r\nfunction JsonEx() {\r\n  throw new Error('This is a static class');\r\n}\r\n\r\n/**\r\n* The maximum depth of objects.\r\n*\r\n* @static\r\n* @property maxDepth\r\n* @type Number\r\n* @default 100\r\n*/\r\nJsonEx.maxDepth = 100;\r\n\r\nJsonEx._id = 1;\r\nJsonEx._generateId = function(){\r\n  return JsonEx._id++;\r\n};\r\n\r\n/**\r\n* Converts an object to a JSON string with object information.\r\n*\r\n* @static\r\n* @method stringify\r\n* @param {Object} object The object to be converted\r\n* @return {String} The JSON string\r\n*/\r\nJsonEx.stringify = function(object) {\r\n  var circular = [];\r\n  JsonEx._id = 1;\r\n  var json = JSON.stringify(this._encode(object, circular, 0));\r\n  this._cleanMetadata(object);\r\n  this._restoreCircularReference(circular);\r\n\r\n  return json;\r\n};\r\n\r\nJsonEx._restoreCircularReference = function(circulars){\r\n  circulars.forEach(function(circular){\r\n      var key = circular[0];\r\n      var value = circular[1];\r\n      var content = circular[2];\r\n\r\n      value[key] = content;\r\n  });\r\n};\r\n\r\n/**\r\n* Parses a JSON string and reconstructs the corresponding object.\r\n*\r\n* @static\r\n* @method parse\r\n* @param {String} json The JSON string\r\n* @return {Object} The reconstructed object\r\n*/\r\nJsonEx.parse = function(json) {\r\n  var circular = [];\r\n  var registry = {};\r\n  var contents = this._decode(JSON.parse(json), circular, registry);\r\n  this._cleanMetadata(contents);\r\n  this._linkCircularReference(contents, circular, registry);\r\n\r\n  return contents;\r\n};\r\n\r\nJsonEx._linkCircularReference = function(contents, circulars, registry){\r\n  circulars.forEach(function(circular){\r\n      var key = circular[0];\r\n      var value = circular[1];\r\n      var id = circular[2];\r\n\r\n      value[key] = registry[id];\r\n  });\r\n};\r\n\r\nJsonEx._cleanMetadata = function(object){\r\n  if(!object) return;\r\n\r\n  delete object['@'];\r\n  delete object['@c'];\r\n\r\n  if(typeof object === 'object'){\r\n      Object.keys(object).forEach(function(key){\r\n          var value = object[key];\r\n          if(typeof value === 'object'){\r\n              JsonEx._cleanMetadata(value);\r\n          }\r\n      });\r\n  }\r\n};\r\n\r\n\r\n/**\r\n* Makes a deep copy of the specified object.\r\n*\r\n* @static\r\n* @method makeDeepCopy\r\n* @param {Object} object The object to be copied\r\n* @return {Object} The copied object\r\n*/\r\nJsonEx.makeDeepCopy = function(object) {\r\n  return this.parse(this.stringify(object));\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _encode\r\n* @param {Object} value\r\n* @param {Array} circular\r\n* @param {Number} depth\r\n* @return {Object}\r\n* @private\r\n*/\r\nJsonEx._encode = function(value, circular, depth) {\r\n  depth = depth || 0;\r\n  if (++depth >= this.maxDepth) {\r\n      throw new Error('Object too deep');\r\n  }\r\n  var type = Object.prototype.toString.call(value);\r\n  if (type === '[object Object]' || type === '[object Array]') {\r\n      value['@c'] = JsonEx._generateId();\r\n\r\n      var constructorName = this._getConstructorName(value);\r\n      if (constructorName !== 'Object' && constructorName !== 'Array') {\r\n          value['@'] = constructorName;\r\n      }\r\n      for (var key in value) {\r\n          if (value.hasOwnProperty(key) && !key.match(/^@./)) {\r\n              if(value[key] && typeof value[key] === 'object'){\r\n                  if(value[key]['@c']){\r\n                      circular.push([key, value, value[key]]);\r\n                      value[key] = {'@r': value[key]['@c']};\r\n                  }else{\r\n                      value[key] = this._encode(value[key], circular, depth + 1);\r\n\r\n                      if(value[key] instanceof Array){\r\n                          //wrap array\r\n                          circular.push([key, value, value[key]]);\r\n\r\n                          value[key] = {\r\n                              '@c': value[key]['@c'],\r\n                              '@a': value[key]\r\n                          };\r\n                      }\r\n                  }\r\n              }else{\r\n                  value[key] = this._encode(value[key], circular, depth + 1);\r\n              }\r\n          }\r\n      }\r\n  }\r\n  depth--;\r\n  return value;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _decode\r\n* @param {Object} value\r\n* @param {Array} circular\r\n* @param {Object} registry\r\n* @return {Object}\r\n* @private\r\n*/\r\nJsonEx._decode = function(value, circular, registry) {\r\n  var type = Object.prototype.toString.call(value);\r\n  if (type === '[object Object]' || type === '[object Array]') {\r\n      registry[value['@c']] = value;\r\n\r\n      if (value['@']) {\r\n          var constructor = window[value['@']];\r\n          if (constructor) {\r\n              value = this._resetPrototype(value, constructor.prototype);\r\n          }\r\n      }\r\n      for (var key in value) {\r\n          if (value.hasOwnProperty(key)) {\r\n              if(value[key] && value[key]['@a']){\r\n                  //object is array wrapper\r\n                  var body = value[key]['@a'];\r\n                  body['@c'] = value[key]['@c'];\r\n                  value[key] = body;\r\n              }\r\n              if(value[key] && value[key]['@r']){\r\n                  //object is reference\r\n                  circular.push([key, value, value[key]['@r']])\r\n              }\r\n              value[key] = this._decode(value[key], circular, registry);\r\n          }\r\n      }\r\n  }\r\n  return value;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _getConstructorName\r\n* @param {Object} value\r\n* @return {String}\r\n* @private\r\n*/\r\nJsonEx._getConstructorName = function(value) {\r\n  var name = value.constructor.name;\r\n  if (name === undefined) {\r\n      var func = /^\\s*function\\s*([A-Za-z0-9_$]*)/;\r\n      name = func.exec(value.constructor)[1];\r\n  }\r\n  return name;\r\n};\r\n\r\n/**\r\n* @static\r\n* @method _resetPrototype\r\n* @param {Object} value\r\n* @param {Object} prototype\r\n* @return {Object}\r\n* @private\r\n*/\r\nJsonEx._resetPrototype = function(value, prototype) {\r\n  if (Object.setPrototypeOf !== undefined) {\r\n      Object.setPrototypeOf(value, prototype);\r\n  } else if ('__proto__' in value) {\r\n      value.__proto__ = prototype;\r\n  } else {\r\n      var newValue = Object.create(prototype);\r\n      for (var key in value) {\r\n          if (value.hasOwnProperty(key)) {\r\n              newValue[key] = value[key];\r\n          }\r\n      }\r\n      value = newValue;\r\n  }\r\n  return value;\r\n};\r\n\r\n\r\nfunction Decrypter() {\r\n  throw new Error('This is a static class');\r\n}\r\n\r\nDecrypter.hasEncryptedImages = false;\r\nDecrypter.hasEncryptedAudio = false;\r\nDecrypter._requestImgFile = [];\r\nDecrypter._headerlength = 16;\r\nDecrypter._xhrOk = 400;\r\nDecrypter._encryptionKey = \"\";\r\nDecrypter._ignoreList = [\r\n  \"img/system/Window.png\"\r\n];\r\nDecrypter.SIGNATURE = \"5250474d56000000\";\r\nDecrypter.VER = \"000301\";\r\nDecrypter.REMAIN = \"0000000000\";\r\n\r\nDecrypter.checkImgIgnore = function(url){\r\n  for(var cnt = 0; cnt < this._ignoreList.length; cnt++) {\r\n      if(url === this._ignoreList[cnt]) return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nDecrypter.decryptImg = function(url, bitmap) {\r\n  url = this.extToEncryptExt(url);\r\n\r\n  var requestFile = new XMLHttpRequest();\r\n  requestFile.open(\"GET\", url);\r\n  requestFile.responseType = \"arraybuffer\";\r\n  requestFile.send();\r\n\r\n  requestFile.onload = function () {\r\n      if(this.status < Decrypter._xhrOk) {\r\n          var arrayBuffer = Decrypter.decryptArrayBuffer(requestFile.response);\r\n          bitmap._image.src = Decrypter.createBlobUrl(arrayBuffer);\r\n          bitmap._image.addEventListener('load', bitmap._loadListener = Bitmap.prototype._onLoad.bind(bitmap));\r\n          bitmap._image.addEventListener('error', bitmap._errorListener = bitmap._loader || Bitmap.prototype._onError.bind(bitmap));\r\n      }\r\n  };\r\n\r\n  requestFile.onerror = function () {\r\n      if (bitmap._loader) {\r\n          bitmap._loader();\r\n      } else {\r\n          bitmap._onError();\r\n      }\r\n  };\r\n};\r\n\r\nDecrypter.decryptHTML5Audio = function(url, bgm, pos) {\r\n  var requestFile = new XMLHttpRequest();\r\n  requestFile.open(\"GET\", url);\r\n  requestFile.responseType = \"arraybuffer\";\r\n  requestFile.send();\r\n\r\n  requestFile.onload = function () {\r\n      if(this.status < Decrypter._xhrOk) {\r\n          var arrayBuffer = Decrypter.decryptArrayBuffer(requestFile.response);\r\n          var url = Decrypter.createBlobUrl(arrayBuffer);\r\n          AudioManager.createDecryptBuffer(url, bgm, pos);\r\n      }\r\n  };\r\n};\r\n\r\nDecrypter.cutArrayHeader = function(arrayBuffer, length) {\r\n  return arrayBuffer.slice(length);\r\n};\r\n\r\nDecrypter.decryptArrayBuffer = function(arrayBuffer) {\r\n  if (!arrayBuffer) return null;\r\n  var header = new Uint8Array(arrayBuffer, 0, this._headerlength);\r\n\r\n  var i;\r\n  var ref = this.SIGNATURE + this.VER + this.REMAIN;\r\n  var refBytes = new Uint8Array(16);\r\n  for (i = 0; i < this._headerlength; i++) {\r\n      refBytes[i] = parseInt(\"0x\" + ref.substr(i * 2, 2), 16);\r\n  }\r\n  for (i = 0; i < this._headerlength; i++) {\r\n      if (header[i] !== refBytes[i]) {\r\n          throw new Error(\"Header is wrong\");\r\n      }\r\n  }\r\n\r\n  arrayBuffer = this.cutArrayHeader(arrayBuffer, Decrypter._headerlength);\r\n  var view = new DataView(arrayBuffer);\r\n  this.readEncryptionkey();\r\n  if (arrayBuffer) {\r\n      var byteArray = new Uint8Array(arrayBuffer);\r\n      for (i = 0; i < this._headerlength; i++) {\r\n          byteArray[i] = byteArray[i] ^ parseInt(Decrypter._encryptionKey[i], 16);\r\n          view.setUint8(i, byteArray[i]);\r\n      }\r\n  }\r\n\r\n  return arrayBuffer;\r\n};\r\n\r\nDecrypter.createBlobUrl = function(arrayBuffer){\r\n  var blob = new Blob([arrayBuffer]);\r\n  return window.URL.createObjectURL(blob);\r\n};\r\n\r\nDecrypter.extToEncryptExt = function(url) {\r\n  var ext = url.split('.').pop();\r\n  var encryptedExt = ext;\r\n\r\n  if(ext === \"ogg\") encryptedExt = \".rpgmvo\";\r\n  else if(ext === \"m4a\") encryptedExt = \".rpgmvm\";\r\n  else if(ext === \"png\") encryptedExt = \".rpgmvp\";\r\n  else encryptedExt = ext;\r\n\r\n  return url.slice(0, url.lastIndexOf(ext) - 1) + encryptedExt;\r\n};\r\n\r\nDecrypter.readEncryptionkey = function(){\r\n  this._encryptionKey = $dataSystem.encryptionKey.split(/(.{2})/).filter(Boolean);\r\n};\r\n\r\n//-----------------------------------------------------------------------------\r\n/**\r\n* The static class that handles resource loading.\r\n*\r\n* @class ResourceHandler\r\n*/\r\nfunction ResourceHandler() {\r\n  throw new Error('This is a static class');\r\n}\r\n\r\nResourceHandler._reloaders = [];\r\nResourceHandler._defaultRetryInterval = [500, 1000, 3000];\r\n\r\nResourceHandler.createLoader = function(url, retryMethod, resignMethod, retryInterval) {\r\n  retryInterval = retryInterval || this._defaultRetryInterval;\r\n  var reloaders = this._reloaders;\r\n  var retryCount = 0;\r\n  return function() {\r\n      if (retryCount < retryInterval.length) {\r\n          setTimeout(retryMethod, retryInterval[retryCount]);\r\n          retryCount++;\r\n      } else {\r\n          if (resignMethod) {\r\n              resignMethod();\r\n          }\r\n          if (url) {\r\n              if (reloaders.length === 0) {\r\n                  Graphics.printLoadingError(url);\r\n                  SceneManager.stop();\r\n              }\r\n              reloaders.push(function() {\r\n                  retryCount = 0;\r\n                  retryMethod();\r\n              });\r\n          }\r\n      }\r\n  };\r\n};\r\n\r\nResourceHandler.exists = function() {\r\n  return this._reloaders.length > 0;\r\n};\r\n\r\nResourceHandler.retry = function() {\r\n  if (this._reloaders.length > 0) {\r\n      Graphics.eraseLoadingError();\r\n      SceneManager.resume();\r\n      this._reloaders.forEach(function(reloader) {\r\n          reloader();\r\n      });\r\n      this._reloaders.length = 0;\r\n  }\r\n};\r\n"]}